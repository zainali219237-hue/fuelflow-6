{"file_contents":{"README.md":{"content":"# FuelFlow - Petrol Pump Management System\n\n## Overview\n\nFuelFlow is a comprehensive Petrol Pump Management System designed to handle all aspects of fuel retail business operations. The system provides complete business management functionality including point-of-sale operations, inventory management, financial tracking, customer and supplier management, and comprehensive reporting capabilities.\n\n## ðŸš€ Quick Start\n\n### Default Login Credentials\n- **Username:** `admin`\n- **Password:** `admin123`\n\n### Google Authentication\nThe system also supports Google Sign-In for convenient access. Users can sign in with their Google accounts and be automatically registered in the system.\n\n## ðŸ—ï¸ System Architecture\n\n### Frontend Architecture\n- **Framework:** React 18 with TypeScript\n- **Build Tool:** Vite for fast development and optimized builds\n- **UI Library:** Custom component system built on Radix UI primitives\n- **Styling:** Tailwind CSS for consistent and responsive design\n- **State Management:** TanStack Query for server state with optimistic updates\n- **Routing:** Wouter for lightweight client-side routing\n- **Authentication:** Dual system supporting local and Google authentication\n\n### Backend Architecture\n- **Runtime:** Node.js with Express.js framework\n- **Language:** TypeScript with ES modules\n- **API Design:** RESTful API with structured error handling\n- **Authentication:** Session-based with bcrypt password hashing + Firebase Google Auth\n- **Database:** PostgreSQL with Drizzle ORM\n- **Real-time:** WebSocket support for live updates\n\n## ðŸ” Authentication System\n\n### Dual Authentication Support\nThe system supports two authentication methods:\n\n#### 1. Local Authentication\n- Username and password based\n- Bcrypt password hashing for security\n- Role-based access control (admin, manager, cashier)\n- Station-specific access\n\n#### 2. Google Authentication\n- Firebase-powered Google Sign-In\n- Automatic user registration\n- Seamless integration with existing system\n- Default 'cashier' role assignment\n\n### Setting Up Google Authentication\n\nTo enable Google authentication, you need to:\n\n1. **Firebase Console Setup:**\n   - Go to [Firebase Console](https://console.firebase.google.com/)\n   - Create a new Firebase project\n   - Add a web app to your project\n   - Enable Google Sign-In in Authentication section\n   - Add your Replit domain to authorized domains\n\n2. **Environment Variables:**\n   Set these environment variables in your Replit:\n   - `VITE_FIREBASE_PROJECT_ID`: Your Firebase project ID\n   - `VITE_FIREBASE_APP_ID`: Your Firebase app ID\n   - `VITE_FIREBASE_API_KEY`: Your Firebase API key\n\n## ðŸ“Š Core Features\n\n### 1. Point of Sale (POS)\n- **Real-time Fuel Sales:** Process petrol, diesel, and other fuel transactions\n- **Multi-pump Support:** Handle multiple fuel dispensers simultaneously\n- **Payment Methods:** Cash, card, and credit transactions\n- **Receipt Generation:** Automatic receipt printing and digital copies\n- **Inventory Integration:** Real-time stock updates during sales\n\n### 2. Inventory Management\n- **Tank Monitoring:** Track fuel levels in storage tanks\n- **Stock Movements:** Record fuel receipts, sales, and transfers\n- **Automatic Alerts:** Low stock and overfill warnings\n- **Fuel Quality Tracking:** Monitor fuel quality metrics\n- **Purchase Order Integration:** Seamless restocking workflow\n\n### 3. Financial Management\n- **Accounts Receivable:** Track customer credit and payments\n- **Accounts Payable:** Manage supplier invoices and payments\n- **Cash Reconciliation:** Daily cash drawer balancing\n- **Expense Management:** Record and categorize business expenses\n- **Financial Reporting:** Comprehensive financial statements\n\n### 4. Customer Management\n- **Customer Database:** Maintain detailed customer records\n- **Credit Management:** Track credit limits and outstanding balances\n- **Payment History:** Complete payment tracking and aging reports\n- **Loyalty Programs:** Support for customer loyalty initiatives\n\n### 5. Supplier Management\n- **Supplier Directory:** Comprehensive supplier database\n- **Purchase Orders:** Create and manage fuel purchase orders\n- **Payment Tracking:** Monitor supplier payments and due dates\n- **Quality Management:** Track supplier performance metrics\n\n### 6. Reporting System\n- **Sales Reports:** Daily, weekly, monthly sales analysis\n- **Financial Statements:** Profit & loss, balance sheet, cash flow\n- **Inventory Reports:** Stock levels, movement analysis\n- **Customer Analytics:** Customer behavior and credit analysis\n- **Management Dashboard:** Key performance indicators and trends\n\n## ðŸ—„ï¸ Database Schema\n\n### Core Tables\n\n#### Users & Authentication\n- `users`: System users with roles and permissions\n- `stations`: Fuel station locations and details\n\n#### Inventory Management\n- `products`: Fuel types and other products\n- `tanks`: Storage tank information and capacity\n- `stock_movements`: All inventory movements and transactions\n\n#### Customer & Supplier Relations\n- `customers`: Customer database with credit information\n- `suppliers`: Supplier information and contacts\n- `purchase_orders`: Purchase order management\n\n#### Financial Management\n- `transactions`: All sales transactions\n- `payments`: Customer and supplier payments\n- `expenses`: Business expense tracking\n\n## ðŸ› ï¸ Development Setup\n\n### Prerequisites\n- Node.js 20+\n- PostgreSQL database\n- Firebase project (for Google Auth)\n\n### Installation\n```bash\n# Install dependencies\nnpm install\n\n# Set up database\nnpm run db:push\n\n# Start development server\nnpm run dev\n```\n\n### Environment Variables\n```env\nDATABASE_URL=postgresql://...\nVITE_FIREBASE_PROJECT_ID=your-project-id\nVITE_FIREBASE_APP_ID=your-app-id\nVITE_FIREBASE_API_KEY=your-api-key\n```\n\n## ðŸ”§ Key Technologies\n\n### Frontend Technologies\n- **React 18**: Modern React with hooks and concurrent features\n- **TypeScript**: Type-safe development\n- **Vite**: Fast build tool and dev server\n- **TailwindCSS**: Utility-first CSS framework\n- **Radix UI**: Accessible component primitives\n- **TanStack Query**: Powerful data synchronization\n- **React Hook Form**: Performant form management\n- **Zod**: Runtime type validation\n\n### Backend Technologies\n- **Express.js**: Web application framework\n- **Drizzle ORM**: Type-safe database queries\n- **bcrypt**: Password hashing\n- **Firebase Auth**: Google authentication\n- **WebSocket**: Real-time communication\n- **Session Management**: Secure user sessions\n\n## ðŸš€ Deployment\n\nThe application is designed for Replit deployment with:\n- Automatic workflow management\n- Built-in PostgreSQL database\n- Environment variable management\n- Domain and SSL handling\n\n## ðŸ“± User Interface\n\n### Dashboard\n- Real-time sales metrics\n- Inventory status overview\n- Financial summary\n- Quick action buttons\n\n### Navigation\n- Sidebar navigation with role-based menu items\n- Responsive design for mobile and desktop\n- Quick search functionality\n- User profile and settings\n\n### Form Design\n- Consistent form layouts\n- Real-time validation\n- Error handling and user feedback\n- Auto-save capabilities\n\n## ðŸ”’ Security Features\n\n### Data Security\n- Password hashing with bcrypt\n- Session-based authentication\n- SQL injection prevention\n- XSS protection\n- CSRF protection\n\n### Access Control\n- Role-based permissions\n- Station-specific access\n- API endpoint protection\n- Audit logging\n\n## ðŸ“ˆ Performance Features\n\n### Frontend Optimization\n- Code splitting and lazy loading\n- Component memoization\n- Optimistic updates\n- Efficient re-rendering\n\n### Backend Optimization\n- Database connection pooling\n- Query optimization\n- Response caching\n- Error handling middleware\n\n## ðŸ”„ Real-time Features\n\n- Live inventory updates\n- Real-time transaction processing\n- WebSocket-based notifications\n- Automatic data synchronization\n\n## ðŸ“Š Business Intelligence\n\n### Analytics\n- Sales trend analysis\n- Customer behavior insights\n- Inventory turnover reports\n- Profitability analysis\n\n### Decision Support\n- Automated alerts and notifications\n- Key performance indicators\n- Predictive analytics\n- Business forecasting\n\n## ðŸ›¡ï¸ Backup & Recovery\n\n- Automatic database backups\n- Point-in-time recovery\n- Data export capabilities\n- System health monitoring\n\n## ðŸ“ž Support & Maintenance\n\n### System Monitoring\n- Application performance monitoring\n- Error tracking and logging\n- Database performance metrics\n- User activity monitoring\n\n### Maintenance Tasks\n- Regular data cleanup\n- Security updates\n- Performance optimization\n- Feature enhancements\n\n---\n\n*This system is designed to scale with your business needs while maintaining security, performance, and reliability.*","size_bytes":8635},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Overview\n\nThis is a comprehensive Petrol Pump Management System built as a full-stack web application. The system provides complete business management functionality for petrol stations, including point-of-sale operations, inventory management, financial tracking, customer and supplier management, and comprehensive reporting capabilities. It's designed to handle the complex operational needs of fuel retail businesses with features for cash reconciliation, credit management, stock monitoring, and financial reporting.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n- **Framework**: React with TypeScript using Vite as the build tool\n- **UI Library**: Custom component system built on Radix UI primitives with Tailwind CSS styling\n- **State Management**: TanStack Query (React Query) for server state management with optimistic updates\n- **Routing**: Wouter for lightweight client-side routing\n- **Authentication**: Context-based authentication system with localStorage persistence\n- **Form Management**: React Hook Form with Zod validation schemas\n\n## Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **API Design**: RESTful API with structured error handling and request logging middleware\n- **Authentication**: Session-based authentication with bcrypt password hashing\n- **Database Layer**: Repository pattern with a storage abstraction layer for clean separation of concerns\n\n## Data Storage\n- **Database**: PostgreSQL with Neon serverless configuration\n- **ORM**: Drizzle ORM with type-safe schema definitions\n- **Schema Design**: Comprehensive relational schema covering users, stations, products, tanks, customers, suppliers, transactions, purchase orders, expenses, payments, and stock movements\n- **Migration System**: Drizzle Kit for database schema migrations and management\n\n## Component Architecture\n- **Design System**: Shadcn/ui components with consistent styling and behavior\n- **Layout System**: Sidebar navigation with protected routes and role-based access\n- **Form Components**: Reusable form components with validation and error handling\n- **Data Tables**: Sortable and filterable tables with search and pagination capabilities\n\n## Business Logic Modules\n- **Point of Sale**: Real-time transaction processing with inventory updates\n- **Inventory Management**: Tank monitoring, stock movements, and automatic alerts\n- **Financial Management**: Accounts receivable/payable, expense tracking, and cash reconciliation\n- **Customer/Supplier Relations**: Credit management and payment tracking\n- **Reporting System**: Financial statements, sales reports, and aging analysis\n\n## Security & Authentication\n- **Password Security**: Bcrypt hashing with salt rounds\n- **Route Protection**: AuthGuard component ensuring authenticated access\n- **Role-Based Access**: User roles (admin, manager, cashier) with appropriate permissions\n- **Session Management**: Secure session handling with automatic logout\n\n# External Dependencies\n\n## Database Services\n- **Neon Database**: Serverless PostgreSQL hosting with connection pooling\n- **WebSocket Support**: Real-time database connections via WebSocket constructor\n\n## UI & Styling\n- **Radix UI**: Headless UI primitives for accessible components\n- **Tailwind CSS**: Utility-first CSS framework with custom design tokens\n- **Lucide React**: Icon library for consistent iconography\n- **Class Variance Authority**: Type-safe component variants\n\n## Development Tools\n- **Vite**: Fast development server and build tool with HMR\n- **ESBuild**: Fast JavaScript bundler for production builds\n- **TypeScript**: Static type checking and enhanced developer experience\n- **Drizzle Kit**: Database schema management and migration tools\n\n## Third-Party Libraries\n- **TanStack Query**: Server state management with caching and synchronization\n- **React Hook Form**: Performant form library with minimal re-renders\n- **Zod**: Schema validation for type-safe data handling\n- **Date-fns**: Date manipulation and formatting utilities\n- **Recharts**: Chart library for financial data visualization\n\n## Authentication & Security\n- **bcrypt**: Password hashing and verification\n- **connect-pg-simple**: PostgreSQL session store for Express sessions\n- **Wouter**: Lightweight routing for single-page application navigation","size_bytes":4404},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        fadeIn: {\n          from: { opacity: \"0\" },\n          to: { opacity: \"1\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"fade-in\": \"fadeIn 0.3s ease-in\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2892},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/auth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { storage } from \"./storage\";\n\n// Firebase Admin SDK - simplified initialization\nlet admin: any = null;\nconsole.warn(\"Firebase Admin SDK disabled for now - Google auth will not work server-side\");\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-super-secret-jwt-key-change-this-in-production\";\n\nexport interface AuthenticatedUser {\n  id: string;\n  username: string;\n  fullName: string;\n  role: string;\n  stationId?: string;\n  email?: string;\n  isGoogleAuth?: boolean;\n}\n\n// Extend Express Request type to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: AuthenticatedUser;\n    }\n  }\n}\n\n// Generate JWT token\nexport function generateToken(user: AuthenticatedUser): string {\n  return jwt.sign(\n    { \n      id: user.id, \n      username: user.username, \n      role: user.role,\n      stationId: user.stationId,\n      isGoogleAuth: user.isGoogleAuth \n    },\n    JWT_SECRET,\n    { expiresIn: \"24h\" }\n  );\n}\n\n// Verify JWT token\nexport function verifyToken(token: string): AuthenticatedUser | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as any;\n    return {\n      id: decoded.id,\n      username: decoded.username,\n      fullName: decoded.fullName || decoded.username,\n      role: decoded.role,\n      stationId: decoded.stationId,\n      isGoogleAuth: decoded.isGoogleAuth || false\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n// Verify Firebase ID token\nexport async function verifyFirebaseToken(idToken: string): Promise<any | null> {\n  if (!admin) {\n    console.error(\"Firebase Admin SDK not available for token verification\");\n    return null;\n  }\n  \n  try {\n    const decodedToken = await admin.auth().verifyIdToken(idToken);\n    return decodedToken;\n  } catch (error) {\n    console.error(\"Firebase token verification failed:\", error);\n    return null;\n  }\n}\n\n// Authentication middleware\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader) {\n    return res.status(401).json({ message: \"No authorization header provided\" });\n  }\n\n  const token = authHeader.startsWith(\"Bearer \") \n    ? authHeader.substring(7)\n    : authHeader;\n\n  const user = verifyToken(token);\n  \n  if (!user) {\n    return res.status(401).json({ message: \"Invalid or expired token\" });\n  }\n\n  req.user = user;\n  next();\n}\n\n// Role-based authorization middleware\nexport function requireRole(roles: string[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({ message: \"Insufficient permissions\" });\n    }\n\n    next();\n  };\n}\n\n// Station access authorization middleware\nexport function requireStationAccess(req: Request, res: Response, next: NextFunction) {\n  if (!req.user) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n\n  const stationId = req.params.stationId || req.body.stationId;\n  \n  // Admin can access all stations\n  if (req.user.role === \"admin\") {\n    return next();\n  }\n\n  // Other users can only access their assigned station\n  if (req.user.stationId && req.user.stationId !== stationId) {\n    return res.status(403).json({ message: \"Access denied to this station\" });\n  }\n\n  next();\n}","size_bytes":3457},"server/db.ts":{"content":"import pg from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":402},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { seedInitialData } from \"./seed\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      \n      // Don't log sensitive auth response data containing tokens\n      if (capturedJsonResponse && !path.includes(\"/api/auth/\")) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // Seed initial data if database is empty\n  try {\n    await seedInitialData();\n  } catch (error) {\n    console.error(\"Failed to seed initial data:\", error);\n  }\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2377},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { \n  insertUserSchema, insertStationSchema, insertProductSchema, insertTankSchema,\n  insertCustomerSchema, insertSupplierSchema, insertSalesTransactionSchema,\n  insertSalesTransactionItemSchema, insertPurchaseOrderSchema, insertPurchaseOrderItemSchema,\n  insertExpenseSchema, insertPaymentSchema, insertStockMovementSchema, insertSettingsSchema\n} from \"@shared/schema\";\nimport bcrypt from \"bcrypt\";\nimport { requireAuth, requireRole, requireStationAccess, generateToken, verifyFirebaseToken, AuthenticatedUser } from \"./auth\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Authentication routes (unprotected)\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const passwordMatch = await bcrypt.compare(password, user.password);\n      if (!passwordMatch) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      // Remove password from response and generate token\n      const { password: _, ...userWithoutPassword } = user;\n      const authUser: AuthenticatedUser = {\n        id: userWithoutPassword.id,\n        username: userWithoutPassword.username,\n        fullName: userWithoutPassword.fullName,\n        role: userWithoutPassword.role,\n        stationId: userWithoutPassword.stationId || undefined,\n        isGoogleAuth: false\n      };\n      \n      const token = generateToken(authUser);\n      res.json({ user: authUser, token });\n    } catch (error) {\n      res.status(500).json({ message: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/google\", async (req, res) => {\n    try {\n      const { idToken } = req.body;\n      \n      if (!idToken) {\n        return res.status(400).json({ message: \"Firebase ID token required\" });\n      }\n\n      const decodedToken = await verifyFirebaseToken(idToken);\n      if (!decodedToken) {\n        return res.status(401).json({ message: \"Invalid Firebase token\" });\n      }\n\n      // Check if user exists in database\n      let user = await storage.getUserByUsername(decodedToken.email || decodedToken.uid);\n      \n      if (!user) {\n        // Create new user for Google sign-in\n        const hashedPassword = await bcrypt.hash(Math.random().toString(36), 10); // Random password for Google users\n        const newUser = {\n          username: decodedToken.email || decodedToken.uid,\n          password: hashedPassword,\n          fullName: decodedToken.name || decodedToken.email || 'Google User',\n          role: 'cashier' as const, // Default role for Google users\n          isActive: true\n        };\n        \n        user = await storage.createUser(newUser);\n      }\n\n      // Create authenticated user object\n      const authUser: AuthenticatedUser = {\n        id: user.id,\n        username: user.username,\n        fullName: user.fullName,\n        role: user.role,\n        stationId: user.stationId || undefined,\n        email: decodedToken.email,\n        isGoogleAuth: true\n      };\n      \n      const token = generateToken(authUser);\n      res.json({ user: authUser, token });\n    } catch (error) {\n      console.error('Google auth error:', error);\n      res.status(500).json({ message: \"Google authentication failed\" });\n    }\n  });\n\n  app.get(\"/api/auth/me\", requireAuth, async (req, res) => {\n    try {\n      // Return current user info from token\n      res.json({ user: req.user });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get user info\" });\n    }\n  });\n\n  // Protected routes (require authentication)\n  // Stations routes\n  app.get(\"/api/stations\", requireAuth, async (req, res) => {\n    try {\n      const stations = await storage.getStations();\n      res.json(stations);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch stations\" });\n    }\n  });\n\n  app.post(\"/api/stations\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const validatedData = insertStationSchema.parse(req.body);\n      const station = await storage.createStation(validatedData);\n      res.status(201).json(station);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid station data\" });\n    }\n  });\n\n  app.get(\"/api/stations/:id\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const station = await storage.getStation(id);\n      if (!station) {\n        return res.status(404).json({ message: \"Station not found\" });\n      }\n      res.json(station);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch station\" });\n    }\n  });\n\n  // Settings routes\n  app.get(\"/api/settings/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const settings = await storage.getSettings(stationId);\n      if (!settings) {\n        // Return default settings if none exist\n        const defaultSettings = {\n          stationId,\n          taxEnabled: false,\n          taxRate: '0',\n          currencyCode: 'PKR' as const,\n        };\n        return res.json(defaultSettings);\n      }\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch settings\" });\n    }\n  });\n\n  app.post(\"/api/settings/:stationId\", requireAuth, requireRole(['admin', 'manager']), requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      // Ensure stationId comes from URL params, not body\n      const { stationId: _, ...bodyData } = req.body;\n      const validatedData = insertSettingsSchema.parse({ ...bodyData, stationId });\n      \n      try {\n        const settings = await storage.createSettings(validatedData);\n        res.status(201).json(settings);\n      } catch (error: any) {\n        // Handle unique constraint violation - settings already exist\n        if (error.message.includes('duplicate') || error.message.includes('unique')) {\n          const existingSettings = await storage.getSettings(stationId);\n          if (existingSettings) {\n            return res.status(409).json({ \n              message: \"Settings already exist for this station. Use PUT to update.\",\n              settings: existingSettings \n            });\n          }\n        }\n        throw error;\n      }\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid settings data\" });\n    }\n  });\n\n  app.put(\"/api/settings/:stationId\", requireAuth, requireRole(['admin', 'manager']), requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      // Ensure stationId comes from URL params, not body  \n      const { stationId: _, ...bodyData } = req.body;\n      const validatedData = insertSettingsSchema.partial().parse(bodyData);\n      const settings = await storage.updateSettings(stationId, validatedData);\n      res.json(settings);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid settings data\" });\n    }\n  });\n\n  // Products routes\n  app.get(\"/api/products\", requireAuth, async (req, res) => {\n    try {\n      const products = await storage.getProducts();\n      res.json(products);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch products\" });\n    }\n  });\n\n  app.post(\"/api/products\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const validatedData = insertProductSchema.parse(req.body);\n      const product = await storage.createProduct(validatedData);\n      res.status(201).json(product);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid product data\" });\n    }\n  });\n\n  app.put(\"/api/products/:id\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = insertProductSchema.partial().parse(req.body);\n      const product = await storage.updateProduct(id, validatedData);\n      res.json(product);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid product data\" });\n    }\n  });\n\n  // Tanks routes\n  app.get(\"/api/tanks/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const tanks = await storage.getTanksByStation(stationId);\n      res.json(tanks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch tanks\" });\n    }\n  });\n\n  app.post(\"/api/tanks\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const validatedData = insertTankSchema.parse(req.body);\n      const tank = await storage.createTank(validatedData);\n      res.status(201).json(tank);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid tank data\" });\n    }\n  });\n\n  // Stock Movements routes\n  app.get(\"/api/stock-movements/:tankId\", requireAuth, async (req, res) => {\n    try {\n      const { tankId } = req.params;\n      const stockMovements = await storage.getStockMovements(tankId);\n      res.json(stockMovements);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch stock movements\" });\n    }\n  });\n\n  app.post(\"/api/stock-movements\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = insertStockMovementSchema.parse(req.body);\n      const stockMovement = await storage.createStockMovement(validatedData);\n      res.status(201).json(stockMovement);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid stock movement data\" });\n    }\n  });\n\n  // Customers routes\n  app.get(\"/api/customers\", requireAuth, async (req, res) => {\n    try {\n      const customers = await storage.getCustomers();\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.post(\"/api/customers\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = insertCustomerSchema.parse(req.body);\n      const customer = await storage.createCustomer(validatedData);\n      res.status(201).json(customer);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid customer data\" });\n    }\n  });\n\n  app.put(\"/api/customers/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = insertCustomerSchema.partial().parse(req.body);\n      const customer = await storage.updateCustomer(id, validatedData);\n      res.json(customer);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid customer data\" });\n    }\n  });\n\n  // Suppliers routes\n  app.get(\"/api/suppliers\", requireAuth, async (req, res) => {\n    try {\n      const suppliers = await storage.getSuppliers();\n      res.json(suppliers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch suppliers\" });\n    }\n  });\n\n  app.post(\"/api/suppliers\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const validatedData = insertSupplierSchema.parse(req.body);\n      const supplier = await storage.createSupplier(validatedData);\n      res.status(201).json(supplier);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid supplier data\" });\n    }\n  });\n\n  app.put(\"/api/suppliers/:id\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = insertSupplierSchema.partial().parse(req.body);\n      const supplier = await storage.updateSupplier(id, validatedData);\n      res.json(supplier);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid supplier data\" });\n    }\n  });\n\n  // Sales transactions routes\n  app.get(\"/api/sales/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const { limit } = req.query;\n      const sales = await storage.getSalesTransactions(stationId, limit ? parseInt(limit as string) : undefined);\n      res.json(sales);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch sales\" });\n    }\n  });\n\n  app.get(\"/api/sales/detail/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userStationId = req.user?.stationId || '';\n      const userRole = req.user?.role || '';\n      \n      const sale = await storage.getSalesTransactionWithItemsSecure(id, userStationId, userRole);\n      if (!sale) {\n        return res.status(404).json({ message: \"Sales transaction not found\" });\n      }\n      res.json(sale);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('Access denied')) {\n        return res.status(403).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to fetch sales transaction details\" });\n    }\n  });\n\n  app.delete(\"/api/sales/:id\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userStationId = req.user?.stationId || '';\n      const userRole = req.user?.role || '';\n      \n      await storage.deleteSalesTransactionSecure(id, userStationId, userRole);\n      res.json({ message: \"Sales transaction deleted successfully\" });\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('Access denied')) {\n        return res.status(403).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to delete sales transaction\" });\n    }\n  });\n\n  app.post(\"/api/sales\", requireAuth, async (req, res) => {\n    try {\n      const { transaction, items } = req.body;\n      \n      // Validate transaction data\n      const validatedTransaction = insertSalesTransactionSchema.parse(transaction);\n      const createdTransaction = await storage.createSalesTransaction(validatedTransaction);\n      \n      // Create transaction items\n      const createdItems = [];\n      for (const item of items) {\n        const validatedItem = insertSalesTransactionItemSchema.parse({\n          ...item,\n          transactionId: createdTransaction.id\n        });\n        const createdItem = await storage.createSalesTransactionItem(validatedItem);\n        createdItems.push(createdItem);\n        \n        // Create stock movement (previousStock and newStock are calculated automatically)\n        await storage.createStockMovement({\n          tankId: item.tankId,\n          stationId: validatedTransaction.stationId,\n          userId: validatedTransaction.userId,\n          movementType: 'out',\n          quantity: item.quantity, // Positive quantity - method handles the direction\n          previousStock: '0', // Will be calculated automatically\n          newStock: '0', // Will be calculated automatically\n          referenceId: createdTransaction.id,\n          referenceType: 'sale',\n          notes: `Sale - Invoice ${createdTransaction.invoiceNumber}`,\n          movementDate: new Date(),\n        });\n      }\n      \n      // Update customer outstanding amount for credit sales\n      if (validatedTransaction.paymentMethod === 'credit' && validatedTransaction.customerId) {\n        await storage.updateCustomerOutstanding(\n          validatedTransaction.customerId, \n          parseFloat(validatedTransaction.outstandingAmount || '0')\n        );\n      }\n      \n      res.status(201).json({ transaction: createdTransaction, items: createdItems });\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid sales data\" });\n    }\n  });\n\n  // Purchase orders routes\n  app.get(\"/api/purchase-orders/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const orders = await storage.getPurchaseOrders(stationId);\n      res.json(orders);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.get(\"/api/purchase-orders/detail/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userStationId = req.user?.stationId || '';\n      const userRole = req.user?.role || '';\n      \n      const order = await storage.getPurchaseOrderWithItemsSecure(id, userStationId, userRole);\n      if (!order) {\n        return res.status(404).json({ message: \"Purchase order not found\" });\n      }\n      res.json(order);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('Access denied')) {\n        return res.status(403).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to fetch purchase order details\" });\n    }\n  });\n\n  app.delete(\"/api/purchase-orders/:id\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userStationId = req.user?.stationId || '';\n      const userRole = req.user?.role || '';\n      \n      await storage.deletePurchaseOrderSecure(id, userStationId, userRole);\n      res.json({ message: \"Purchase order deleted successfully\" });\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('Access denied')) {\n        return res.status(403).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to delete purchase order\" });\n    }\n  });\n\n  app.post(\"/api/purchase-orders\", requireAuth, requireRole(['admin', 'manager']), async (req, res) => {\n    try {\n      const { order, items } = req.body;\n      \n      const validatedOrder = insertPurchaseOrderSchema.parse(order);\n      const createdOrder = await storage.createPurchaseOrder(validatedOrder);\n      \n      const createdItems = [];\n      for (const item of items) {\n        const validatedItem = insertPurchaseOrderItemSchema.parse({\n          ...item,\n          orderId: createdOrder.id\n        });\n        const createdItem = await storage.createPurchaseOrderItem(validatedItem);\n        createdItems.push(createdItem);\n      }\n      \n      res.status(201).json({ order: createdOrder, items: createdItems });\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid purchase order data\" });\n    }\n  });\n\n  // Expenses routes\n  app.get(\"/api/expenses/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const expenses = await storage.getExpenses(stationId);\n      res.json(expenses);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch expenses\" });\n    }\n  });\n\n  app.delete(\"/api/expenses/:stationId/:id\", requireAuth, requireRole(['admin', 'manager']), requireStationAccess, async (req, res) => {\n    try {\n      const { id, stationId } = req.params;\n      await storage.deleteExpense(id, stationId);\n      res.json({ message: \"Expense deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete expense\" });\n    }\n  });\n\n  app.post(\"/api/expenses\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = insertExpenseSchema.parse(req.body);\n      const expense = await storage.createExpense(validatedData);\n      res.status(201).json(expense);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid expense data\" });\n    }\n  });\n\n  // Payments routes\n  app.get(\"/api/payments/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const payments = await storage.getPayments(stationId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch payments\" });\n    }\n  });\n\n  app.delete(\"/api/payments/:stationId/:id\", requireAuth, requireRole(['admin', 'manager']), requireStationAccess, async (req, res) => {\n    try {\n      const { id, stationId } = req.params;\n      await storage.deletePayment(id, stationId);\n      res.json({ message: \"Payment deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete payment\" });\n    }\n  });\n\n  app.post(\"/api/payments\", requireAuth, async (req, res) => {\n    try {\n      // Validate that user has stationId for security\n      if (!req.user.stationId) {\n        return res.status(400).json({ message: \"User must be assigned to a station to record payments\" });\n      }\n\n      // Extract only allowed fields from client, ignore userId/stationId\n      const { customerId, supplierId, amount, currencyCode, paymentMethod, referenceNumber, notes, type } = req.body;\n      \n      // Use server-side attribution from authenticated user\n      const paymentData = {\n        customerId,\n        supplierId,\n        amount,\n        currencyCode: currencyCode || 'PKR',\n        paymentMethod,\n        referenceNumber,\n        notes,\n        type,\n        // Server-side attribution - never trust client\n        userId: req.user.id,\n        stationId: req.user.stationId\n      };\n\n      const payment = await storage.createPayment(paymentData);\n      res.status(201).json(payment);\n    } catch (error) {\n      console.error('Payment creation error:', error);\n      res.status(400).json({ message: \"Invalid payment data\" });\n    }\n  });\n\n  // Dashboard stats\n  app.get(\"/api/dashboard/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const stats = await storage.getDashboardStats(stationId);\n      console.log('Dashboard stats:', JSON.stringify(stats, null, 2));\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  // Reports\n  app.get(\"/api/reports/sales/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const { startDate, endDate } = req.query;\n      \n      const report = await storage.getSalesReport(\n        stationId,\n        new Date(startDate as string),\n        new Date(endDate as string)\n      );\n      res.json(report);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate sales report\" });\n    }\n  });\n\n  app.get(\"/api/reports/financial/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const { startDate, endDate } = req.query;\n      \n      const report = await storage.getFinancialReport(\n        stationId,\n        new Date(startDate as string),\n        new Date(endDate as string)\n      );\n      res.json(report);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate financial report\" });\n    }\n  });\n\n  app.get(\"/api/reports/daily/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const { date } = req.query;\n      \n      const report = await storage.getDailyReport(\n        stationId,\n        date ? new Date(date as string) : new Date()\n      );\n      res.json(report);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate daily report\" });\n    }\n  });\n\n  app.get(\"/api/reports/aging/:stationId\", requireAuth, requireStationAccess, async (req, res) => {\n    try {\n      const { stationId } = req.params;\n      const { type } = req.query;\n      \n      if (!type || (type !== 'receivable' && type !== 'payable')) {\n        return res.status(400).json({ message: \"Type parameter must be 'receivable' or 'payable'\" });\n      }\n      \n      const report = await storage.getAgingReport(stationId, type as 'receivable' | 'payable');\n      res.json(report);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate aging report\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":23850},"server/storage.ts":{"content":"import { \n  users, stations, products, tanks, customers, suppliers, \n  salesTransactions, salesTransactionItems, purchaseOrders, purchaseOrderItems,\n  expenses, payments, stockMovements, priceHistory, settings,\n  type User, type InsertUser, type Station, type InsertStation,\n  type Product, type InsertProduct, type Tank, type InsertTank,\n  type Customer, type InsertCustomer, type Supplier, type InsertSupplier,\n  type SalesTransaction, type InsertSalesTransaction,\n  type SalesTransactionItem, type InsertSalesTransactionItem,\n  type PurchaseOrder, type InsertPurchaseOrder,\n  type PurchaseOrderItem, type InsertPurchaseOrderItem,\n  type Expense, type InsertExpense, type Payment, type InsertPayment,\n  type StockMovement, type InsertStockMovement,\n  type PriceHistory, type InsertPriceHistory,\n  type Settings, type InsertSettings\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, sql, and, gte, lte, sum } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Stations\n  getStation(id: string): Promise<Station | undefined>;\n  getStations(): Promise<Station[]>;\n  createStation(station: InsertStation): Promise<Station>;\n  \n  // Products\n  getProducts(): Promise<Product[]>;\n  getProduct(id: string): Promise<Product | undefined>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: string, product: Partial<InsertProduct>): Promise<Product>;\n  \n  // Tanks\n  getTanksByStation(stationId: string): Promise<(Tank & { product: Product })[]>;\n  getTank(id: string): Promise<Tank | undefined>;\n  createTank(tank: InsertTank): Promise<Tank>;\n  updateTankStock(id: string, currentStock: number): Promise<Tank>;\n  \n  // Customers\n  getCustomers(): Promise<Customer[]>;\n  getCustomer(id: string): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(id: string, customer: Partial<InsertCustomer>): Promise<Customer>;\n  updateCustomerOutstanding(customerId: string, additionalAmount: number): Promise<void>;\n  \n  // Suppliers\n  getSuppliers(): Promise<Supplier[]>;\n  getSupplier(id: string): Promise<Supplier | undefined>;\n  createSupplier(supplier: InsertSupplier): Promise<Supplier>;\n  updateSupplier(id: string, supplier: Partial<InsertSupplier>): Promise<Supplier>;\n  updateSupplierOutstanding(supplierId: string, additionalAmount: number): Promise<void>;\n  \n  // Sales Transactions\n  getSalesTransactions(stationId: string, limit?: number): Promise<SalesTransaction[]>;\n  getSalesTransaction(id: string): Promise<SalesTransaction | undefined>;\n  getSalesTransactionWithItems(id: string): Promise<(SalesTransaction & { items: (SalesTransactionItem & { product: Product })[], customer: Customer, station: Station, user: User }) | undefined>;\n  getSalesTransactionWithItemsSecure(id: string, userStationId: string, userRole: string): Promise<(SalesTransaction & { items: (SalesTransactionItem & { product: Product })[], customer: Customer, station: Station, user: User }) | undefined>;\n  createSalesTransaction(transaction: InsertSalesTransaction): Promise<SalesTransaction>;\n  deleteSalesTransaction(id: string): Promise<void>;\n  deleteSalesTransactionSecure(id: string, userStationId: string, userRole: string): Promise<void>;\n  \n  // Sales Transaction Items\n  createSalesTransactionItem(item: InsertSalesTransactionItem): Promise<SalesTransactionItem>;\n  getSalesTransactionItems(transactionId: string): Promise<SalesTransactionItem[]>;\n  \n  // Purchase Orders\n  getPurchaseOrders(stationId: string): Promise<PurchaseOrder[]>;\n  getPurchaseOrder(id: string): Promise<PurchaseOrder | undefined>;\n  getPurchaseOrderWithItems(id: string): Promise<(PurchaseOrder & { items: PurchaseOrderItem[], supplier: Supplier, station: Station }) | undefined>;\n  getPurchaseOrderWithItemsSecure(id: string, userStationId: string, userRole: string): Promise<(PurchaseOrder & { items: PurchaseOrderItem[], supplier: Supplier, station: Station }) | undefined>;\n  createPurchaseOrder(order: InsertPurchaseOrder): Promise<PurchaseOrder>;\n  deletePurchaseOrder(id: string): Promise<void>;\n  deletePurchaseOrderSecure(id: string, userStationId: string, userRole: string): Promise<void>;\n  \n  // Purchase Order Items\n  createPurchaseOrderItem(item: InsertPurchaseOrderItem): Promise<PurchaseOrderItem>;\n  \n  // Expenses\n  getExpenses(stationId: string): Promise<Expense[]>;\n  createExpense(expense: InsertExpense): Promise<Expense>;\n  \n  // Payments\n  getPayments(stationId: string): Promise<Payment[]>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  \n  // Stock Movements\n  getStockMovements(tankId: string): Promise<StockMovement[]>;\n  createStockMovement(movement: InsertStockMovement): Promise<StockMovement>;\n  \n  // Reports and Analytics\n  getDashboardStats(stationId: string): Promise<any>;\n  getSalesReport(stationId: string, startDate: Date, endDate: Date): Promise<any>;\n  getFinancialReport(stationId: string, startDate: Date, endDate: Date): Promise<any>;\n  getDailyReport(stationId: string, date: Date): Promise<any>;\n  getAgingReport(stationId: string, type: 'receivable' | 'payable'): Promise<any>;\n  deletePayment(id: string, stationId: string): Promise<void>;\n  deleteExpense(id: string, stationId: string): Promise<void>;\n  \n  // Settings\n  getSettings(stationId: string): Promise<Settings | undefined>;\n  createSettings(settings: InsertSettings): Promise<Settings>;\n  updateSettings(stationId: string, settings: Partial<InsertSettings>): Promise<Settings>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(insertUser).returning();\n    return user;\n  }\n\n  async getStation(id: string): Promise<Station | undefined> {\n    const [station] = await db.select().from(stations).where(eq(stations.id, id));\n    return station || undefined;\n  }\n\n  async getStations(): Promise<Station[]> {\n    return await db.select().from(stations).where(eq(stations.isActive, true));\n  }\n\n  async createStation(insertStation: InsertStation): Promise<Station> {\n    const [station] = await db.insert(stations).values(insertStation).returning();\n    return station;\n  }\n\n  async getProducts(): Promise<Product[]> {\n    return await db.select().from(products).where(eq(products.isActive, true));\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product || undefined;\n  }\n\n  async createProduct(insertProduct: InsertProduct): Promise<Product> {\n    const [product] = await db.insert(products).values(insertProduct).returning();\n    return product;\n  }\n\n  async updateProduct(id: string, productData: Partial<InsertProduct>): Promise<Product> {\n    const [product] = await db.update(products)\n      .set({ ...productData })\n      .where(eq(products.id, id))\n      .returning();\n    return product;\n  }\n\n  async getTanksByStation(stationId: string): Promise<(Tank & { product: Product })[]> {\n    const result = await db\n      .select({\n        // Tank fields\n        id: tanks.id,\n        stationId: tanks.stationId,\n        name: tanks.name,\n        productId: tanks.productId,\n        capacity: tanks.capacity,\n        currentStock: tanks.currentStock,\n        minimumLevel: tanks.minimumLevel,\n        status: tanks.status,\n        lastRefillDate: tanks.lastRefillDate,\n        createdAt: tanks.createdAt,\n        // Product fields (nested)\n        product: {\n          id: products.id,\n          name: products.name,\n          category: products.category,\n          unit: products.unit,\n          currentPrice: products.currentPrice,\n          density: products.density,\n          hsnCode: products.hsnCode,\n          taxRate: products.taxRate,\n          isActive: products.isActive,\n          createdAt: products.createdAt\n        }\n      })\n      .from(tanks)\n      .innerJoin(products, eq(tanks.productId, products.id))\n      .where(eq(tanks.stationId, stationId));\n    \n    return result as (Tank & { product: Product })[];\n  }\n\n  async getTank(id: string): Promise<Tank | undefined> {\n    const [tank] = await db.select().from(tanks).where(eq(tanks.id, id));\n    return tank || undefined;\n  }\n\n  async createTank(insertTank: InsertTank): Promise<Tank> {\n    const [tank] = await db.insert(tanks).values(insertTank).returning();\n    return tank;\n  }\n\n  async updateTankStock(id: string, currentStock: number): Promise<Tank> {\n    const [tank] = await db.update(tanks)\n      .set({ currentStock: currentStock.toString() })\n      .where(eq(tanks.id, id))\n      .returning();\n    return tank;\n  }\n\n  async getCustomers(): Promise<Customer[]> {\n    return await db.select().from(customers).where(eq(customers.isActive, true));\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    const [customer] = await db.select().from(customers).where(eq(customers.id, id));\n    return customer || undefined;\n  }\n\n  async createCustomer(insertCustomer: InsertCustomer): Promise<Customer> {\n    const [customer] = await db.insert(customers).values(insertCustomer).returning();\n    return customer;\n  }\n\n  async updateCustomer(id: string, customerData: Partial<InsertCustomer>): Promise<Customer> {\n    const [customer] = await db.update(customers)\n      .set(customerData)\n      .where(eq(customers.id, id))\n      .returning();\n    return customer;\n  }\n\n  async updateCustomerOutstanding(customerId: string, additionalAmount: number): Promise<void> {\n    try {\n      const result = await db.update(customers)\n        .set({ \n          outstandingAmount: sql`${customers.outstandingAmount} + ${additionalAmount}` \n        })\n        .where(eq(customers.id, customerId))\n        .returning({ id: customers.id });\n        \n      if (result.length === 0) {\n        throw new Error(`Customer ${customerId} not found`);\n      }\n    } catch (error) {\n      throw new Error(`Failed to update customer outstanding amount: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async updateSupplierOutstanding(supplierId: string, additionalAmount: number): Promise<void> {\n    try {\n      const result = await db.update(suppliers)\n        .set({ \n          outstandingAmount: sql`${suppliers.outstandingAmount} + ${additionalAmount}` \n        })\n        .where(eq(suppliers.id, supplierId))\n        .returning({ id: suppliers.id });\n        \n      if (result.length === 0) {\n        throw new Error(`Supplier ${supplierId} not found`);\n      }\n    } catch (error) {\n      throw new Error(`Failed to update supplier outstanding amount: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async getSuppliers(): Promise<Supplier[]> {\n    return await db.select().from(suppliers).where(eq(suppliers.isActive, true));\n  }\n\n  async getSupplier(id: string): Promise<Supplier | undefined> {\n    const [supplier] = await db.select().from(suppliers).where(eq(suppliers.id, id));\n    return supplier || undefined;\n  }\n\n  async createSupplier(insertSupplier: InsertSupplier): Promise<Supplier> {\n    const [supplier] = await db.insert(suppliers).values(insertSupplier).returning();\n    return supplier;\n  }\n\n  async updateSupplier(id: string, supplierData: Partial<InsertSupplier>): Promise<Supplier> {\n    const [supplier] = await db.update(suppliers)\n      .set(supplierData)\n      .where(eq(suppliers.id, id))\n      .returning();\n    if (!supplier) throw new Error(\"Supplier not found\");\n    return supplier;\n  }\n\n  async getSalesTransactions(stationId: string, limit = 50): Promise<SalesTransaction[]> {\n    return await db.select()\n      .from(salesTransactions)\n      .where(eq(salesTransactions.stationId, stationId))\n      .orderBy(desc(salesTransactions.transactionDate))\n      .limit(limit);\n  }\n\n  async getSalesTransaction(id: string): Promise<SalesTransaction | undefined> {\n    const [transaction] = await db.select().from(salesTransactions).where(eq(salesTransactions.id, id));\n    return transaction || undefined;\n  }\n\n  async createSalesTransaction(insertTransaction: InsertSalesTransaction): Promise<SalesTransaction> {\n    try {\n      const [transaction] = await db.insert(salesTransactions).values(insertTransaction).returning();\n      return transaction;\n    } catch (error) {\n      throw new Error(`Failed to create sales transaction: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async createSalesTransactionItem(insertItem: InsertSalesTransactionItem): Promise<SalesTransactionItem> {\n    const [item] = await db.insert(salesTransactionItems).values(insertItem).returning();\n    return item;\n  }\n\n  async getSalesTransactionItems(transactionId: string): Promise<SalesTransactionItem[]> {\n    return await db.select()\n      .from(salesTransactionItems)\n      .where(eq(salesTransactionItems.transactionId, transactionId));\n  }\n\n  async getPurchaseOrders(stationId: string): Promise<PurchaseOrder[]> {\n    return await db.select()\n      .from(purchaseOrders)\n      .where(eq(purchaseOrders.stationId, stationId))\n      .orderBy(desc(purchaseOrders.orderDate));\n  }\n\n  async createPurchaseOrder(insertOrder: InsertPurchaseOrder): Promise<PurchaseOrder> {\n    try {\n      const [order] = await db.insert(purchaseOrders).values(insertOrder).returning();\n      return order;\n    } catch (error) {\n      throw new Error(`Failed to create purchase order: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async createPurchaseOrderItem(insertItem: InsertPurchaseOrderItem): Promise<PurchaseOrderItem> {\n    const [item] = await db.insert(purchaseOrderItems).values(insertItem).returning();\n    return item;\n  }\n\n  async getExpenses(stationId: string): Promise<Expense[]> {\n    return await db.select()\n      .from(expenses)\n      .where(eq(expenses.stationId, stationId))\n      .orderBy(desc(expenses.expenseDate));\n  }\n\n  async createExpense(insertExpense: InsertExpense): Promise<Expense> {\n    const [expense] = await db.insert(expenses).values(insertExpense).returning();\n    return expense;\n  }\n\n  async getPayments(stationId: string): Promise<Payment[]> {\n    return await db.select()\n      .from(payments)\n      .where(eq(payments.stationId, stationId))\n      .orderBy(desc(payments.paymentDate));\n  }\n\n  async createPayment(insertPayment: InsertPayment): Promise<Payment> {\n    try {\n      // Start a transaction to ensure atomicity\n      const result = await db.transaction(async (tx) => {\n        // Create the payment record\n        const [payment] = await tx.insert(payments).values(insertPayment).returning();\n        \n        // Update outstanding amounts based on payment type\n        const paymentAmount = parseFloat(payment.amount);\n        \n        if (payment.type === 'receivable' && payment.customerId) {\n          // Customer payment - reduce customer's outstanding amount\n          await tx.update(customers)\n            .set({ \n              outstandingAmount: sql`${customers.outstandingAmount} - ${paymentAmount}` \n            })\n            .where(eq(customers.id, payment.customerId));\n        } else if (payment.type === 'payable' && payment.supplierId) {\n          // Supplier payment - reduce supplier's outstanding amount\n          await tx.update(suppliers)\n            .set({ \n              outstandingAmount: sql`${suppliers.outstandingAmount} - ${paymentAmount}` \n            })\n            .where(eq(suppliers.id, payment.supplierId));\n        }\n        \n        return payment;\n      });\n      \n      return result;\n    } catch (error) {\n      throw new Error(`Failed to create payment and update outstanding amounts: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async getStockMovements(tankId: string): Promise<StockMovement[]> {\n    return await db.select()\n      .from(stockMovements)\n      .where(eq(stockMovements.tankId, tankId))\n      .orderBy(desc(stockMovements.movementDate));\n  }\n\n  async createStockMovement(insertMovement: InsertStockMovement): Promise<StockMovement & { updatedTank?: Tank }> {\n    return await db.transaction(async (tx) => {\n      // Get current tank stock\n      const [currentTank] = await tx.select().from(tanks).where(eq(tanks.id, insertMovement.tankId));\n      if (!currentTank) {\n        throw new Error(`Tank ${insertMovement.tankId} not found`);\n      }\n\n      const currentStock = parseFloat(currentTank.currentStock || '0');\n      const movementQuantity = parseFloat(insertMovement.quantity);\n      \n      // Calculate new stock based on movement type\n      let newStock: number;\n      switch (insertMovement.movementType) {\n        case 'in':\n          newStock = currentStock + Math.abs(movementQuantity);\n          break;\n        case 'out':\n          newStock = Math.max(0, currentStock - Math.abs(movementQuantity));\n          break;\n        case 'adjustment':\n          // For adjustments, quantity can be positive or negative\n          newStock = Math.max(0, currentStock + movementQuantity);\n          break;\n        case 'transfer':\n          // For transfers, this handles the source tank (out)\n          newStock = Math.max(0, currentStock - Math.abs(movementQuantity));\n          break;\n        case 'audit':\n          // For audits, the new quantity IS the new stock (not a delta)\n          newStock = Math.max(0, Math.abs(movementQuantity));\n          break;\n        default:\n          throw new Error(`Invalid movement type: ${insertMovement.movementType}`);\n      }\n\n      // Create stock movement record with correct values\n      const movementData = {\n        ...insertMovement,\n        previousStock: currentStock.toString(),\n        newStock: newStock.toString(),\n      };\n      \n      const [movement] = await tx.insert(stockMovements).values(movementData).returning();\n      \n      // Update tank stock and set last refill date if it's an 'in' movement\n      const updateData: any = { currentStock: newStock.toString() };\n      if (insertMovement.movementType === 'in') {\n        updateData.lastRefillDate = new Date();\n      }\n      \n      const [updatedTank] = await tx.update(tanks)\n        .set(updateData)\n        .where(eq(tanks.id, insertMovement.tankId))\n        .returning();\n\n      return {\n        ...movement,\n        updatedTank\n      };\n    });\n  }\n\n  async getDashboardStats(stationId: string): Promise<any> {\n    const today = new Date();\n    const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);\n\n    // Today's sales\n    const todaysSales = await db\n      .select({\n        totalAmount: sum(salesTransactions.totalAmount),\n        count: sql<number>`count(*)`,\n      })\n      .from(salesTransactions)\n      .where(\n        and(\n          eq(salesTransactions.stationId, stationId),\n          gte(salesTransactions.transactionDate, startOfDay)\n        )\n      );\n\n    // Monthly sales\n    const monthlySales = await db\n      .select({\n        totalAmount: sum(salesTransactions.totalAmount),\n        count: sql<number>`count(*)`,\n      })\n      .from(salesTransactions)\n      .where(\n        and(\n          eq(salesTransactions.stationId, stationId),\n          gte(salesTransactions.transactionDate, startOfMonth)\n        )\n      );\n\n    // Outstanding amount from customers\n    const outstanding = await db\n      .select({\n        totalOutstanding: sum(customers.outstandingAmount),\n      })\n      .from(customers);\n\n    return {\n      todaysSales: todaysSales[0],\n      monthlySales: monthlySales[0],\n      outstanding: outstanding[0],\n    };\n  }\n\n  async getSalesReport(stationId: string, startDate: Date, endDate: Date): Promise<any> {\n    return await db\n      .select({\n        date: salesTransactions.transactionDate,\n        totalAmount: sum(salesTransactions.totalAmount),\n        transactionCount: sql<number>`count(*)`,\n      })\n      .from(salesTransactions)\n      .where(\n        and(\n          eq(salesTransactions.stationId, stationId),\n          gte(salesTransactions.transactionDate, startDate),\n          lte(salesTransactions.transactionDate, endDate)\n        )\n      )\n      .groupBy(salesTransactions.transactionDate)\n      .orderBy(salesTransactions.transactionDate);\n  }\n\n  async getFinancialReport(stationId: string, startDate: Date, endDate: Date): Promise<any> {\n    // Revenue\n    const revenue = await db\n      .select({\n        totalRevenue: sum(salesTransactions.totalAmount),\n      })\n      .from(salesTransactions)\n      .where(\n        and(\n          eq(salesTransactions.stationId, stationId),\n          gte(salesTransactions.transactionDate, startDate),\n          lte(salesTransactions.transactionDate, endDate)\n        )\n      );\n\n    // Expenses\n    const expenseData = await db\n      .select({\n        totalExpenses: sum(expenses.amount),\n      })\n      .from(expenses)\n      .where(\n        and(\n          eq(expenses.stationId, stationId),\n          gte(expenses.expenseDate, startDate),\n          lte(expenses.expenseDate, endDate)\n        )\n      );\n\n    return {\n      revenue: revenue[0],\n      expenses: expenseData[0],\n    };\n  }\n\n  async getSalesTransactionWithItems(id: string): Promise<(SalesTransaction & { items: (SalesTransactionItem & { product: Product })[], customer: Customer, station: Station, user: User }) | undefined> {\n    const transaction = await db\n      .select()\n      .from(salesTransactions)\n      .leftJoin(customers, eq(salesTransactions.customerId, customers.id))\n      .leftJoin(stations, eq(salesTransactions.stationId, stations.id))\n      .leftJoin(users, eq(salesTransactions.userId, users.id))\n      .where(eq(salesTransactions.id, id))\n      .then(results => results[0]);\n\n    if (!transaction) return undefined;\n    \n    // Ensure customer, station, and user exist - if not, the data is inconsistent\n    if (!transaction.customers || !transaction.stations || !transaction.users) {\n      throw new Error(`Sales transaction ${id} has missing customer, station, or user data`);\n    }\n\n    const itemsWithProducts = await db\n      .select({\n        // SalesTransactionItem fields\n        id: salesTransactionItems.id,\n        transactionId: salesTransactionItems.transactionId,\n        productId: salesTransactionItems.productId,\n        tankId: salesTransactionItems.tankId,\n        quantity: salesTransactionItems.quantity,\n        unitPrice: salesTransactionItems.unitPrice,\n        totalPrice: salesTransactionItems.totalPrice,\n        createdAt: salesTransactionItems.createdAt,\n        // Product fields (nested)\n        product: {\n          id: products.id,\n          name: products.name,\n          category: products.category,\n          unit: products.unit,\n          currentPrice: products.currentPrice,\n          density: products.density,\n          hsnCode: products.hsnCode,\n          taxRate: products.taxRate,\n          isActive: products.isActive,\n          createdAt: products.createdAt\n        }\n      })\n      .from(salesTransactionItems)\n      .innerJoin(products, eq(salesTransactionItems.productId, products.id))\n      .where(eq(salesTransactionItems.transactionId, id));\n\n    return {\n      ...transaction.sales_transactions,\n      items: itemsWithProducts as (SalesTransactionItem & { product: Product })[],\n      customer: transaction.customers,\n      station: transaction.stations,\n      user: transaction.users\n    };\n  }\n\n  async getSalesTransactionWithItemsSecure(id: string, userStationId: string, userRole: string): Promise<(SalesTransaction & { items: (SalesTransactionItem & { product: Product })[], customer: Customer, station: Station, user: User }) | undefined> {\n    const transaction = await db\n      .select()\n      .from(salesTransactions)\n      .leftJoin(customers, eq(salesTransactions.customerId, customers.id))\n      .leftJoin(stations, eq(salesTransactions.stationId, stations.id))\n      .leftJoin(users, eq(salesTransactions.userId, users.id))\n      .where(eq(salesTransactions.id, id))\n      .then(results => results[0]);\n\n    if (!transaction) return undefined;\n    \n    // Ensure customer, station, and user exist - if not, the data is inconsistent\n    if (!transaction.customers || !transaction.stations || !transaction.users) {\n      throw new Error(`Sales transaction ${id} has missing customer, station, or user data`);\n    }\n\n    // Security check: verify the transaction belongs to the user's station (admins can access all)\n    if (userRole !== 'admin' && transaction.sales_transactions.stationId !== userStationId) {\n      throw new Error('Access denied: Transaction does not belong to your station');\n    }\n\n    const itemsWithProducts = await db\n      .select({\n        // SalesTransactionItem fields\n        id: salesTransactionItems.id,\n        transactionId: salesTransactionItems.transactionId,\n        productId: salesTransactionItems.productId,\n        tankId: salesTransactionItems.tankId,\n        quantity: salesTransactionItems.quantity,\n        unitPrice: salesTransactionItems.unitPrice,\n        totalPrice: salesTransactionItems.totalPrice,\n        createdAt: salesTransactionItems.createdAt,\n        // Product fields (nested)\n        product: {\n          id: products.id,\n          name: products.name,\n          category: products.category,\n          unit: products.unit,\n          currentPrice: products.currentPrice,\n          density: products.density,\n          hsnCode: products.hsnCode,\n          taxRate: products.taxRate,\n          isActive: products.isActive,\n          createdAt: products.createdAt\n        }\n      })\n      .from(salesTransactionItems)\n      .innerJoin(products, eq(salesTransactionItems.productId, products.id))\n      .where(eq(salesTransactionItems.transactionId, id));\n\n    return {\n      ...transaction.sales_transactions,\n      items: itemsWithProducts as (SalesTransactionItem & { product: Product })[],\n      customer: transaction.customers,\n      station: transaction.stations,\n      user: transaction.users\n    };\n  }\n\n  async deleteSalesTransaction(id: string): Promise<void> {\n    await db.transaction(async (tx) => {\n      // Delete related transaction items first\n      await tx.delete(salesTransactionItems).where(eq(salesTransactionItems.transactionId, id));\n      \n      // Delete the transaction\n      await tx.delete(salesTransactions).where(eq(salesTransactions.id, id));\n    });\n  }\n\n  async deleteSalesTransactionSecure(id: string, userStationId: string, userRole: string): Promise<void> {\n    await db.transaction(async (tx) => {\n      // First verify the transaction belongs to the user's station (unless admin)\n      if (userRole !== 'admin') {\n        const [transaction] = await tx.select({ stationId: salesTransactions.stationId })\n          .from(salesTransactions)\n          .where(eq(salesTransactions.id, id));\n        \n        if (!transaction) {\n          throw new Error('Sales transaction not found');\n        }\n        \n        if (transaction.stationId !== userStationId) {\n          throw new Error('Access denied: Transaction does not belong to your station');\n        }\n      }\n      \n      // Delete related transaction items first\n      await tx.delete(salesTransactionItems).where(eq(salesTransactionItems.transactionId, id));\n      \n      // Delete the transaction\n      const result = await tx.delete(salesTransactions).where(eq(salesTransactions.id, id)).returning({ id: salesTransactions.id });\n      \n      if (result.length === 0) {\n        throw new Error('Sales transaction not found');\n      }\n    });\n  }\n\n  async getPurchaseOrder(id: string): Promise<PurchaseOrder | undefined> {\n    const [order] = await db.select().from(purchaseOrders).where(eq(purchaseOrders.id, id));\n    return order || undefined;\n  }\n\n  async deletePurchaseOrder(id: string): Promise<void> {\n    await db.transaction(async (tx) => {\n      // Delete related order items first\n      await tx.delete(purchaseOrderItems).where(eq(purchaseOrderItems.orderId, id));\n      \n      // Delete the purchase order\n      await tx.delete(purchaseOrders).where(eq(purchaseOrders.id, id));\n    });\n  }\n\n  async getPurchaseOrderWithItems(id: string): Promise<(PurchaseOrder & { items: PurchaseOrderItem[], supplier: Supplier, station: Station }) | undefined> {\n    const order = await db\n      .select()\n      .from(purchaseOrders)\n      .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n      .leftJoin(stations, eq(purchaseOrders.stationId, stations.id))\n      .where(eq(purchaseOrders.id, id))\n      .then(results => results[0]);\n\n    if (!order) return undefined;\n    \n    // Ensure supplier and station exist - if not, the data is inconsistent\n    if (!order.suppliers || !order.stations) {\n      throw new Error(`Purchase order ${id} has missing supplier or station data`);\n    }\n\n    const items = await db\n      .select()\n      .from(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.orderId, id));\n\n    return {\n      ...order.purchase_orders,\n      items,\n      supplier: order.suppliers,\n      station: order.stations\n    };\n  }\n\n  async getPurchaseOrderWithItemsSecure(id: string, userStationId: string, userRole: string): Promise<(PurchaseOrder & { items: PurchaseOrderItem[], supplier: Supplier, station: Station }) | undefined> {\n    const order = await db\n      .select()\n      .from(purchaseOrders)\n      .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n      .leftJoin(stations, eq(purchaseOrders.stationId, stations.id))\n      .where(eq(purchaseOrders.id, id))\n      .then(results => results[0]);\n\n    if (!order) return undefined;\n    \n    // Ensure supplier and station exist - if not, the data is inconsistent\n    if (!order.suppliers || !order.stations) {\n      throw new Error(`Purchase order ${id} has missing supplier or station data`);\n    }\n\n    // Security check: verify the order belongs to the user's station (admins can access all)\n    if (userRole !== 'admin' && order.purchase_orders.stationId !== userStationId) {\n      throw new Error('Access denied: Purchase order does not belong to your station');\n    }\n\n    const items = await db\n      .select()\n      .from(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.orderId, id));\n\n    return {\n      ...order.purchase_orders,\n      items,\n      supplier: order.suppliers,\n      station: order.stations\n    };\n  }\n\n  async deletePurchaseOrderSecure(id: string, userStationId: string, userRole: string): Promise<void> {\n    await db.transaction(async (tx) => {\n      // First verify the order belongs to the user's station (unless admin)\n      if (userRole !== 'admin') {\n        const [order] = await tx.select({ stationId: purchaseOrders.stationId })\n          .from(purchaseOrders)\n          .where(eq(purchaseOrders.id, id));\n        \n        if (!order) {\n          throw new Error('Purchase order not found');\n        }\n        \n        if (order.stationId !== userStationId) {\n          throw new Error('Access denied: Purchase order does not belong to your station');\n        }\n      }\n      \n      // Delete related order items first\n      await tx.delete(purchaseOrderItems).where(eq(purchaseOrderItems.orderId, id));\n      \n      // Delete the purchase order\n      const result = await tx.delete(purchaseOrders).where(eq(purchaseOrders.id, id)).returning({ id: purchaseOrders.id });\n      \n      if (result.length === 0) {\n        throw new Error('Purchase order not found');\n      }\n    });\n  }\n\n  async getDailyReport(stationId: string, date: Date): Promise<any> {\n    const startOfDay = new Date(date);\n    startOfDay.setHours(0, 0, 0, 0);\n    const endOfDay = new Date(date);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    // Sales by payment method\n    const salesByMethod = await db\n      .select({\n        paymentMethod: salesTransactions.paymentMethod,\n        totalAmount: sum(salesTransactions.totalAmount),\n        count: sql<number>`count(*)`,\n        currencyCode: salesTransactions.currencyCode\n      })\n      .from(salesTransactions)\n      .where(\n        and(\n          eq(salesTransactions.stationId, stationId),\n          gte(salesTransactions.transactionDate, startOfDay),\n          lte(salesTransactions.transactionDate, endOfDay)\n        )\n      )\n      .groupBy(salesTransactions.paymentMethod, salesTransactions.currencyCode);\n\n    // Expenses\n    const dailyExpenses = await db\n      .select({\n        category: expenses.category,\n        totalAmount: sum(expenses.amount),\n        currencyCode: expenses.currencyCode\n      })\n      .from(expenses)\n      .where(\n        and(\n          eq(expenses.stationId, stationId),\n          gte(expenses.expenseDate, startOfDay),\n          lte(expenses.expenseDate, endOfDay)\n        )\n      )\n      .groupBy(expenses.category, expenses.currencyCode);\n\n    return {\n      date,\n      salesByMethod,\n      expenses: dailyExpenses\n    };\n  }\n\n  async getAgingReport(stationId: string, type: 'receivable' | 'payable'): Promise<any> {\n    try {\n      if (type === 'receivable') {\n        // Get all outstanding receivables\n        const receivables = await db\n          .select({\n            id: salesTransactions.id,\n            invoiceNumber: salesTransactions.invoiceNumber,\n            customerName: customers.name,\n            transactionDate: salesTransactions.transactionDate,\n            dueDate: salesTransactions.dueDate,\n            totalAmount: salesTransactions.totalAmount,\n            paidAmount: salesTransactions.paidAmount,\n            outstandingAmount: salesTransactions.outstandingAmount,\n            currencyCode: salesTransactions.currencyCode,\n            daysOverdue: sql<number>`CASE \n              WHEN ${salesTransactions.dueDate} IS NULL THEN 0\n              WHEN ${salesTransactions.dueDate} < CURRENT_DATE THEN EXTRACT(day FROM CURRENT_DATE - ${salesTransactions.dueDate})::integer\n              ELSE 0\n            END`\n          })\n          .from(salesTransactions)\n          .leftJoin(customers, eq(salesTransactions.customerId, customers.id))\n          .where(\n            and(\n              eq(salesTransactions.stationId, stationId),\n              sql`${salesTransactions.outstandingAmount} > 0`\n            )\n          )\n          .orderBy(salesTransactions.dueDate);\n\n        // Group into age buckets\n        const buckets = {\n          current: receivables.filter(r => r.daysOverdue <= 0),\n          days30: receivables.filter(r => r.daysOverdue > 0 && r.daysOverdue <= 30),\n          days60: receivables.filter(r => r.daysOverdue > 30 && r.daysOverdue <= 60),\n          days90: receivables.filter(r => r.daysOverdue > 60 && r.daysOverdue <= 90),\n          over90: receivables.filter(r => r.daysOverdue > 90)\n        };\n\n        // Calculate totals for each bucket\n        const totals = {\n          current: buckets.current.reduce((sum, r) => sum + Number(r.outstandingAmount), 0),\n          days30: buckets.days30.reduce((sum, r) => sum + Number(r.outstandingAmount), 0),\n          days60: buckets.days60.reduce((sum, r) => sum + Number(r.outstandingAmount), 0),\n          days90: buckets.days90.reduce((sum, r) => sum + Number(r.outstandingAmount), 0),\n          over90: buckets.over90.reduce((sum, r) => sum + Number(r.outstandingAmount), 0)\n        };\n\n        return {\n          type: 'receivable',\n          buckets,\n          totals,\n          grandTotal: Object.values(totals).reduce((sum, total) => sum + total, 0),\n          details: receivables\n        };\n\n      } else {\n        // Get all outstanding payables\n        const payables = await db\n          .select({\n            id: purchaseOrders.id,\n            orderNumber: purchaseOrders.orderNumber,\n            supplierName: suppliers.name,\n            orderDate: purchaseOrders.orderDate,\n            dueDate: purchaseOrders.dueDate,\n            totalAmount: purchaseOrders.totalAmount,\n            paidAmount: purchaseOrders.paidAmount,\n            outstandingAmount: sql<string>`${purchaseOrders.totalAmount} - ${purchaseOrders.paidAmount}`,\n            currencyCode: purchaseOrders.currencyCode,\n            daysOverdue: sql<number>`CASE \n              WHEN ${purchaseOrders.dueDate} IS NULL THEN 0\n              WHEN ${purchaseOrders.dueDate} < CURRENT_DATE THEN EXTRACT(day FROM CURRENT_DATE - ${purchaseOrders.dueDate})::integer\n              ELSE 0\n            END`\n          })\n          .from(purchaseOrders)\n          .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n          .where(\n            and(\n              eq(purchaseOrders.stationId, stationId),\n              sql`${purchaseOrders.totalAmount} - ${purchaseOrders.paidAmount} > 0`\n            )\n          )\n          .orderBy(purchaseOrders.dueDate);\n\n        // Group into age buckets\n        const buckets = {\n          current: payables.filter(p => p.daysOverdue <= 0),\n          days30: payables.filter(p => p.daysOverdue > 0 && p.daysOverdue <= 30),\n          days60: payables.filter(p => p.daysOverdue > 30 && p.daysOverdue <= 60),\n          days90: payables.filter(p => p.daysOverdue > 60 && p.daysOverdue <= 90),\n          over90: payables.filter(p => p.daysOverdue > 90)\n        };\n\n        // Calculate totals for each bucket\n        const totals = {\n          current: buckets.current.reduce((sum, p) => sum + Number(p.outstandingAmount), 0),\n          days30: buckets.days30.reduce((sum, p) => sum + Number(p.outstandingAmount), 0),\n          days60: buckets.days60.reduce((sum, p) => sum + Number(p.outstandingAmount), 0),\n          days90: buckets.days90.reduce((sum, p) => sum + Number(p.outstandingAmount), 0),\n          over90: buckets.over90.reduce((sum, p) => sum + Number(p.outstandingAmount), 0)\n        };\n\n        return {\n          type: 'payable',\n          buckets,\n          totals,\n          grandTotal: Object.values(totals).reduce((sum, total) => sum + total, 0),\n          details: payables\n        };\n      }\n    } catch (error) {\n      throw new Error(`Failed to generate aging report: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async deletePayment(id: string, stationId: string): Promise<void> {\n    try {\n      const result = await db.delete(payments).where(\n        and(\n          eq(payments.id, id),\n          eq(payments.stationId, stationId)\n        )\n      ).returning({ id: payments.id });\n      \n      if (result.length === 0) {\n        throw new Error(`Payment ${id} not found or not authorized for station ${stationId}`);\n      }\n    } catch (error) {\n      throw new Error(`Failed to delete payment: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  async deleteExpense(id: string, stationId: string): Promise<void> {\n    try {\n      const result = await db.delete(expenses).where(\n        and(\n          eq(expenses.id, id),\n          eq(expenses.stationId, stationId)\n        )\n      ).returning({ id: expenses.id });\n      \n      if (result.length === 0) {\n        throw new Error(`Expense ${id} not found or not authorized for station ${stationId}`);\n      }\n    } catch (error) {\n      throw new Error(`Failed to delete expense: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n  \n  async getSettings(stationId: string): Promise<Settings | undefined> {\n    const [setting] = await db.select().from(settings).where(eq(settings.stationId, stationId));\n    return setting || undefined;\n  }\n\n  async createSettings(insertSettings: InsertSettings): Promise<Settings> {\n    const [setting] = await db.insert(settings).values(insertSettings).returning();\n    return setting;\n  }\n\n  async updateSettings(stationId: string, settingsData: Partial<InsertSettings>): Promise<Settings> {\n    const [setting] = await db.update(settings)\n      .set({ ...settingsData, updatedAt: new Date() })\n      .where(eq(settings.stationId, stationId))\n      .returning();\n    if (!setting) throw new Error(\"Settings not found\");\n    return setting;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":40296},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, decimal, integer, timestamp, boolean, jsonb, pgEnum } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const userRoleEnum = pgEnum('user_role', ['admin', 'manager', 'cashier']);\nexport const paymentMethodEnum = pgEnum('payment_method', ['cash', 'card', 'credit', 'fleet']);\nexport const transactionTypeEnum = pgEnum('transaction_type', ['sale', 'purchase', 'expense', 'payment']);\nexport const tankStatusEnum = pgEnum('tank_status', ['normal', 'low', 'critical', 'maintenance']);\nexport const customerTypeEnum = pgEnum('customer_type', ['walk-in', 'credit', 'fleet']);\nexport const currencyCodeEnum = pgEnum('currency_code', ['PKR', 'INR', 'USD', 'EUR', 'GBP', 'AED', 'SAR', 'CNY']);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  fullName: text(\"full_name\").notNull(),\n  role: userRoleEnum(\"role\").notNull().default('cashier'),\n  stationId: varchar(\"station_id\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Stations table\nexport const stations = pgTable(\"stations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  address: text(\"address\"),\n  gstNumber: text(\"gst_number\"),\n  licenseNumber: text(\"license_number\"),\n  contactPhone: text(\"contact_phone\"),\n  contactEmail: text(\"contact_email\"),\n  defaultCurrency: currencyCodeEnum(\"default_currency\").notNull().default('PKR'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Products table\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  category: text(\"category\").notNull(), // fuel, lubricant, additive\n  unit: text(\"unit\").notNull().default('litre'),\n  currentPrice: decimal(\"current_price\", { precision: 10, scale: 2 }).notNull(),\n  density: decimal(\"density\", { precision: 5, scale: 3 }),\n  hsnCode: text(\"hsn_code\"),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).default('0'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Tanks table\nexport const tanks = pgTable(\"tanks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stationId: varchar(\"station_id\").notNull(),\n  name: text(\"name\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  capacity: decimal(\"capacity\", { precision: 10, scale: 2 }).notNull(),\n  currentStock: decimal(\"current_stock\", { precision: 10, scale: 2 }).default('0'),\n  minimumLevel: decimal(\"minimum_level\", { precision: 10, scale: 2 }).default('500'),\n  status: tankStatusEnum(\"status\").default('normal'),\n  lastRefillDate: timestamp(\"last_refill_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Customers table\nexport const customers = pgTable(\"customers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  type: customerTypeEnum(\"type\").notNull().default('walk-in'),\n  contactPhone: text(\"contact_phone\"),\n  contactEmail: text(\"contact_email\"),\n  address: text(\"address\"),\n  gstNumber: text(\"gst_number\"),\n  creditLimit: decimal(\"credit_limit\", { precision: 10, scale: 2 }).default('0'),\n  outstandingAmount: decimal(\"outstanding_amount\", { precision: 10, scale: 2 }).default('0'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Suppliers table\nexport const suppliers = pgTable(\"suppliers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  contactPerson: text(\"contact_person\"),\n  contactPhone: text(\"contact_phone\"),\n  contactEmail: text(\"contact_email\"),\n  address: text(\"address\"),\n  gstNumber: text(\"gst_number\"),\n  paymentTerms: text(\"payment_terms\"),\n  outstandingAmount: decimal(\"outstanding_amount\", { precision: 10, scale: 2 }).default('0'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Sales transactions table\nexport const salesTransactions = pgTable(\"sales_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceNumber: text(\"invoice_number\").notNull().unique(),\n  stationId: varchar(\"station_id\").notNull(),\n  customerId: varchar(\"customer_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  transactionDate: timestamp(\"transaction_date\").defaultNow(),\n  dueDate: timestamp(\"due_date\"),\n  paymentMethod: paymentMethodEnum(\"payment_method\").notNull(),\n  currencyCode: currencyCodeEnum(\"currency_code\").notNull().default('PKR'),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  taxAmount: decimal(\"tax_amount\", { precision: 10, scale: 2 }).default('0'),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  paidAmount: decimal(\"paid_amount\", { precision: 10, scale: 2 }).default('0'),\n  outstandingAmount: decimal(\"outstanding_amount\", { precision: 10, scale: 2 }).default('0'),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Sales transaction items table\nexport const salesTransactionItems = pgTable(\"sales_transaction_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  transactionId: varchar(\"transaction_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  tankId: varchar(\"tank_id\"),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 3 }).notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Purchase orders table\nexport const purchaseOrders = pgTable(\"purchase_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderNumber: text(\"order_number\").notNull().unique(),\n  stationId: varchar(\"station_id\").notNull(),\n  supplierId: varchar(\"supplier_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  orderDate: timestamp(\"order_date\").defaultNow(),\n  dueDate: timestamp(\"due_date\"),\n  expectedDeliveryDate: timestamp(\"expected_delivery_date\"),\n  actualDeliveryDate: timestamp(\"actual_delivery_date\"),\n  status: text(\"status\").default('pending'), // pending, delivered, cancelled\n  currencyCode: currencyCodeEnum(\"currency_code\").notNull().default('PKR'),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  taxAmount: decimal(\"tax_amount\", { precision: 10, scale: 2 }).default('0'),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  paidAmount: decimal(\"paid_amount\", { precision: 10, scale: 2 }).default('0'),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Purchase order items table\nexport const purchaseOrderItems = pgTable(\"purchase_order_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderId: varchar(\"order_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  tankId: varchar(\"tank_id\"),\n  quantity: decimal(\"quantity\", { precision: 10, scale: 3 }).notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  receivedQuantity: decimal(\"received_quantity\", { precision: 10, scale: 3 }).default('0'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Expenses table\nexport const expenses = pgTable(\"expenses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stationId: varchar(\"station_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  category: text(\"category\").notNull(), // salary, utilities, maintenance, insurance, etc.\n  description: text(\"description\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  currencyCode: currencyCodeEnum(\"currency_code\").notNull().default('PKR'),\n  expenseDate: timestamp(\"expense_date\").defaultNow(),\n  receiptNumber: text(\"receipt_number\"),\n  paymentMethod: paymentMethodEnum(\"payment_method\").notNull(),\n  vendorName: text(\"vendor_name\"),\n  isRecurring: boolean(\"is_recurring\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Payments table\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stationId: varchar(\"station_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  customerId: varchar(\"customer_id\"),\n  supplierId: varchar(\"supplier_id\"),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  currencyCode: currencyCodeEnum(\"currency_code\").notNull().default('PKR'),\n  paymentDate: timestamp(\"payment_date\").defaultNow(),\n  paymentMethod: paymentMethodEnum(\"payment_method\").notNull(),\n  referenceNumber: text(\"reference_number\"),\n  notes: text(\"notes\"),\n  type: text(\"type\").notNull(), // receivable, payable\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Stock movements table\nexport const stockMovements = pgTable(\"stock_movements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tankId: varchar(\"tank_id\").notNull(),\n  stationId: varchar(\"station_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  movementType: text(\"movement_type\").notNull(), // in, out, adjustment\n  quantity: decimal(\"quantity\", { precision: 10, scale: 3 }).notNull(),\n  previousStock: decimal(\"previous_stock\", { precision: 10, scale: 3 }).notNull(),\n  newStock: decimal(\"new_stock\", { precision: 10, scale: 3 }).notNull(),\n  referenceId: varchar(\"reference_id\"), // Links to sales_transactions, purchase_orders, etc.\n  referenceType: text(\"reference_type\"), // sale, purchase, adjustment\n  notes: text(\"notes\"),\n  movementDate: timestamp(\"movement_date\").defaultNow(),\n});\n\n// Price history table\nexport const priceHistory = pgTable(\"price_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull(),\n  stationId: varchar(\"station_id\").notNull(),\n  oldPrice: decimal(\"old_price\", { precision: 10, scale: 2 }).notNull(),\n  newPrice: decimal(\"new_price\", { precision: 10, scale: 2 }).notNull(),\n  effectiveDate: timestamp(\"effective_date\").defaultNow(),\n  userId: varchar(\"user_id\").notNull(),\n  reason: text(\"reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Settings table\nexport const settings = pgTable(\"settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  stationId: varchar(\"station_id\").notNull().unique(),\n  taxEnabled: boolean(\"tax_enabled\").default(false),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).default('0'),\n  currencyCode: currencyCodeEnum(\"currency_code\").notNull().default('PKR'),\n  companyName: text(\"company_name\"),\n  companyAddress: text(\"company_address\"),\n  companyPhone: text(\"company_phone\"),\n  companyEmail: text(\"company_email\"),\n  receiptFooter: text(\"receipt_footer\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  station: one(stations, { fields: [users.stationId], references: [stations.id] }),\n  salesTransactions: many(salesTransactions),\n  purchaseOrders: many(purchaseOrders),\n  expenses: many(expenses),\n  payments: many(payments),\n  stockMovements: many(stockMovements),\n  priceHistory: many(priceHistory),\n}));\n\nexport const stationsRelations = relations(stations, ({ one, many }) => ({\n  users: many(users),\n  tanks: many(tanks),\n  salesTransactions: many(salesTransactions),\n  purchaseOrders: many(purchaseOrders),\n  expenses: many(expenses),\n  payments: many(payments),\n  stockMovements: many(stockMovements),\n  priceHistory: many(priceHistory),\n  settings: one(settings, { fields: [stations.id], references: [settings.stationId] }),\n}));\n\nexport const productsRelations = relations(products, ({ many }) => ({\n  tanks: many(tanks),\n  salesTransactionItems: many(salesTransactionItems),\n  purchaseOrderItems: many(purchaseOrderItems),\n  priceHistory: many(priceHistory),\n}));\n\nexport const tanksRelations = relations(tanks, ({ one, many }) => ({\n  station: one(stations, { fields: [tanks.stationId], references: [stations.id] }),\n  product: one(products, { fields: [tanks.productId], references: [products.id] }),\n  salesTransactionItems: many(salesTransactionItems),\n  purchaseOrderItems: many(purchaseOrderItems),\n  stockMovements: many(stockMovements),\n}));\n\nexport const customersRelations = relations(customers, ({ many }) => ({\n  salesTransactions: many(salesTransactions),\n  payments: many(payments),\n}));\n\nexport const suppliersRelations = relations(suppliers, ({ many }) => ({\n  purchaseOrders: many(purchaseOrders),\n  payments: many(payments),\n}));\n\nexport const salesTransactionsRelations = relations(salesTransactions, ({ one, many }) => ({\n  station: one(stations, { fields: [salesTransactions.stationId], references: [stations.id] }),\n  customer: one(customers, { fields: [salesTransactions.customerId], references: [customers.id] }),\n  user: one(users, { fields: [salesTransactions.userId], references: [users.id] }),\n  items: many(salesTransactionItems),\n}));\n\nexport const salesTransactionItemsRelations = relations(salesTransactionItems, ({ one }) => ({\n  transaction: one(salesTransactions, { fields: [salesTransactionItems.transactionId], references: [salesTransactions.id] }),\n  product: one(products, { fields: [salesTransactionItems.productId], references: [products.id] }),\n  tank: one(tanks, { fields: [salesTransactionItems.tankId], references: [tanks.id] }),\n}));\n\nexport const purchaseOrdersRelations = relations(purchaseOrders, ({ one, many }) => ({\n  station: one(stations, { fields: [purchaseOrders.stationId], references: [stations.id] }),\n  supplier: one(suppliers, { fields: [purchaseOrders.supplierId], references: [suppliers.id] }),\n  user: one(users, { fields: [purchaseOrders.userId], references: [users.id] }),\n  items: many(purchaseOrderItems),\n}));\n\nexport const purchaseOrderItemsRelations = relations(purchaseOrderItems, ({ one }) => ({\n  order: one(purchaseOrders, { fields: [purchaseOrderItems.orderId], references: [purchaseOrders.id] }),\n  product: one(products, { fields: [purchaseOrderItems.productId], references: [products.id] }),\n  tank: one(tanks, { fields: [purchaseOrderItems.tankId], references: [tanks.id] }),\n}));\n\nexport const expensesRelations = relations(expenses, ({ one }) => ({\n  station: one(stations, { fields: [expenses.stationId], references: [stations.id] }),\n  user: one(users, { fields: [expenses.userId], references: [users.id] }),\n}));\n\nexport const paymentsRelations = relations(payments, ({ one }) => ({\n  station: one(stations, { fields: [payments.stationId], references: [stations.id] }),\n  user: one(users, { fields: [payments.userId], references: [users.id] }),\n  customer: one(customers, { fields: [payments.customerId], references: [customers.id] }),\n  supplier: one(suppliers, { fields: [payments.supplierId], references: [suppliers.id] }),\n}));\n\nexport const stockMovementsRelations = relations(stockMovements, ({ one }) => ({\n  tank: one(tanks, { fields: [stockMovements.tankId], references: [tanks.id] }),\n  station: one(stations, { fields: [stockMovements.stationId], references: [stations.id] }),\n  user: one(users, { fields: [stockMovements.userId], references: [users.id] }),\n}));\n\nexport const priceHistoryRelations = relations(priceHistory, ({ one }) => ({\n  product: one(products, { fields: [priceHistory.productId], references: [products.id] }),\n  station: one(stations, { fields: [priceHistory.stationId], references: [stations.id] }),\n  user: one(users, { fields: [priceHistory.userId], references: [users.id] }),\n}));\n\nexport const settingsRelations = relations(settings, ({ one }) => ({\n  station: one(stations, { fields: [settings.stationId], references: [stations.id] }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertStationSchema = createInsertSchema(stations).omit({ id: true, createdAt: true });\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true, createdAt: true, taxRate: true });\nexport const insertTankSchema = createInsertSchema(tanks).omit({ id: true, createdAt: true });\nexport const insertCustomerSchema = createInsertSchema(customers).omit({ id: true, createdAt: true });\nexport const insertSupplierSchema = createInsertSchema(suppliers).omit({ id: true, createdAt: true });\nexport const insertSalesTransactionSchema = createInsertSchema(salesTransactions).omit({ id: true, createdAt: true });\nexport const insertSalesTransactionItemSchema = createInsertSchema(salesTransactionItems).omit({ id: true, createdAt: true });\nexport const insertPurchaseOrderSchema = createInsertSchema(purchaseOrders).omit({ id: true, createdAt: true });\nexport const insertPurchaseOrderItemSchema = createInsertSchema(purchaseOrderItems).omit({ id: true, createdAt: true });\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({ id: true, createdAt: true });\nexport const insertPaymentSchema = createInsertSchema(payments).omit({ id: true, createdAt: true });\nexport const insertStockMovementSchema = createInsertSchema(stockMovements);\nexport const insertPriceHistorySchema = createInsertSchema(priceHistory).omit({ id: true, createdAt: true });\nexport const insertSettingsSchema = createInsertSchema(settings).omit({ id: true, createdAt: true, updatedAt: true });\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Station = typeof stations.$inferSelect;\nexport type InsertStation = z.infer<typeof insertStationSchema>;\nexport type Product = typeof products.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Tank = typeof tanks.$inferSelect;\nexport type InsertTank = z.infer<typeof insertTankSchema>;\nexport type Customer = typeof customers.$inferSelect;\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type Supplier = typeof suppliers.$inferSelect;\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type SalesTransaction = typeof salesTransactions.$inferSelect;\nexport type InsertSalesTransaction = z.infer<typeof insertSalesTransactionSchema>;\nexport type SalesTransactionItem = typeof salesTransactionItems.$inferSelect;\nexport type InsertSalesTransactionItem = z.infer<typeof insertSalesTransactionItemSchema>;\nexport type PurchaseOrder = typeof purchaseOrders.$inferSelect;\nexport type InsertPurchaseOrder = z.infer<typeof insertPurchaseOrderSchema>;\nexport type PurchaseOrderItem = typeof purchaseOrderItems.$inferSelect;\nexport type InsertPurchaseOrderItem = z.infer<typeof insertPurchaseOrderItemSchema>;\nexport type Expense = typeof expenses.$inferSelect;\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type StockMovement = typeof stockMovements.$inferSelect;\nexport type InsertStockMovement = z.infer<typeof insertStockMovementSchema>;\nexport type PriceHistory = typeof priceHistory.$inferSelect;\nexport type InsertPriceHistory = z.infer<typeof insertPriceHistorySchema>;\nexport type Settings = typeof settings.$inferSelect;\nexport type InsertSettings = z.infer<typeof insertSettingsSchema>;\n","size_bytes":19852},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"@/hooks/useAuth\";\nimport { CurrencyProvider, useCurrency } from \"@/contexts/CurrencyContext\";\nimport { CURRENCY_CONFIG, type CurrencyCode } from \"@/lib/currency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport AuthGuard from \"@/components/layout/AuthGuard\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport PointOfSale from \"@/pages/PointOfSale\";\nimport CustomerManagement from \"@/pages/CustomerManagement\";\nimport StockManagement from \"@/pages/StockManagement\";\nimport FinancialReports from \"@/pages/FinancialReports\";\nimport SalesHistory from \"@/pages/SalesHistory\";\nimport PurchaseOrders from \"@/pages/PurchaseOrders\";\nimport AccountsReceivable from \"@/pages/AccountsReceivable\";\nimport AccountsPayable from \"@/pages/AccountsPayable\";\nimport CashReconciliation from \"@/pages/CashReconciliation\";\nimport ExpenseManagement from \"@/pages/ExpenseManagement\";\nimport SupplierManagement from \"@/pages/SupplierManagement\";\nimport PriceManagement from \"@/pages/PriceManagement\";\nimport InvoiceReceipt from \"@/pages/InvoiceReceipt\";\nimport TankMonitoring from \"@/pages/TankMonitoring\";\nimport DailyReports from \"@/pages/DailyReports\";\nimport AgingReports from \"@/pages/AgingReports\";\nimport Settings from \"@/pages/Settings\";\nimport NotFound from \"@/pages/not-found\";\n\n// Global theme initialization to prevent auto-enabling dark mode on Settings page\nfunction ThemeBootstrap() {\n  useEffect(() => {\n    const savedTheme = localStorage.getItem('theme');\n    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    \n    if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, []);\n\n  return null;\n}\n\n// Bootstrap component to handle station currency fetch without circular imports\nfunction CurrencyBootstrap() {\n  const { user } = useAuth();\n  const currencyContext = useCurrency();\n  const { setCurrency } = currencyContext || { setCurrency: () => {} };\n\n  useEffect(() => {\n    const fetchStationCurrency = async () => {\n      if (!user?.stationId) return;\n      \n      // Only fetch from server if no localStorage preference exists\n      const savedCurrency = typeof window !== 'undefined' ? localStorage.getItem('selectedCurrency') : null;\n      if (savedCurrency && savedCurrency in CURRENCY_CONFIG) {\n        return; // Use localStorage preference\n      }\n      \n      try {\n        const response = await apiRequest('GET', `/api/stations/${user.stationId}`);\n        const station = await response.json();\n        \n        if (station?.defaultCurrency && station.defaultCurrency in CURRENCY_CONFIG) {\n          const newCurrency = station.defaultCurrency as CurrencyCode;\n          setCurrency(newCurrency);\n        }\n      } catch (error) {\n        console.error('Failed to fetch station currency:', error);\n        // Fallback is already handled by CurrencyProvider default\n      }\n    };\n\n    fetchStationCurrency();\n  }, [user?.stationId, setCurrency]);\n\n  return null;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/pos\" component={PointOfSale} />\n      <Route path=\"/sales-history\" component={SalesHistory} />\n      <Route path=\"/customers\" component={CustomerManagement} />\n      <Route path=\"/stock\" component={StockManagement} />\n      <Route path=\"/purchase-orders\" component={PurchaseOrders} />\n      <Route path=\"/accounts-receivable\" component={AccountsReceivable} />\n      <Route path=\"/accounts-payable\" component={AccountsPayable} />\n      <Route path=\"/cash-reconciliation\" component={CashReconciliation} />\n      <Route path=\"/expenses\" component={ExpenseManagement} />\n      <Route path=\"/suppliers\" component={SupplierManagement} />\n      <Route path=\"/pricing\" component={PriceManagement} />\n      <Route path=\"/financial-reports\" component={FinancialReports} />\n      <Route path=\"/invoice/:id\" component={InvoiceReceipt} />\n      <Route path=\"/tanks\" component={TankMonitoring} />\n      <Route path=\"/daily-reports\" component={DailyReports} />\n      <Route path=\"/aging-reports\" component={AgingReports} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <CurrencyProvider>\n          <ThemeBootstrap />\n          <CurrencyBootstrap />\n          <TooltipProvider>\n            <Toaster />\n            <AuthGuard>\n              <Router />\n            </AuthGuard>\n          </TooltipProvider>\n        </CurrencyProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":5063},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(210, 40%, 96%);\n  --foreground: hsl(215, 27%, 17%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(215, 27%, 17%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(215, 27%, 17%);\n  --primary: hsl(221, 83%, 53%);\n  --primary-foreground: hsl(0, 0%, 98%);\n  --secondary: hsl(210, 40%, 94%);\n  --secondary-foreground: hsl(215, 27%, 17%);\n  --muted: hsl(210, 40%, 94%);\n  --muted-foreground: hsl(215, 25%, 45%);\n  --accent: hsl(210, 40%, 94%);\n  --accent-foreground: hsl(215, 27%, 17%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --border: hsl(214, 32%, 91%);\n  --input: hsl(214, 32%, 91%);\n  --ring: hsl(221, 83%, 53%);\n  --chart-1: hsl(221, 83%, 53%);\n  --chart-2: hsl(142, 69%, 58%);\n  --chart-3: hsl(45, 93%, 58%);\n  --chart-4: hsl(0, 84%, 60%);\n  --chart-5: hsl(270, 95%, 75%);\n  --radius: 0.75rem;\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: 'Inter', system-ui, sans-serif;\n  --font-mono: 'Inter', system-ui, sans-serif;\n}\n\n.dark {\n  --background: hsl(0, 0%, 0%);\n  --foreground: hsl(200, 6.6667%, 91.1765%);\n  --card: hsl(228, 9.8039%, 10%);\n  --card-foreground: hsl(0, 0%, 85.0980%);\n  --popover: hsl(0, 0%, 0%);\n  --popover-foreground: hsl(200, 6.6667%, 91.1765%);\n  --primary: hsl(203.7736, 87.6033%, 52.5490%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(195, 15.3846%, 94.9020%);\n  --secondary-foreground: hsl(210, 25%, 7.8431%);\n  --muted: hsl(0, 0%, 9.4118%);\n  --muted-foreground: hsl(210, 3.3898%, 46.2745%);\n  --accent: hsl(205.7143, 70%, 7.8431%);\n  --accent-foreground: hsl(203.7736, 87.6033%, 52.5490%);\n  --destructive: hsl(356.3033, 90.5579%, 54.3137%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --border: hsl(210, 5.2632%, 14.9020%);\n  --input: hsl(207.6923, 27.6596%, 18.4314%);\n  --ring: hsl(202.8169, 89.1213%, 53.1373%);\n  --chart-1: hsl(203.8863, 88.2845%, 53.1373%);\n  --chart-2: hsl(159.7826, 100%, 36.0784%);\n  --chart-3: hsl(42.0290, 92.8251%, 56.2745%);\n  --chart-4: hsl(147.1429, 78.5047%, 41.9608%);\n  --chart-5: hsl(341.4894, 75.2000%, 50.9804%);\n  --sidebar: hsl(228, 9.8039%, 10%);\n  --sidebar-foreground: hsl(0, 0%, 85.0980%);\n  --sidebar-primary: hsl(202.8169, 89.1213%, 53.1373%);\n  --sidebar-primary-foreground: hsl(0, 0%, 100%);\n  --sidebar-accent: hsl(205.7143, 70%, 7.8431%);\n  --sidebar-accent-foreground: hsl(203.7736, 87.6033%, 52.5490%);\n  --sidebar-border: hsl(205.7143, 15.7895%, 26.0784%);\n  --sidebar-ring: hsl(202.8169, 89.1213%, 53.1373%);\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: 'Inter', system-ui, sans-serif;\n  --font-mono: 'Inter', system-ui, sans-serif;\n  --radius: 0.75rem;\n}\n\n/* Print styles for invoices */\n@media print {\n  body {\n    background: #fff !important;\n    color: #000 !important;\n    color-scheme: light !important;\n  }\n  \n  html.dark body {\n    background: #fff !important;\n    color: #000 !important;\n  }\n  \n  /* Hide everything by default when printing */\n  body * {\n    visibility: hidden;\n  }\n  \n  /* Only show the invoice print area */\n  #invoice-print,\n  #invoice-print * {\n    visibility: visible;\n  }\n  \n  /* Position the invoice print area to fill the page */\n  #invoice-print {\n    position: absolute;\n    left: 0;\n    top: 0;\n    margin: 0;\n    padding: 20px;\n    width: 100%;\n    background: #fff !important;\n  }\n  \n  /* Ensure all text is black in print */\n  #invoice-print * {\n    color: #000 !important;\n    background: transparent !important;\n  }\n  \n  /* Special handling for borders and separators */\n  #invoice-print .border {\n    border-color: #000 !important;\n  }\n  \n  #invoice-print .bg-muted\\/50 {\n    background-color: #f5f5f5 !important;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n.fade-in {\n  animation: fadeIn 0.3s ease-in;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n.sidebar-transition {\n  transition: transform 0.3s ease;\n}\n\n@media print {\n  * {\n    -webkit-print-color-adjust: exact !important;\n    color-adjust: exact !important;\n    print-color-adjust: exact !important;\n  }\n  \n  body {\n    background: white !important;\n    color: black !important;\n    font-size: 12pt !important;\n    line-height: 1.3 !important;\n  }\n  \n  /* Make sure content fits on page */\n  .container {\n    max-width: none !important;\n    padding: 0.5in !important;\n    margin: 0 !important;\n  }\n  \n  /* Invoice specific styles */\n  .invoice-content {\n    background: white !important;\n    color: black !important;\n  }\n  \n  /* Ensure tables print correctly */\n  table {\n    page-break-inside: avoid;\n    border-collapse: collapse !important;\n  }\n  \n  tr {\n    page-break-inside: avoid;\n  }\n  \n  /* Headers */\n  h1, h2, h3 {\n    color: black !important;\n    page-break-after: avoid;\n  }\n  \n  /* Hide all buttons */\n  button {\n    display: none !important;\n  }\n  \n  /* Links should appear as normal text */\n  a {\n    text-decoration: none !important;\n    color: inherit !important;\n  }\n  \n  /* Background colors for tables */\n  .bg-muted {\n    background-color: #f9f9f9 !important;\n    -webkit-print-color-adjust: exact !important;\n  }\n  \n  /* Borders */\n  .border {\n    border: 1px solid #ddd !important;\n  }\n  \n  .border-b {\n    border-bottom: 1px solid #ddd !important;\n  }\n}\n","size_bytes":5484},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/contexts/CurrencyContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { CURRENCY_CONFIG, type CurrencyCode, type CurrencyConfig } from '@/lib/currency';\nimport { useAuth } from '@/hooks/useAuth';\n\ninterface CurrencyContextType {\n  currency: CurrencyCode;\n  currencyConfig: CurrencyConfig;\n  formatCurrency: (amount: number | string, options?: Intl.NumberFormatOptions) => string;\n  formatCurrencyCompact: (amount: number | string) => string;\n  setCurrency: (currency: CurrencyCode) => void;\n  isLoading: boolean;\n}\n\nconst CurrencyContext = createContext<CurrencyContextType | undefined>(undefined);\n\nexport function CurrencyProvider({ children }: { children: ReactNode }) {\n  const [currency, setCurrencyState] = useState<CurrencyCode>(() => {\n    // Initialize from localStorage if available\n    const savedCurrency = typeof window !== 'undefined' ? localStorage.getItem('selectedCurrency') : null;\n    if (savedCurrency && savedCurrency in CURRENCY_CONFIG) {\n      return savedCurrency as CurrencyCode;\n    }\n    return 'PKR'; // Default to Pakistani Rupee\n  });\n  const [isLoading, setIsLoading] = useState(false);\n\n  const currencyConfig = CURRENCY_CONFIG[currency];\n\n  const formatCurrency = (\n    amount: number | string, \n    options: Intl.NumberFormatOptions = {}\n  ): string => {\n    const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n    \n    if (isNaN(numAmount)) return `${currencyConfig.symbol}0`;\n    \n    const formatter = new Intl.NumberFormat(currencyConfig.locale, {\n      style: 'currency',\n      currency: currencyConfig.code,\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n      ...options\n    });\n\n    return formatter.format(numAmount);\n  };\n\n  const formatCurrencyCompact = (amount: number | string): string => {\n    const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n    \n    if (isNaN(numAmount)) return `${currencyConfig.symbol}0`;\n\n    // For Pakistani Rupee, show in Lakhs (1L = 100,000)\n    if (currency === 'PKR' && numAmount >= 100000) {\n      return `${currencyConfig.symbol}${(numAmount / 100000).toFixed(1)}L`;\n    }\n    \n    // For other currencies, use compact notation\n    const formatter = new Intl.NumberFormat(currencyConfig.locale, {\n      style: 'currency',\n      currency: currencyConfig.code,\n      notation: 'compact',\n      compactDisplay: 'short'\n    });\n\n    return formatter.format(numAmount);\n  };\n\n  const setCurrency = (newCurrency: CurrencyCode) => {\n    setCurrencyState(newCurrency);\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('selectedCurrency', newCurrency);\n    }\n    // Note: In a real app, you'd want to update the station's default currency via API\n  };\n\n  return (\n    <CurrencyContext.Provider\n      value={{\n        currency,\n        currencyConfig,\n        formatCurrency,\n        formatCurrencyCompact,\n        setCurrency,\n        isLoading\n      }}\n    >\n      {children}\n    </CurrencyContext.Provider>\n  );\n}\n\nexport function useCurrency(): CurrencyContextType {\n  const context = useContext(CurrencyContext);\n  if (context === undefined) {\n    throw new Error('useCurrency must be used within a CurrencyProvider');\n  }\n  return context;\n}","size_bytes":3272},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { apiRequest } from \"@/lib/api\";\nimport { signInWithGoogle, handleGoogleRedirect, auth, isFirebaseConfigured } from \"@/lib/firebase\";\nimport { onAuthStateChanged, getIdToken } from \"firebase/auth\";\n\ninterface User {\n  id: string;\n  username: string;\n  fullName: string;\n  role: string;\n  stationId?: string;\n  email?: string;\n  photoURL?: string | null;\n  isGoogleAuth?: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAuthenticated: boolean;\n  login: (username: string, password: string) => Promise<void>;\n  loginWithGoogle: () => Promise<void>;\n  logout: () => void;\n  isLoading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    // Check for stored token and validate with server\n    const token = localStorage.getItem(\"fuelflow_token\");\n    \n    if (token) {\n      // Validate token with server\n      apiRequest(\"GET\", \"/api/auth/me\")\n        .then(response => response.json())\n        .then(data => {\n          setUser(data.user);\n          setIsLoading(false);\n        })\n        .catch(() => {\n          // Token is invalid, clear it\n          localStorage.removeItem(\"fuelflow_token\");\n          localStorage.removeItem(\"fuelflow_user\");\n          setIsLoading(false);\n        });\n    } else {\n      setIsLoading(false);\n    }\n    \n    // Only handle Firebase auth if configured\n    if (!isFirebaseConfigured) {\n      return; // Skip Firebase auth handling\n    }\n    \n    // Handle Google Auth redirect result\n    handleGoogleRedirect().then(async (result) => {\n      if (result) {\n        try {\n          // Get Firebase ID token\n          const idToken = await getIdToken(result.user);\n          \n          // Send to backend for verification\n          const response = await apiRequest(\"POST\", \"/api/auth/google\", { idToken });\n          const data = await response.json();\n          \n          setUser(data.user);\n          localStorage.setItem(\"fuelflow_token\", data.token);\n          localStorage.setItem(\"fuelflow_user\", JSON.stringify(data.user));\n        } catch (error) {\n          console.error('Google auth error:', error);\n        }\n      }\n    }).catch(console.error);\n    \n    // Listen to Firebase auth state changes for Google users\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\n      if (firebaseUser && !user) {\n        try {\n          // Get Firebase ID token and verify with backend\n          const idToken = await getIdToken(firebaseUser);\n          const response = await apiRequest(\"POST\", \"/api/auth/google\", { idToken });\n          const data = await response.json();\n          \n          setUser(data.user);\n          localStorage.setItem(\"fuelflow_token\", data.token);\n          localStorage.setItem(\"fuelflow_user\", JSON.stringify(data.user));\n        } catch (error) {\n          console.error('Firebase auth verification error:', error);\n        }\n      }\n      setIsLoading(false);\n    });\n    \n    return () => unsubscribe();\n  }, []);\n\n  const login = async (username: string, password: string) => {\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", { username, password });\n      const data = await response.json();\n      \n      setUser(data.user);\n      localStorage.setItem(\"fuelflow_token\", data.token);\n      localStorage.setItem(\"fuelflow_user\", JSON.stringify(data.user));\n    } catch (error) {\n      throw new Error(\"Login failed\");\n    }\n  };\n\n  const loginWithGoogle = async () => {\n    try {\n      await signInWithGoogle();\n      // User will be set via the redirect handler\n    } catch (error) {\n      console.error('Google sign-in error:', error);\n      throw new Error(\"Google sign-in failed\");\n    }\n  };\n\n  const logout = async () => {\n    try {\n      // Sign out from Firebase if it's a Google auth user\n      if (user?.isGoogleAuth) {\n        await auth.signOut();\n      }\n      setUser(null);\n      localStorage.removeItem(\"fuelflow_token\");\n      localStorage.removeItem(\"fuelflow_user\");\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  };\n\n  const isAuthenticated = !!user;\n\n  return (\n    <AuthContext.Provider value={{ user, isAuthenticated, login, loginWithGoogle, logout, isLoading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":4729},"client/src/lib/api.ts":{"content":"function getAuthHeaders() {\n  const token = localStorage.getItem(\"fuelflow_token\");\n  const headers: Record<string, string> = {};\n  \n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  }\n  \n  return headers;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown\n): Promise<Response> {\n  const authHeaders = getAuthHeaders();\n  const headers = {\n    ...authHeaders,\n    ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n  };\n  \n  const response = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`${response.status}: ${errorText}`);\n  }\n\n  return response;\n}\n","size_bytes":778},"client/src/lib/currency.ts":{"content":"// Currency configuration with proper formatting info\nexport const CURRENCY_CONFIG = {\n  PKR: { \n    symbol: 'â‚¨', \n    name: 'Pakistani Rupee', \n    locale: 'en-PK',\n    code: 'PKR'\n  },\n  INR: { \n    symbol: 'â‚¹', \n    name: 'Indian Rupee', \n    locale: 'en-IN',\n    code: 'INR'\n  },\n  USD: { \n    symbol: '$', \n    name: 'US Dollar', \n    locale: 'en-US',\n    code: 'USD'\n  },\n  EUR: { \n    symbol: 'â‚¬', \n    name: 'Euro', \n    locale: 'de-DE',\n    code: 'EUR'\n  },\n  GBP: { \n    symbol: 'Â£', \n    name: 'British Pound', \n    locale: 'en-GB',\n    code: 'GBP'\n  },\n  AED: { \n    symbol: 'Ø¯.Ø¥', \n    name: 'UAE Dirham', \n    locale: 'ar-AE',\n    code: 'AED'\n  },\n  SAR: { \n    symbol: 'ï·¼', \n    name: 'Saudi Riyal', \n    locale: 'ar-SA',\n    code: 'SAR'\n  },\n  CNY: { \n    symbol: 'Â¥', \n    name: 'Chinese Yuan', \n    locale: 'zh-CN',\n    code: 'CNY'\n  }\n} as const;\n\nexport type CurrencyCode = keyof typeof CURRENCY_CONFIG;\nexport type CurrencyConfig = (typeof CURRENCY_CONFIG)[CurrencyCode];\n\n// Helper function to get currency symbol without context\nexport function getCurrencySymbol(currencyCode: CurrencyCode): string {\n  return CURRENCY_CONFIG[currencyCode].symbol;\n}\n\n// Helper function to format currency amount without context\nexport function formatAmount(\n  amount: number | string, \n  currencyCode: CurrencyCode = 'PKR',\n  options: Intl.NumberFormatOptions = {}\n): string {\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n  \n  if (isNaN(numAmount)) return `${CURRENCY_CONFIG[currencyCode].symbol}0`;\n  \n  const config = CURRENCY_CONFIG[currencyCode];\n  const formatter = new Intl.NumberFormat(config.locale, {\n    style: 'currency',\n    currency: config.code,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n    ...options\n  });\n\n  return formatter.format(numAmount);\n}\n\n// Helper function for compact formatting\nexport function formatAmountCompact(\n  amount: number | string, \n  currencyCode: CurrencyCode = 'PKR'\n): string {\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n  \n  if (isNaN(numAmount)) return `${CURRENCY_CONFIG[currencyCode].symbol}0`;\n\n  const config = CURRENCY_CONFIG[currencyCode];\n\n  // For Pakistani Rupee, show in Lakhs (1L = 100,000)\n  if (currencyCode === 'PKR' && numAmount >= 100000) {\n    return `${config.symbol}${(numAmount / 100000).toFixed(1)}L`;\n  }\n  \n  // For other currencies, use compact notation\n  const formatter = new Intl.NumberFormat(config.locale, {\n    style: 'currency',\n    currency: config.code,\n    notation: 'compact',\n    compactDisplay: 'short'\n  });\n\n  return formatter.format(numAmount);\n}\n\n// Parse currency string back to number (removing symbols and formatting)\nexport function parseCurrencyString(currencyString: string): number {\n  // Remove all non-numeric characters except decimal point and minus sign\n  const cleaned = currencyString.replace(/[^\\d.-]/g, '');\n  return parseFloat(cleaned) || 0;\n}\n\n// Validate currency code\nexport function isValidCurrency(code: string): code is CurrencyCode {\n  return code in CURRENCY_CONFIG;\n}","size_bytes":3084},"client/src/lib/firebase.ts":{"content":"// Firebase integration - from firebase_barebones_javascript blueprint\nimport { initializeApp } from \"firebase/app\";\nimport { getAuth, signInWithRedirect, GoogleAuthProvider, getRedirectResult, User as FirebaseUser } from \"firebase/auth\";\n\n// Check if Firebase environment variables are configured\nconst isFirebaseConfigured = !!\n  (import.meta.env.VITE_FIREBASE_API_KEY &&\n   import.meta.env.VITE_FIREBASE_PROJECT_ID &&\n   import.meta.env.VITE_FIREBASE_APP_ID);\n\nlet auth: any = null;\nlet googleProvider: any = null;\n\n// Only initialize Firebase if configured\nif (isFirebaseConfigured) {\n  const firebaseConfig = {\n    apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n    authDomain: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n    storageBucket: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebasestorage.app`,\n    appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  };\n\n  const app = initializeApp(firebaseConfig);\n  auth = getAuth(app);\n  googleProvider = new GoogleAuthProvider();\n}\n\nexport { auth, googleProvider };\nexport { isFirebaseConfigured };\n\n// Google Sign In function\nexport function signInWithGoogle() {\n  if (!isFirebaseConfigured || !auth || !googleProvider) {\n    throw new Error('Firebase is not configured. Please set up Firebase environment variables.');\n  }\n  signInWithRedirect(auth, googleProvider);\n}\n\n// Handle redirect result after Google sign-in\nexport async function handleGoogleRedirect() {\n  if (!isFirebaseConfigured || !auth) {\n    return null; // Firebase not configured, skip Google auth handling\n  }\n  \n  try {\n    const result = await getRedirectResult(auth);\n    if (result) {\n      // This gives you a Google Access Token. You can use it to access Google APIs.\n      const credential = GoogleAuthProvider.credentialFromResult(result);\n      const token = credential?.accessToken;\n\n      // The signed-in user info.\n      const user = result.user;\n      return { user, token };\n    }\n    return null;\n  } catch (error: any) {\n    console.error('Google Sign-In error:', error);\n    return null; // Return null instead of throwing to prevent blocking local auth\n  }\n}\n\n// Convert Firebase user to application user format\nexport function convertFirebaseUser(firebaseUser: FirebaseUser) {\n  return {\n    id: firebaseUser.uid,\n    username: firebaseUser.email || '',\n    fullName: firebaseUser.displayName || firebaseUser.email || '',\n    email: firebaseUser.email || '',\n    photoURL: firebaseUser.photoURL || null,\n    role: 'cashier' as const, // Default role for Google sign-in users\n    isGoogleAuth: true,\n  };\n}","size_bytes":2623},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nfunction getAuthHeaders() {\n  const token = localStorage.getItem(\"fuelflow_token\");\n  const headers: Record<string, string> = {};\n  \n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  }\n  \n  return headers;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const authHeaders = getAuthHeaders();\n  const headers = {\n    ...authHeaders,\n    ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n  };\n  \n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const authHeaders = getAuthHeaders();\n    \n    const res = await fetch(queryKey.join(\"/\") as string, {\n      headers: authHeaders,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1778},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/AccountsPayable.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport type { Supplier, Payment } from \"@shared/schema\";\nimport { insertPaymentSchema } from \"@shared/schema\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Combobox } from \"@/components/ui/combobox\";\n\nexport default function AccountsPayable() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { formatCurrency, currencyConfig } = useCurrency();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertPaymentSchema.extend({\n      paymentDate: insertPaymentSchema.shape.paymentDate.optional(),\n    })),\n    defaultValues: {\n      supplierId: \"\",\n      amount: \"0\",\n      paymentMethod: \"cash\",\n      referenceNumber: \"\",\n      notes: \"\",\n      type: \"payable\",\n      stationId: user?.stationId || \"\",\n      userId: user?.id || \"\",\n    },\n  });\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const paymentData = {\n        ...data,\n        stationId: user?.stationId || data.stationId,\n        userId: user?.id || data.userId,\n      };\n      const response = await apiRequest(\"POST\", \"/api/payments\", paymentData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payment recorded\",\n        description: \"Payment to supplier has been recorded successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createPaymentMutation.mutate(data);\n  };\n\n  const { data: suppliers = [], isLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const filteredSuppliers = suppliers.filter((supplier: Supplier) => {\n    const matchesSearch = supplier.name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    // Status filtering\n    const outstanding = parseFloat(supplier.outstandingAmount || '0');\n    let matchesStatus = true;\n    if (statusFilter === \"current\") {\n      matchesStatus = outstanding <= 100000;\n    } else if (statusFilter === \"overdue\") {\n      matchesStatus = outstanding > 100000;\n    } else if (statusFilter === \"paid\") {\n      matchesStatus = outstanding === 0;\n    }\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const totalPayable = filteredSuppliers.reduce((sum: number, s: Supplier) => sum + parseFloat(s.outstandingAmount || '0'), 0);\n  const overduePayments = filteredSuppliers.filter((s: Supplier) => parseFloat(s.outstandingAmount || '0') > 100000).length;\n  const currentPayments = filteredSuppliers.filter((s: Supplier) => {\n    const outstanding = parseFloat(s.outstandingAmount || '0');\n    return outstanding > 0 && outstanding <= 100000;\n  }).length;\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Accounts Payable</h3>\n          <p className=\"text-muted-foreground\">Manage supplier payments and outstanding balances</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-make-payment\">\n                + Make Payment\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Record Payment to Supplier</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"supplierId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Supplier *</FormLabel>\n                        <FormControl>\n                          <Combobox\n                            options={suppliers.map(s => ({ value: s.id, label: s.name }))}\n                            value={field.value}\n                            onValueChange={field.onChange}\n                            placeholder=\"Select supplier\"\n                            emptyMessage=\"No suppliers found\"\n                            data-testid=\"select-supplier\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ({currencyConfig.symbol}) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-payment-amount\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"paymentMethod\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Payment Method *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-payment-method\">\n                                <SelectValue placeholder=\"Select method\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"cash\">Cash</SelectItem>\n                              <SelectItem value=\"card\">Card</SelectItem>\n                              <SelectItem value=\"credit\">Credit</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"referenceNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Reference Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Transaction/Check number\" {...field} data-testid=\"input-reference-number\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes</FormLabel>\n                        <FormControl>\n                          <Textarea placeholder=\"Payment details\" {...field} data-testid=\"input-payment-notes\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createPaymentMutation.isPending} data-testid=\"button-submit-payment\">\n                      {createPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Button variant=\"outline\" data-testid=\"button-payment-schedule\">\n            ðŸ“… Payment Schedule\n          </Button>\n        </div>\n      </div>\n\n      {/* Payables Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"total-suppliers-ap\">\n              {filteredSuppliers.length}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Active Suppliers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"total-payable\">\n              {formatCurrency(totalPayable)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Payable</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"current-payments\">\n              {currentPayments}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Current Payments</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"overdue-payments\">\n              {overduePayments}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Overdue Payments</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Supplier Payables Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Supplier Payment Status</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search suppliers...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-suppliers-ap\"\n              />\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-status-filter-ap\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"current\">Current</SelectItem>\n                  <SelectItem value=\"overdue\">Overdue</SelectItem>\n                  <SelectItem value=\"paid\">Paid</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Supplier</th>\n                  <th className=\"text-left p-3 font-medium\">Payment Terms</th>\n                  <th className=\"text-right p-3 font-medium\">Outstanding</th>\n                  <th className=\"text-center p-3 font-medium\">Last Payment</th>\n                  <th className=\"text-center p-3 font-medium\">Due Date</th>\n                  <th className=\"text-center p-3 font-medium\">Days Overdue</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredSuppliers.length > 0 ? filteredSuppliers.map((supplier: Supplier, index: number) => {\n                  const outstanding = parseFloat(supplier.outstandingAmount || '0');\n                  const isOverdue = outstanding > 100000;\n                  \n                  return (\n                    <tr key={supplier.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <div className=\"font-medium text-card-foreground\" data-testid={`supplier-name-ap-${index}`}>\n                          {supplier.name}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Contact: {supplier.contactPerson || 'N/A'}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          GST: {supplier.gstNumber || 'N/A'}\n                        </div>\n                      </td>\n                      <td className=\"p-3\">{supplier.paymentTerms || 'Net 30'}</td>\n                      <td className=\"p-3 text-right\">\n                        <span className=\"font-semibold text-red-600\" data-testid={`outstanding-ap-${index}`}>\n                          {formatCurrency(outstanding)}\n                        </span>\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {supplier.createdAt ? new Date(supplier.createdAt).toLocaleDateString('en-GB') : 'N/A'}\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">N/A</td>\n                      <td className=\"p-3 text-center\">\n                        <span className={isOverdue ? 'text-red-600 font-semibold' : 'text-green-600'}>\n                          {isOverdue ? '30+ days' : 'On time'}\n                        </span>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={isOverdue ? 'destructive' : 'default'}\n                          className={isOverdue ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}\n                          data-testid={`status-ap-${index}`}\n                        >\n                          {isOverdue ? 'Overdue' : 'Current'}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <button \n                            className=\"text-blue-600 hover:text-blue-800\"\n                            data-testid={`button-view-ap-${index}`}\n                          >\n                            ðŸ‘ï¸\n                          </button>\n                          <button \n                            className=\"text-green-600 hover:text-green-800\"\n                            data-testid={`button-pay-ap-${index}`}\n                          >\n                            ðŸ’°\n                          </button>\n                          <button \n                            className=\"text-purple-600 hover:text-purple-800\"\n                            data-testid={`button-history-ap-${index}`}\n                          >\n                            ðŸ“„\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : (\n                  <tr>\n                    <td colSpan={8} className=\"p-8 text-center text-muted-foreground\">\n                      No supplier payment data found for the selected criteria\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":17264},"client/src/pages/AccountsReceivable.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport type { Customer, Payment } from \"@shared/schema\";\nimport { insertPaymentSchema } from \"@shared/schema\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Combobox } from \"@/components/ui/combobox\";\n\nexport default function AccountsReceivable() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { formatCurrency, currencyConfig } = useCurrency();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [agingFilter, setAgingFilter] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertPaymentSchema.extend({\n      paymentDate: insertPaymentSchema.shape.paymentDate.optional(),\n    })),\n    defaultValues: {\n      customerId: \"\",\n      amount: \"0\",\n      paymentMethod: \"cash\",\n      referenceNumber: \"\",\n      notes: \"\",\n      type: \"receivable\",\n      stationId: user?.stationId || \"\",\n      userId: user?.id || \"\",\n    },\n  });\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const paymentData = {\n        ...data,\n        stationId: user?.stationId || data.stationId,\n        userId: user?.id || data.userId,\n      };\n      const response = await apiRequest(\"POST\", \"/api/payments\", paymentData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payment recorded\",\n        description: \"Customer payment has been recorded successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createPaymentMutation.mutate(data);\n  };\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const creditCustomers = customers.filter((c: Customer) => parseFloat(c.outstandingAmount || '0') > 0);\n  \n  const filteredCustomers = creditCustomers.filter((customer: Customer) => {\n    const matchesSearch = customer.name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    // Aging filter logic\n    const outstanding = parseFloat(customer.outstandingAmount || '0');\n    let matchesAging = true;\n    if (agingFilter === \"current\") {\n      matchesAging = outstanding <= 50000;\n    } else if (agingFilter === \"30-60\") {\n      matchesAging = outstanding > 50000 && outstanding <= 100000;\n    } else if (agingFilter === \"60-90\") {\n      matchesAging = outstanding > 100000 && outstanding <= 150000;\n    } else if (agingFilter === \"90+\") {\n      matchesAging = outstanding > 150000;\n    }\n    \n    return matchesSearch && matchesAging;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const totalOutstanding = filteredCustomers.reduce((sum: number, c: Customer) => sum + parseFloat(c.outstandingAmount || '0'), 0);\n  const overdueAccounts = filteredCustomers.filter((c: Customer) => parseFloat(c.outstandingAmount || '0') > 50000).length;\n  const currentAccounts = filteredCustomers.filter((c: Customer) => {\n    const outstanding = parseFloat(c.outstandingAmount || '0');\n    return outstanding > 0 && outstanding <= 50000;\n  }).length;\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Accounts Receivable</h3>\n          <p className=\"text-muted-foreground\">Track customer payments and outstanding balances</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-record-payment\">\n                + Record Payment\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Record Customer Payment</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"customerId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Customer *</FormLabel>\n                        <FormControl>\n                          <Combobox\n                            options={creditCustomers.map(c => ({ value: c.id, label: `${c.name} (${formatCurrency(parseFloat(c.outstandingAmount || '0'))} outstanding)` }))}\n                            value={field.value}\n                            onValueChange={field.onChange}\n                            placeholder=\"Select customer\"\n                            emptyMessage=\"No customers with outstanding amounts found\"\n                            data-testid=\"select-customer\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ({currencyConfig.symbol}) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-payment-amount\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"paymentMethod\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Payment Method *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-payment-method\">\n                                <SelectValue placeholder=\"Select method\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"cash\">Cash</SelectItem>\n                              <SelectItem value=\"card\">Card</SelectItem>\n                              <SelectItem value=\"credit\">Credit</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"referenceNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Reference Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Transaction/Check number\" {...field} data-testid=\"input-reference-number\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes</FormLabel>\n                        <FormControl>\n                          <Textarea placeholder=\"Payment details\" {...field} data-testid=\"input-payment-notes\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createPaymentMutation.isPending} data-testid=\"button-submit-payment\">\n                      {createPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Button variant=\"outline\" data-testid=\"button-aging-report\">\n            ðŸ“Š Aging Report\n          </Button>\n        </div>\n      </div>\n\n      {/* Receivables Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"total-customers-ar\">\n              {filteredCustomers.length}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Outstanding Customers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"total-outstanding\">\n              {formatCurrency(totalOutstanding)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Outstanding</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"current-accounts\">\n              {currentAccounts}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Current (0-30 days)</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"overdue-accounts-ar\">\n              {overdueAccounts}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Overdue ({'>'}30 days)</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Outstanding Balances Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Outstanding Customer Balances</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search customers...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-customers-ar\"\n              />\n              <Select value={agingFilter} onValueChange={setAgingFilter}>\n                <SelectTrigger className=\"w-40\" data-testid=\"select-aging-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Accounts</SelectItem>\n                  <SelectItem value=\"current\">Current (0-30)</SelectItem>\n                  <SelectItem value=\"30-60\">30-60 Days</SelectItem>\n                  <SelectItem value=\"60-90\">60-90 Days</SelectItem>\n                  <SelectItem value=\"90+\">90+ Days</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Customer</th>\n                  <th className=\"text-right p-3 font-medium\">Credit Limit</th>\n                  <th className=\"text-right p-3 font-medium\">Outstanding</th>\n                  <th className=\"text-right p-3 font-medium\">Available Credit</th>\n                  <th className=\"text-center p-3 font-medium\">Days Outstanding</th>\n                  <th className=\"text-center p-3 font-medium\">Last Payment</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredCustomers.length > 0 ? filteredCustomers.map((customer: Customer, index: number) => {\n                  const creditLimit = parseFloat(customer.creditLimit || '0');\n                  const outstanding = parseFloat(customer.outstandingAmount || '0');\n                  const availableCredit = creditLimit - outstanding;\n                  const isOverdue = outstanding > 50000;\n                  \n                  return (\n                    <tr key={customer.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <div className=\"font-medium text-card-foreground\" data-testid={`customer-name-ar-${index}`}>\n                          {customer.name}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          GST: {customer.gstNumber || 'N/A'}\n                        </div>\n                      </td>\n                      <td className=\"p-3 text-right\">\n                        {formatCurrency(creditLimit)}\n                      </td>\n                      <td className=\"p-3 text-right\">\n                        <span className=\"font-semibold text-red-600\" data-testid={`outstanding-ar-${index}`}>\n                          {formatCurrency(outstanding)}\n                        </span>\n                      </td>\n                      <td className=\"p-3 text-right text-green-600\">\n                        {formatCurrency(Math.max(0, availableCredit))}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <span className={isOverdue ? 'text-red-600 font-semibold' : ''}>\n                          {isOverdue ? '30+' : '<30'} days\n                        </span>\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {customer.createdAt ? new Date(customer.createdAt).toLocaleDateString('en-GB') : 'N/A'}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={isOverdue ? 'destructive' : 'default'}\n                          className={isOverdue ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}\n                          data-testid={`status-ar-${index}`}\n                        >\n                          {isOverdue ? 'Overdue' : 'Current'}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <button \n                            className=\"text-blue-600 hover:text-blue-800\"\n                            data-testid={`button-view-ar-${index}`}\n                          >\n                            ðŸ‘ï¸\n                          </button>\n                          <button \n                            className=\"text-green-600 hover:text-green-800\"\n                            data-testid={`button-payment-ar-${index}`}\n                          >\n                            ðŸ’°\n                          </button>\n                          <button \n                            className=\"text-purple-600 hover:text-purple-800\"\n                            data-testid={`button-statement-${index}`}\n                          >\n                            ðŸ“„\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : (\n                  <tr>\n                    <td colSpan={8} className=\"p-8 text-center text-muted-foreground\">\n                      No outstanding accounts found for the selected criteria\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":17849},"client/src/pages/AgingReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Download, Clock, AlertTriangle, CheckCircle, AlertCircle } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\n\ninterface AgingBucketData {\n  id: string;\n  invoiceNumber?: string;\n  orderNumber?: string;\n  customerName?: string;\n  supplierName?: string;\n  transactionDate?: string;\n  orderDate?: string;\n  dueDate?: string;\n  totalAmount?: number;\n  outstandingAmount: number;\n  paidAmount?: number;\n  currencyCode: string;\n  daysOverdue: number;\n}\n\ninterface AgingReportData {\n  type: 'receivable' | 'payable';\n  buckets: {\n    current: AgingBucketData[];\n    days30: AgingBucketData[];\n    days60: AgingBucketData[];\n    days90: AgingBucketData[];\n    over90: AgingBucketData[];\n  };\n  totals: {\n    current: number;\n    days30: number;\n    days60: number;\n    days90: number;\n    over90: number;\n  };\n  grandTotal: number;\n}\n\nexport default function AgingReports() {\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const [reportType, setReportType] = useState<'receivable' | 'payable'>('receivable');\n\n  const { data: agingReport, isLoading } = useQuery<AgingReportData>({\n    queryKey: [`/api/reports/aging/${user?.stationId}?type=${reportType}`],\n    enabled: !!user?.stationId,\n  });\n\n  const exportToCSV = () => {\n    if (!agingReport) return;\n\n    const isReceivable = reportType === 'receivable';\n    const headers = isReceivable \n      ? ['Invoice Number', 'Customer Name', 'Transaction Date', 'Due Date', 'Outstanding Amount', 'Currency', 'Days Overdue', 'Status']\n      : ['Order Number', 'Supplier Name', 'Order Date', 'Due Date', 'Outstanding Amount', 'Currency', 'Days Overdue', 'Status'];\n\n    const rows: string[][] = [];\n    \n    // Add data from all buckets\n    Object.entries(agingReport.buckets).forEach(([bucketName, items]) => {\n      items.forEach(item => {\n        const daysOverdue = item.daysOverdue || 0;\n        const status = daysOverdue <= 0 ? 'Current' : \n                     daysOverdue <= 30 ? '1-30 Days' :\n                     daysOverdue <= 60 ? '31-60 Days' :\n                     daysOverdue <= 90 ? '61-90 Days' : '90+ Days';\n\n        if (isReceivable) {\n          rows.push([\n            item.invoiceNumber || 'N/A',\n            item.customerName || 'Unknown Customer',\n            item.transactionDate ? format(new Date(item.transactionDate), 'yyyy-MM-dd') : 'N/A',\n            item.dueDate ? format(new Date(item.dueDate), 'yyyy-MM-dd') : 'N/A',\n            (item.outstandingAmount || 0).toString(),\n            item.currencyCode || '',\n            (item.daysOverdue || 0).toString(),\n            status\n          ]);\n        } else {\n          rows.push([\n            item.orderNumber || 'N/A',\n            item.supplierName || 'Unknown Supplier',\n            item.orderDate ? format(new Date(item.orderDate), 'yyyy-MM-dd') : 'N/A',\n            item.dueDate ? format(new Date(item.dueDate), 'yyyy-MM-dd') : 'N/A',\n            (item.outstandingAmount || 0).toString(),\n            item.currencyCode || '',\n            (item.daysOverdue || 0).toString(),\n            status\n          ]);\n        }\n      });\n    });\n\n    const csvContent = [headers, ...rows]\n      .map(row => row.map(cell => `\"${cell}\"`).join(','))\n      .join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `aging-report-${reportType}-${format(new Date(), 'yyyy-MM-dd')}.csv`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const getBadgeVariant = (daysOverdue: number) => {\n    const days = daysOverdue || 0;\n    if (days <= 0) return \"default\";\n    if (days <= 30) return \"secondary\";\n    if (days <= 60) return \"outline\";\n    if (days <= 90) return \"destructive\";\n    return \"destructive\";\n  };\n\n  const getBadgeIcon = (daysOverdue: number) => {\n    const days = daysOverdue || 0;\n    if (days <= 0) return <CheckCircle className=\"w-3 h-3\" />;\n    if (days <= 30) return <Clock className=\"w-3 h-3\" />;\n    if (days <= 90) return <AlertTriangle className=\"w-3 h-3\" />;\n    return <AlertCircle className=\"w-3 h-3\" />;\n  };\n\n  const formatAmount = (amount: number, currencyCode?: string) => {\n    return formatCurrency(amount);\n  };\n\n  const renderBucketCard = (bucketName: string, bucketData: AgingBucketData[], total: number, label: string) => {\n    const grandTotal = agingReport?.grandTotal || 0;\n    const percentage = grandTotal > 0 ? Math.round((total / grandTotal) * 100) : 0;\n\n    return (\n      <Card key={bucketName} className=\"bg-white dark:bg-gray-800\" data-testid={`card-bucket-${bucketName}`}>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-sm font-medium flex items-center justify-between\">\n            <span data-testid={`text-bucket-${bucketName}`}>{label}</span>\n            <Badge variant={bucketName === 'current' ? 'default' : bucketName === 'over90' ? 'destructive' : 'secondary'} data-testid={`badge-count-${bucketName}`}>\n              {bucketData.length}\n            </Badge>\n          </CardTitle>\n          <CardDescription className=\"text-2xl font-bold\" data-testid={`text-amount-${bucketName}`}>\n            {formatAmount(total)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Progress value={percentage} className=\"mb-2\" data-testid={`progress-${bucketName}`} />\n          <p className=\"text-xs text-muted-foreground\" data-testid={`text-percentage-${bucketName}`}>{percentage}% of total outstanding</p>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-48 animate-pulse\"></div>\n            <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-64 mt-2 animate-pulse\"></div>\n          </div>\n          <div className=\"h-10 bg-gray-200 dark:bg-gray-700 rounded w-32 animate-pulse\"></div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n          {Array.from({ length: 5 }).map((_, i) => (\n            <div key={i} className=\"h-32 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\n          ))}\n        </div>\n        <div className=\"h-64 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\n      </div>\n    );\n  }\n\n  if (!agingReport) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"text-center py-12\">\n          <AlertTriangle className=\"mx-auto h-12 w-12 text-gray-400\" />\n          <h3 className=\"mt-4 text-lg font-semibold text-gray-900 dark:text-gray-100\">No Aging Data Available</h3>\n          <p className=\"mt-2 text-gray-600 dark:text-gray-400\">Unable to load aging report data. Please try again later.</p>\n        </div>\n      </div>\n    );\n  }\n\n  const buckets = [\n    { name: 'current', data: agingReport.buckets.current, total: agingReport.totals.current, label: 'Current (0 days)' },\n    { name: 'days30', data: agingReport.buckets.days30, total: agingReport.totals.days30, label: '1-30 Days' },\n    { name: 'days60', data: agingReport.buckets.days60, total: agingReport.totals.days60, label: '31-60 Days' },\n    { name: 'days90', data: agingReport.buckets.days90, total: agingReport.totals.days90, label: '61-90 Days' },\n    { name: 'over90', data: agingReport.buckets.over90, total: agingReport.totals.over90, label: '90+ Days' }\n  ];\n\n  const isReceivable = reportType === 'receivable';\n\n  return (\n    <div className=\"p-6 space-y-6 bg-gray-50 dark:bg-gray-900 min-h-screen\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100\" data-testid=\"text-title\">\n            Aging Reports\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\" data-testid=\"text-subtitle\">\n            Track outstanding {reportType === 'receivable' ? 'receivables' : 'payables'} by aging periods\n          </p>\n        </div>\n        <Button onClick={exportToCSV} className=\"bg-blue-600 hover:bg-blue-700\" data-testid=\"button-export\">\n          <Download className=\"w-4 h-4 mr-2\" />\n          Export CSV\n        </Button>\n      </div>\n\n      <Tabs value={reportType} onValueChange={(value) => setReportType(value as 'receivable' | 'payable')} data-testid=\"tabs-report-type\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"receivable\" data-testid=\"tab-receivable\">\n            Accounts Receivable\n          </TabsTrigger>\n          <TabsTrigger value=\"payable\" data-testid=\"tab-payable\">\n            Accounts Payable\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={reportType} className=\"space-y-6\">\n          {/* Summary Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n            {buckets.map(bucket => renderBucketCard(bucket.name, bucket.data, bucket.total, bucket.label))}\n          </div>\n\n          {/* Grand Total */}\n          <Card className=\"bg-white dark:bg-gray-800\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\" data-testid=\"text-grand-total-title\">\n                Total Outstanding {isReceivable ? 'Receivables' : 'Payables'}\n              </CardTitle>\n              <CardDescription className=\"text-3xl font-bold text-blue-600\" data-testid=\"text-grand-total\">\n                {formatAmount(agingReport?.grandTotal || 0)}\n              </CardDescription>\n            </CardHeader>\n          </Card>\n\n          {/* Detailed Table */}\n          <Card className=\"bg-white dark:bg-gray-800\">\n            <CardHeader>\n              <CardTitle data-testid=\"text-details-title\">Transaction Details</CardTitle>\n              <CardDescription>\n                Detailed breakdown of all outstanding {isReceivable ? 'receivables' : 'payables'}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <Table data-testid=\"table-details\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{isReceivable ? 'Invoice #' : 'Order #'}</TableHead>\n                      <TableHead>{isReceivable ? 'Customer' : 'Supplier'}</TableHead>\n                      <TableHead>{isReceivable ? 'Transaction Date' : 'Order Date'}</TableHead>\n                      <TableHead>Due Date</TableHead>\n                      <TableHead>Outstanding</TableHead>\n                      <TableHead>Days Overdue</TableHead>\n                      <TableHead>Status</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {buckets.map(bucket => \n                      bucket.data.map(item => (\n                        <TableRow key={item.id} data-testid={`row-transaction-${item.id}`}>\n                          <TableCell className=\"font-medium\" data-testid={`text-number-${item.id}`}>\n                            {isReceivable ? (item.invoiceNumber || 'N/A') : (item.orderNumber || 'N/A')}\n                          </TableCell>\n                          <TableCell data-testid={`text-entity-${item.id}`}>\n                            {isReceivable ? (item.customerName || 'Unknown Customer') : (item.supplierName || 'Unknown Supplier')}\n                          </TableCell>\n                          <TableCell data-testid={`text-date-${item.id}`}>\n                            {(() => {\n                              const dateValue = isReceivable ? item.transactionDate : item.orderDate;\n                              return dateValue ? format(new Date(dateValue), 'MMM dd, yyyy') : 'N/A';\n                            })()}\n                          </TableCell>\n                          <TableCell data-testid={`text-due-${item.id}`}>\n                            {item.dueDate ? format(new Date(item.dueDate), 'MMM dd, yyyy') : 'N/A'}\n                          </TableCell>\n                          <TableCell className=\"font-semibold\" data-testid={`text-amount-${item.id}`}>\n                            {formatAmount(item.outstandingAmount || 0, item.currencyCode)}\n                          </TableCell>\n                          <TableCell data-testid={`text-days-${item.id}`}>\n                            {(item.daysOverdue || 0) > 0 ? `${item.daysOverdue || 0} days` : '-'}\n                          </TableCell>\n                          <TableCell data-testid={`badge-status-${item.id}`}>\n                            {(() => {\n                              const daysOverdue = item.daysOverdue || 0;\n                              return (\n                                <Badge variant={getBadgeVariant(daysOverdue)} className=\"flex items-center gap-1 w-fit\">\n                                  {getBadgeIcon(daysOverdue)}\n                                  {daysOverdue <= 0 ? 'Current' : \n                                   daysOverdue <= 30 ? '1-30 Days' :\n                                   daysOverdue <= 60 ? '31-60 Days' :\n                                   daysOverdue <= 90 ? '61-90 Days' : '90+ Days'}\n                                </Badge>\n                              );\n                            })()}\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                    {buckets.every(bucket => bucket.data.length === 0) && (\n                      <TableRow>\n                        <TableCell colSpan={7} className=\"text-center py-8 text-gray-500\" data-testid=\"text-no-data\">\n                          No outstanding {isReceivable ? 'receivables' : 'payables'} found\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":14621},"client/src/pages/CashReconciliation.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { SalesTransaction, Expense } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\n\nexport default function CashReconciliation() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { formatCurrency, currencyConfig } = useCurrency();\n  const [shift, setShift] = useState(\"day\");\n  const [reconciliationDate, setReconciliationDate] = useState(new Date().toISOString().split('T')[0]);\n  const [denominations, setDenominations] = useState([\n    { value: 2000, count: 0, total: 0 },\n    { value: 500, count: 0, total: 0 },\n    { value: 200, count: 0, total: 0 },\n    { value: 100, count: 0, total: 0 },\n    { value: 50, count: 0, total: 0 },\n    { value: 20, count: 0, total: 0 },\n    { value: 10, count: 0, total: 0 },\n    { value: 5, count: 0, total: 0 },\n    { value: 2, count: 0, total: 0 },\n    { value: 1, count: 0, total: 0 }\n  ]);\n\n  // Calculate shift time range\n  const getShiftDateRange = () => {\n    const baseDate = new Date(reconciliationDate);\n    let startTime, endTime;\n    \n    if (shift === 'day') {\n      startTime = new Date(baseDate);\n      startTime.setHours(6, 0, 0, 0);\n      endTime = new Date(baseDate);\n      endTime.setHours(18, 0, 0, 0);\n    } else if (shift === 'night') {\n      startTime = new Date(baseDate);\n      startTime.setHours(18, 0, 0, 0);\n      endTime = new Date(baseDate);\n      endTime.setDate(endTime.getDate() + 1);\n      endTime.setHours(6, 0, 0, 0);\n    } else {\n      startTime = new Date(baseDate);\n      startTime.setHours(0, 0, 0, 0);\n      endTime = new Date(baseDate);\n      endTime.setHours(23, 59, 59, 999);\n    }\n    \n    return { startTime: startTime.toISOString(), endTime: endTime.toISOString() };\n  };\n\n  const { startTime, endTime } = getShiftDateRange();\n\n  // Fetch sales data for the selected shift\n  const { data: salesTransactions = [], isLoading: salesLoading } = useQuery<SalesTransaction[]>({\n    queryKey: [\"/api/sales\", user?.stationId, startTime, endTime],\n    enabled: !!user?.stationId,\n  });\n\n  // Fetch expenses data for the selected shift  \n  const { data: expenses = [], isLoading: expensesLoading } = useQuery<Expense[]>({\n    queryKey: [\"/api/expenses\", user?.stationId, startTime, endTime],\n    enabled: !!user?.stationId,\n  });\n\n  const isLoading = salesLoading || expensesLoading;\n\n  // Calculate real cash data based on transactions\n  const cashSales = salesTransactions\n    .filter((t: SalesTransaction) => t.paymentMethod === 'cash')\n    .reduce((sum: number, t: SalesTransaction) => sum + parseFloat(t.totalAmount || '0'), 0);\n\n  const cardSales = salesTransactions\n    .filter((t: SalesTransaction) => ['card', 'credit_card', 'debit_card'].includes(t.paymentMethod || ''))\n    .reduce((sum: number, t: SalesTransaction) => sum + parseFloat(t.totalAmount || '0'), 0);\n\n  const creditSales = salesTransactions\n    .filter((t: SalesTransaction) => t.paymentMethod === 'credit')\n    .reduce((sum: number, t: SalesTransaction) => sum + parseFloat(t.totalAmount || '0'), 0);\n\n  const totalExpenses = expenses\n    .reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0);\n\n  const openingBalance = 5000; // This could be from previous day's closing or a settings table\n  const expectedCash = openingBalance + cashSales - totalExpenses;\n  const actualCash = denominations.reduce((sum, d) => sum + d.total, 0);\n  const difference = actualCash - expectedCash;\n\n  const cashData = {\n    openingBalance,\n    expectedCash,\n    actualCash,\n    difference,\n    cashSales,\n    cardSales,\n    creditSales,\n    expenses: totalExpenses\n  };\n\n  // Handle denomination count changes\n  const updateDenomination = (index: number, count: number) => {\n    const newDenominations = [...denominations];\n    newDenominations[index].count = Math.max(0, count);\n    newDenominations[index].total = newDenominations[index].value * newDenominations[index].count;\n    setDenominations(newDenominations);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n            {[...Array(4)].map((_, i) => (\n              <div key={i} className=\"h-24 bg-muted rounded\"></div>\n            ))}\n          </div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Cash Reconciliation</h3>\n          <p className=\"text-muted-foreground\">Daily cash balancing and shift-wise reporting</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Button data-testid=\"button-start-reconciliation\">\n            ðŸ”„ Start Reconciliation\n          </Button>\n          <Button variant=\"outline\" data-testid=\"button-print-report\">\n            ðŸ–¨ï¸ Print Report\n          </Button>\n        </div>\n      </div>\n\n      {/* Reconciliation Controls */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-card-foreground mb-2\">Shift</label>\n              <Select value={shift} onValueChange={setShift}>\n                <SelectTrigger data-testid=\"select-shift\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"day\">Day Shift (6 AM - 6 PM)</SelectItem>\n                  <SelectItem value=\"night\">Night Shift (6 PM - 6 AM)</SelectItem>\n                  <SelectItem value=\"full\">Full Day (24 Hours)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-card-foreground mb-2\">Date</label>\n              <Input\n                type=\"date\"\n                value={reconciliationDate}\n                onChange={(e) => setReconciliationDate(e.target.value)}\n                data-testid=\"input-reconciliation-date\"\n              />\n            </div>\n            <div className=\"flex items-end\">\n              <Button className=\"w-full\" data-testid=\"button-load-data\">\n                Load Shift Data\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Cash Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card className=\"bg-gradient-to-br from-green-500 to-green-600 text-white border-0\">\n          <CardContent className=\"p-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\" data-testid=\"opening-balance\">{formatCurrency(cashData.openingBalance)}</div>\n              <div className=\"text-sm text-green-100\">Opening Balance</div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0\">\n          <CardContent className=\"p-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\" data-testid=\"expected-cash\">{formatCurrency(cashData.expectedCash)}</div>\n              <div className=\"text-sm text-blue-100\">Expected Cash</div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0\">\n          <CardContent className=\"p-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\" data-testid=\"actual-cash\">{formatCurrency(cashData.actualCash)}</div>\n              <div className=\"text-sm text-purple-100\">Actual Cash</div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"bg-gradient-to-br from-red-500 to-red-600 text-white border-0\">\n          <CardContent className=\"p-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold\" data-testid=\"cash-difference\">{formatCurrency(Math.abs(cashData.difference))}</div>\n              <div className=\"text-sm text-red-100\">\n                {cashData.difference >= 0 ? 'Excess' : 'Shortage'}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Cash Counting */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Cash Denomination Count</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {denominations.map((denom, index) => (\n                <div key={denom.value} className=\"grid grid-cols-4 gap-4 items-center\">\n                  <div className=\"font-medium\">{currencyConfig.symbol}{denom.value}</div>\n                  <div className=\"text-center\">Ã—</div>\n                  <Input\n                    type=\"number\"\n                    value={denom.count}\n                    onChange={(e) => updateDenomination(index, parseInt(e.target.value) || 0)}\n                    className=\"text-center\"\n                    data-testid={`denom-count-${denom.value}`}\n                  />\n                  <div className=\"text-right font-semibold\" data-testid={`denom-total-${denom.value}`}>\n                    {formatCurrency(denom.total)}\n                  </div>\n                </div>\n              ))}\n              <div className=\"border-t pt-3 mt-4\">\n                <div className=\"grid grid-cols-4 gap-4 font-bold\">\n                  <div>Total Cash:</div>\n                  <div></div>\n                  <div></div>\n                  <div className=\"text-right text-lg\" data-testid=\"total-counted-cash\">\n                    {formatCurrency(cashData.actualCash)}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Sales Summary */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Shift Sales Summary</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center p-3 bg-green-50 rounded-md\">\n                <span className=\"font-medium\">Cash Sales</span>\n                <span className=\"text-lg font-bold text-green-600\" data-testid=\"cash-sales\">\n                  {formatCurrency(cashData.cashSales)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center p-3 bg-blue-50 rounded-md\">\n                <span className=\"font-medium\">Card Sales</span>\n                <span className=\"text-lg font-bold text-blue-600\" data-testid=\"card-sales\">\n                  {formatCurrency(cashData.cardSales)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center p-3 bg-orange-50 rounded-md\">\n                <span className=\"font-medium\">Credit Sales</span>\n                <span className=\"text-lg font-bold text-orange-600\" data-testid=\"credit-sales\">\n                  {formatCurrency(cashData.creditSales)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center p-3 bg-red-50 rounded-md\">\n                <span className=\"font-medium\">Expenses Paid</span>\n                <span className=\"text-lg font-bold text-red-600\" data-testid=\"expenses-paid\">\n                  {formatCurrency(cashData.expenses)}\n                </span>\n              </div>\n              \n              <div className=\"border-t pt-4 mt-6\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-lg font-semibold\">Net Cash Movement:</span>\n                  <span className=\"text-xl font-bold text-primary\" data-testid=\"net-cash-movement\">\n                    {formatCurrency(cashData.cashSales - cashData.expenses)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Reconciliation Status */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Reconciliation Status</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-between p-4 bg-muted rounded-lg\">\n            <div>\n              <div className=\"font-semibold text-lg\">\n                Cash Reconciliation - {shift.charAt(0).toUpperCase() + shift.slice(1)} Shift\n              </div>\n              <div className=\"text-sm text-muted-foreground\">\n                Date: {new Date(reconciliationDate).toLocaleDateString('en-IN')}\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <Badge\n                variant={Math.abs(cashData.difference) <= 100 ? 'default' : 'destructive'}\n                className={Math.abs(cashData.difference) <= 100 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}\n                data-testid=\"reconciliation-status\"\n              >\n                {Math.abs(cashData.difference) <= 100 ? 'Balanced' : 'Variance Detected'}\n              </Badge>\n              {cashData.difference !== 0 && (\n                <div className={`mt-2 font-semibold ${cashData.difference > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {cashData.difference > 0 ? 'Excess: ' : 'Shortage: '}\n                  {formatCurrency(Math.abs(cashData.difference))}\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"mt-4 flex justify-end space-x-2\">\n            <Button variant=\"outline\" data-testid=\"button-save-draft\">\n              Save Draft\n            </Button>\n            <Button data-testid=\"button-complete-reconciliation\">\n              Complete Reconciliation\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":14622},"client/src/pages/CustomerManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport type { Customer } from \"@shared/schema\";\nimport { insertCustomerSchema } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Eye, Edit, CreditCard } from \"lucide-react\";\n\nexport default function CustomerManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  const { currencyConfig } = useCurrency() || { currencyConfig: { symbol: 'â‚¹' } };\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [paymentDialogOpen, setPaymentDialogOpen] = useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n\n  // Edit form\n  const editForm = useForm({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: \"\",\n      type: \"walk-in\",\n      contactPhone: \"\",\n      contactEmail: \"\",\n      address: \"\",\n      gstNumber: \"\",\n      creditLimit: \"0\",\n      outstandingAmount: \"0\",\n    },\n  });\n\n  // Payment form\n  const paymentForm = useForm({\n    resolver: zodResolver(z.object({\n      amount: z.string().min(1, \"Amount is required\"),\n      paymentMethod: z.enum(['cash', 'card']),\n      referenceNumber: z.string().optional(),\n      notes: z.string().optional(),\n    })),\n    defaultValues: {\n      amount: \"\",\n      paymentMethod: \"cash\" as const,\n      referenceNumber: \"\",\n      notes: \"\",\n    },\n  });\n\n  const form = useForm({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: \"\",\n      type: \"walk-in\" as const,\n      contactPhone: \"\",\n      contactEmail: \"\",\n      address: \"\",\n      gstNumber: \"\",\n      creditLimit: \"0\",\n      outstandingAmount: \"0\",\n    },\n  });\n\n  const updateCustomerMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const response = await apiRequest(\"PUT\", `/api/customers/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Customer updated\",\n        description: \"Customer information has been updated successfully\",\n      });\n      setEditDialogOpen(false);\n      editForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update customer\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const recordPaymentMutation = useMutation({\n    mutationFn: async (paymentData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/payments\", paymentData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payment recorded\",\n        description: \"Payment has been recorded successfully\",\n      });\n      setPaymentDialogOpen(false);\n      paymentForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createCustomerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/customers\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Customer created\",\n        description: \"New customer has been added successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create customer\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createCustomerMutation.mutate(data);\n  };\n\n  const handleViewCustomer = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    setViewDialogOpen(true);\n  };\n\n  const handleEditCustomer = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    editForm.reset({\n      name: customer.name,\n      type: customer.type,\n      contactPhone: customer.contactPhone || \"\",\n      contactEmail: customer.contactEmail || \"\",\n      address: customer.address || \"\",\n      gstNumber: customer.gstNumber || \"\",\n      creditLimit: customer.creditLimit || \"0\",\n      outstandingAmount: customer.outstandingAmount || \"0\",\n    });\n    setEditDialogOpen(true);\n  };\n\n  const handlePaymentCustomer = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    paymentForm.reset({\n      amount: \"\",\n      paymentMethod: \"cash\" as const,\n      referenceNumber: \"\",\n      notes: \"\",\n    });\n    setPaymentDialogOpen(true);\n  };\n\n  const onEditSubmit = (data: any) => {\n    if (!selectedCustomer) return;\n    updateCustomerMutation.mutate({ id: selectedCustomer.id, data });\n  };\n\n  const onPaymentSubmit = (data: any) => {\n    if (!selectedCustomer || !user) return;\n    \n    if (!user.id) {\n      toast({\n        title: \"Error\",\n        description: \"User authentication required to record payment\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const paymentData = {\n      customerId: selectedCustomer.id,\n      amount: data.amount,\n      paymentMethod: data.paymentMethod,\n      referenceNumber: data.referenceNumber,\n      notes: data.notes,\n      type: \"receivable\",\n      stationId: user.stationId || \"default-station\",\n      userId: user.id,\n      currencyCode: \"PKR\",\n    };\n    recordPaymentMutation.mutate(paymentData);\n  };\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const filteredCustomers = customers.filter((customer: Customer) => {\n    const matchesSearch = customer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         customer.gstNumber?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesType = filterType === \"all\" || customer.type === filterType;\n    return matchesSearch && matchesType;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n            {[...Array(4)].map((_, i) => (\n              <div key={i} className=\"h-20 bg-muted rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const creditCustomers = customers.filter((c: Customer) => c.type === 'credit').length;\n  const totalOutstanding = customers.reduce((sum: number, c: Customer) => sum + parseFloat(c.outstandingAmount || '0'), 0);\n  const overdueAccounts = customers.filter((c: Customer) => parseFloat(c.outstandingAmount || '0') > 0).length;\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Customer Account Management</h3>\n          <p className=\"text-muted-foreground\">Manage customer profiles, credit accounts, and payment history</p>\n        </div>\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-customer\">\n              + Add New Customer\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Add New Customer</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Customer Name *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter customer name\" {...field} data-testid=\"input-customer-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"type\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Customer Type *</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-customer-type\">\n                            <SelectValue placeholder=\"Select customer type\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"walk-in\">Walk-in</SelectItem>\n                          <SelectItem value=\"credit\">Credit Customer</SelectItem>\n                          <SelectItem value=\"fleet\">Fleet Customer</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"contactPhone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter phone number\" {...field} data-testid=\"input-customer-phone\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"contactEmail\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email Address</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"Enter email address\" {...field} data-testid=\"input-customer-email\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter address\" {...field} data-testid=\"input-customer-address\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"gstNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>GST Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter GST number\" {...field} data-testid=\"input-customer-gst\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"creditLimit\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Credit Limit ({currencyConfig.symbol})</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" placeholder=\"0\" {...field} data-testid=\"input-customer-credit-limit\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createCustomerMutation.isPending} data-testid=\"button-submit-customer\">\n                    {createCustomerMutation.isPending ? \"Creating...\" : \"Create Customer\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Customer Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"total-customers\">{customers.length}</div>\n            <div className=\"text-sm text-muted-foreground\">Total Customers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"credit-customers\">{creditCustomers}</div>\n            <div className=\"text-sm text-muted-foreground\">Credit Customers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"outstanding-total\">\n              â‚¹{totalOutstanding.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Outstanding Amount</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"overdue-accounts\">{overdueAccounts}</div>\n            <div className=\"text-sm text-muted-foreground\">Overdue Accounts</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Customer List */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Customer Accounts</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search customers...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-64\"\n                data-testid=\"input-search-customers\"\n              />\n              <Select value={filterType} onValueChange={setFilterType}>\n                <SelectTrigger className=\"w-40\" data-testid=\"select-filter-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Customers</SelectItem>\n                  <SelectItem value=\"credit\">Credit Customers</SelectItem>\n                  <SelectItem value=\"walk-in\">Cash Customers</SelectItem>\n                  <SelectItem value=\"fleet\">Fleet Customers</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Customer</th>\n                  <th className=\"text-left p-3 font-medium\">Type</th>\n                  <th className=\"text-right p-3 font-medium\">Credit Limit</th>\n                  <th className=\"text-right p-3 font-medium\">Outstanding</th>\n                  <th className=\"text-center p-3 font-medium\">Last Transaction</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredCustomers.map((customer: Customer, index: number) => (\n                  <tr key={customer.id} className=\"border-b border-border hover:bg-muted/50\">\n                    <td className=\"p-3\">\n                      <div className=\"font-medium text-card-foreground\" data-testid={`customer-name-${index}`}>\n                        {customer.name}\n                      </div>\n                      {customer.gstNumber && (\n                        <div className=\"text-sm text-muted-foreground\">GST: {customer.gstNumber}</div>\n                      )}\n                    </td>\n                    <td className=\"p-3\">\n                      <Badge \n                        variant={customer.type === 'credit' ? 'default' : 'secondary'}\n                        data-testid={`customer-type-${index}`}\n                      >\n                        {customer.type}\n                      </Badge>\n                    </td>\n                    <td className=\"p-3 text-right\" data-testid={`credit-limit-${index}`}>\n                      {customer.type === 'credit' ? `â‚¹${parseFloat(customer.creditLimit || '0').toLocaleString()}` : '-'}\n                    </td>\n                    <td className=\"p-3 text-right\">\n                      <span \n                        className={`font-semibold ${parseFloat(customer.outstandingAmount || '0') > 0 ? 'text-red-600' : 'text-green-600'}`}\n                        data-testid={`outstanding-${index}`}\n                      >\n                        {parseFloat(customer.outstandingAmount || '0') > 0 \n                          ? `â‚¹${parseFloat(customer.outstandingAmount || '0').toLocaleString()}` \n                          : '-'}\n                      </span>\n                    </td>\n                    <td className=\"p-3 text-center text-sm\">2 hours ago</td>\n                    <td className=\"p-3 text-center\">\n                      <Badge \n                        variant={customer.isActive ? 'default' : 'destructive'}\n                        className={customer.isActive ? 'bg-green-100 text-green-800' : ''}\n                      >\n                        {customer.isActive ? 'Active' : 'Inactive'}\n                      </Badge>\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleViewCustomer(customer)}\n                          className=\"text-blue-600 hover:text-blue-800 p-1\"\n                          data-testid={`button-view-${index}`}\n                        >\n                          <Eye className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEditCustomer(customer)}\n                          className=\"text-green-600 hover:text-green-800 p-1\"\n                          data-testid={`button-edit-${index}`}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handlePaymentCustomer(customer)}\n                          className=\"text-purple-600 hover:text-purple-800 p-1\"\n                          data-testid={`button-payment-${index}`}\n                        >\n                          <CreditCard className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n                {filteredCustomers.length === 0 && (\n                  <tr>\n                    <td colSpan={7} className=\"p-8 text-center text-muted-foreground\">\n                      No customers found matching your criteria.\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* View Customer Dialog */}\n      <Dialog open={viewDialogOpen} onOpenChange={setViewDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Customer Details</DialogTitle>\n          </DialogHeader>\n          {selectedCustomer && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">Name</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedCustomer.name}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Type</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedCustomer.type}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Phone</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedCustomer.contactPhone || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Email</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedCustomer.contactEmail || 'N/A'}</p>\n                </div>\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium\">Address</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedCustomer.address || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Credit Limit</label>\n                  <p className=\"text-sm text-muted-foreground\">â‚¹{parseFloat(selectedCustomer.creditLimit || '0').toLocaleString()}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Outstanding</label>\n                  <p className=\"text-sm text-muted-foreground\">â‚¹{parseFloat(selectedCustomer.outstandingAmount || '0').toLocaleString()}</p>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Customer Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Customer</DialogTitle>\n          </DialogHeader>\n          <Form {...editForm}>\n            <form onSubmit={editForm.handleSubmit(onEditSubmit)} className=\"space-y-4\">\n              <FormField\n                control={editForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Customer Name *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter customer name\" {...field} data-testid=\"input-edit-customer-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editForm.control}\n                name=\"type\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Customer Type *</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-edit-customer-type\">\n                          <SelectValue placeholder=\"Select customer type\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"walk-in\">Walk-in</SelectItem>\n                        <SelectItem value=\"credit\">Credit Customer</SelectItem>\n                        <SelectItem value=\"fleet\">Fleet Customer</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"contactPhone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter phone number\" {...field} data-testid=\"input-edit-customer-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"contactEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email Address</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Enter email address\" {...field} data-testid=\"input-edit-customer-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <FormField\n                control={editForm.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Address</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter address\" {...field} data-testid=\"input-edit-customer-address\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"gstNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>GST Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter GST number\" {...field} data-testid=\"input-edit-customer-gst\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"creditLimit\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Credit Limit ({currencyConfig.symbol})</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" placeholder=\"0\" {...field} data-testid=\"input-edit-customer-credit-limit\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <div className=\"flex justify-end space-x-2 pt-4\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setEditDialogOpen(false)} data-testid=\"button-cancel-edit\">\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={updateCustomerMutation.isPending} data-testid=\"button-update-customer\">\n                  {updateCustomerMutation.isPending ? \"Updating...\" : \"Update Customer\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Payment Dialog */}\n      <Dialog open={paymentDialogOpen} onOpenChange={setPaymentDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Record Payment</DialogTitle>\n            {selectedCustomer && (\n              <p className=\"text-sm text-muted-foreground\">\n                Recording payment for {selectedCustomer.name} (Outstanding: â‚¹{parseFloat(selectedCustomer.outstandingAmount || '0').toLocaleString()})\n              </p>\n            )}\n          </DialogHeader>\n          <Form {...paymentForm}>\n            <form onSubmit={paymentForm.handleSubmit(onPaymentSubmit)} className=\"space-y-4\">\n              <FormField\n                control={paymentForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Payment Amount *</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" step=\"0.01\" placeholder=\"Enter payment amount\" {...field} data-testid=\"input-payment-amount\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"paymentMethod\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Payment Method *</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-payment-method\">\n                          <SelectValue placeholder=\"Select payment method\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"cash\">Cash</SelectItem>\n                        <SelectItem value=\"card\">Card</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"referenceNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Reference Number</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter reference number (optional)\" {...field} data-testid=\"input-reference-number\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Add any notes (optional)\" {...field} data-testid=\"input-payment-notes\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"flex justify-end space-x-2 pt-4\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setPaymentDialogOpen(false)} data-testid=\"button-cancel-payment\">\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={recordPaymentMutation.isPending} data-testid=\"button-record-payment\">\n                  {recordPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":32804},"client/src/pages/DailyReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { formatAmount } from \"@/lib/currency\";\nimport { \n  Calendar as CalendarIcon,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  CreditCard,\n  Banknote,\n  Receipt,\n  Download,\n  RefreshCw,\n  PieChart,\n  BarChart3\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SalesByMethod {\n  paymentMethod: string;\n  totalAmount: string;\n  count: number;\n  currencyCode: string;\n}\n\ninterface ExpensesByCategory {\n  category: string;\n  totalAmount: string;\n  currencyCode: string;\n}\n\ninterface DailyReportData {\n  date: string;\n  salesByMethod: SalesByMethod[];\n  expenses: ExpensesByCategory[];\n}\n\nexport default function DailyReports() {\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const [selectedDate, setSelectedDate] = useState<Date>(new Date());\n\n  const { data: dailyReport, isLoading, refetch } = useQuery<DailyReportData>({\n    queryKey: [`/api/reports/daily/${user?.stationId}?date=${format(selectedDate, 'yyyy-MM-dd')}`],\n    enabled: !!user?.stationId,\n    refetchInterval: 30000, // Refresh every 30 seconds for near real-time data\n  });\n\n  const handleDateSelect = (date: Date | undefined) => {\n    if (date) {\n      setSelectedDate(date);\n    }\n  };\n\n  const handleRefresh = () => {\n    refetch();\n  };\n\n  const handleExport = () => {\n    // Create CSV export\n    if (!dailyReport) return;\n    \n    const csvContent = [\n      ['Daily Report - ' + format(selectedDate, 'PPP')],\n      [''],\n      ['Sales by Payment Method'],\n      ['Method', 'Amount', 'Count', 'Currency'],\n      ...dailyReport.salesByMethod.map(item => [\n        item.paymentMethod,\n        item.totalAmount,\n        item.count.toString(),\n        item.currencyCode\n      ]),\n      [''],\n      ['Expenses by Category'],\n      ['Category', 'Amount', 'Currency'],\n      ...dailyReport.expenses.map(item => [\n        item.category,\n        item.totalAmount,\n        item.currencyCode\n      ])\n    ].map(row => row.join(',')).join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `daily-report-${format(selectedDate, 'yyyy-MM-dd')}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n  };\n\n  const getPaymentMethodIcon = (method: string) => {\n    switch (method.toLowerCase()) {\n      case 'cash':\n        return <Banknote className=\"w-5 h-5 text-green-500\" />;\n      case 'card':\n        return <CreditCard className=\"w-5 h-5 text-blue-500\" />;\n      case 'credit':\n        return <Receipt className=\"w-5 h-5 text-orange-500\" />;\n      case 'fleet':\n        return <DollarSign className=\"w-5 h-5 text-purple-500\" />;\n      default:\n        return <DollarSign className=\"w-5 h-5 text-gray-500\" />;\n    }\n  };\n\n  const totalSales = dailyReport?.salesByMethod.reduce(\n    (sum, item) => sum + parseFloat(item.totalAmount || '0'), 0\n  ) || 0;\n\n  const totalTransactions = dailyReport?.salesByMethod.reduce(\n    (sum, item) => sum + (item.count || 0), 0\n  ) || 0;\n\n  const totalExpenses = dailyReport?.expenses.reduce(\n    (sum, item) => sum + parseFloat(item.totalAmount || '0'), 0\n  ) || 0;\n\n  const netProfit = totalSales - totalExpenses;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n            {[1, 2, 3, 4].map((i) => (\n              <div key={i} className=\"h-32 bg-muted rounded\"></div>\n            ))}\n          </div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\" data-testid=\"page-title\">Daily Reports</h1>\n          <p className=\"text-muted-foreground\">\n            Daily sales and expense breakdown for {format(selectedDate, 'PPP')}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleRefresh}\n            size=\"sm\"\n            data-testid=\"button-refresh\"\n          >\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\n            Refresh\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleExport}\n            size=\"sm\"\n            disabled={!dailyReport}\n            data-testid=\"button-export\"\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            Export CSV\n          </Button>\n        </div>\n      </div>\n\n      {/* Date Selector */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"w-5 h-5\" />\n            Report Date\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Popover>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"outline\"\n                className={cn(\n                  \"w-[240px] justify-start text-left font-normal\",\n                  !selectedDate && \"text-muted-foreground\"\n                )}\n                data-testid=\"button-date-picker\"\n              >\n                <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                {selectedDate ? format(selectedDate, \"PPP\") : <span>Pick a date</span>}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-auto p-0\" align=\"start\">\n              <Calendar\n                mode=\"single\"\n                selected={selectedDate}\n                onSelect={handleDateSelect}\n                disabled={(date) =>\n                  date > new Date() || date < new Date(\"2023-01-01\")\n                }\n                initialFocus\n                data-testid=\"calendar-picker\"\n              />\n            </PopoverContent>\n          </Popover>\n        </CardContent>\n      </Card>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Sales</p>\n                <p className=\"text-3xl font-bold text-green-600\" data-testid=\"total-sales\">\n                  {formatAmount(totalSales)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">{totalTransactions} transactions</p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Expenses</p>\n                <p className=\"text-3xl font-bold text-red-600\" data-testid=\"total-expenses\">\n                  {formatAmount(totalExpenses)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">Daily operational costs</p>\n              </div>\n              <TrendingDown className=\"w-8 h-8 text-red-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Net Profit</p>\n                <p className={`text-3xl font-bold ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}`} data-testid=\"net-profit\">\n                  {formatAmount(netProfit)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">Sales - Expenses</p>\n              </div>\n              <DollarSign className={`w-8 h-8 ${netProfit >= 0 ? 'text-green-500' : 'text-red-500'}`} />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Avg Transaction</p>\n                <p className=\"text-3xl font-bold text-blue-600\" data-testid=\"avg-transaction\">\n                  {formatAmount(totalTransactions > 0 ? totalSales / totalTransactions : 0)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">Per transaction</p>\n              </div>\n              <BarChart3 className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Sales by Payment Method */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <PieChart className=\"w-5 h-5\" />\n              Sales by Payment Method\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {dailyReport?.salesByMethod && dailyReport.salesByMethod.length > 0 ? (\n              dailyReport.salesByMethod.map((sale, index) => {\n                const percentage = totalSales > 0 ? (parseFloat(sale.totalAmount || '0') / totalSales) * 100 : 0;\n                return (\n                  <div key={`${sale.paymentMethod}-${sale.currencyCode}`} className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        {getPaymentMethodIcon(sale.paymentMethod)}\n                        <span className=\"font-medium capitalize\" data-testid={`payment-method-${index}`}>\n                          {sale.paymentMethod}\n                        </span>\n                        <Badge variant=\"outline\" data-testid={`payment-currency-${index}`}>\n                          {sale.currencyCode}\n                        </Badge>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-semibold\" data-testid={`payment-amount-${index}`}>\n                          {formatAmount(parseFloat(sale.totalAmount || '0'), sale.currencyCode as any)}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\" data-testid={`payment-count-${index}`}>\n                          {sale.count} transactions\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"w-full bg-muted rounded-full h-2\">\n                      <div\n                        className=\"bg-primary h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${percentage}%` }}\n                        data-testid={`payment-progress-${index}`}\n                      ></div>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground text-right\">\n                      {percentage.toFixed(1)}% of total sales\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <PieChart className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p>No sales data for this date</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Expenses by Category */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingDown className=\"w-5 h-5\" />\n              Expenses by Category\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {dailyReport?.expenses && dailyReport.expenses.length > 0 ? (\n              dailyReport.expenses.map((expense, index) => {\n                const percentage = totalExpenses > 0 ? (parseFloat(expense.totalAmount || '0') / totalExpenses) * 100 : 0;\n                return (\n                  <div key={`${expense.category}-${expense.currencyCode}`} className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-4 h-4 bg-red-500 rounded-sm\"></div>\n                        <span className=\"font-medium capitalize\" data-testid={`expense-category-${index}`}>\n                          {expense.category}\n                        </span>\n                        <Badge variant=\"outline\" data-testid={`expense-currency-${index}`}>\n                          {expense.currencyCode}\n                        </Badge>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-semibold text-red-600\" data-testid={`expense-amount-${index}`}>\n                          {formatAmount(parseFloat(expense.totalAmount || '0'), expense.currencyCode as any)}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"w-full bg-muted rounded-full h-2\">\n                      <div\n                        className=\"bg-red-500 h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${percentage}%` }}\n                        data-testid={`expense-progress-${index}`}\n                      ></div>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground text-right\">\n                      {percentage.toFixed(1)}% of total expenses\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <TrendingDown className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p>No expenses recorded for this date</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Breakdown */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Daily Summary</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            {/* Sales Summary */}\n            <div className=\"space-y-4\">\n              <h3 className=\"font-semibold text-lg flex items-center gap-2\">\n                <TrendingUp className=\"w-5 h-5 text-green-500\" />\n                Sales Summary\n              </h3>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Total Revenue:</span>\n                  <span className=\"font-medium text-green-600\" data-testid=\"summary-revenue\">\n                    {formatAmount(totalSales)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Total Transactions:</span>\n                  <span className=\"font-medium\" data-testid=\"summary-transactions\">\n                    {totalTransactions}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Average Sale:</span>\n                  <span className=\"font-medium\" data-testid=\"summary-avg-sale\">\n                    {formatAmount(totalTransactions > 0 ? totalSales / totalTransactions : 0)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <Separator orientation=\"vertical\" className=\"hidden md:block\" />\n\n            {/* Expense Summary */}\n            <div className=\"space-y-4\">\n              <h3 className=\"font-semibold text-lg flex items-center gap-2\">\n                <TrendingDown className=\"w-5 h-5 text-red-500\" />\n                Expense Summary\n              </h3>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Total Expenses:</span>\n                  <span className=\"font-medium text-red-600\" data-testid=\"summary-total-expenses\">\n                    {formatAmount(totalExpenses)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Categories:</span>\n                  <span className=\"font-medium\" data-testid=\"summary-expense-categories\">\n                    {dailyReport?.expenses.length || 0}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Expense Ratio:</span>\n                  <span className=\"font-medium\" data-testid=\"summary-expense-ratio\">\n                    {totalSales > 0 ? ((totalExpenses / totalSales) * 100).toFixed(1) : 0}%\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <Separator orientation=\"vertical\" className=\"hidden md:block\" />\n\n            {/* Profit Summary */}\n            <div className=\"space-y-4\">\n              <h3 className=\"font-semibold text-lg flex items-center gap-2\">\n                <DollarSign className={`w-5 h-5 ${netProfit >= 0 ? 'text-green-500' : 'text-red-500'}`} />\n                Profit Analysis\n              </h3>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Net Profit:</span>\n                  <span className={`font-medium ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}`} data-testid=\"summary-net-profit\">\n                    {formatAmount(netProfit)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Profit Margin:</span>\n                  <span className={`font-medium ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}`} data-testid=\"summary-profit-margin\">\n                    {totalSales > 0 ? ((netProfit / totalSales) * 100).toFixed(1) : 0}%\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Status:</span>\n                  <Badge \n                    variant={netProfit >= 0 ? 'default' : 'destructive'}\n                    data-testid=\"summary-profit-status\"\n                  >\n                    {netProfit >= 0 ? 'Profitable' : 'Loss'}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* No Data State */}\n      {(!dailyReport?.salesByMethod || dailyReport.salesByMethod.length === 0) && \n       (!dailyReport?.expenses || dailyReport.expenses.length === 0) && (\n        <Card>\n          <CardContent className=\"text-center py-12\">\n            <BarChart3 className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No Data Available</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              No sales or expense data found for {format(selectedDate, 'PPP')}.\n            </p>\n            <p className=\"text-sm text-muted-foreground\">\n              Try selecting a different date or check if transactions were recorded.\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":20268},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Line, LineChart, ResponsiveContainer, XAxis, YAxis } from \"recharts\";\nimport type { Tank, SalesTransaction, Customer, Product } from \"@shared/schema\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { useLocation } from \"wouter\";\nimport { Download, FileText, ShoppingCart, Users, BarChart3, AlertCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  const { formatCurrency, formatCurrencyCompact } = useCurrency();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const { data: dashboardStats, isLoading: statsLoading } = useQuery({\n    queryKey: [\"/api/dashboard\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: tanks = [], isLoading: tanksLoading } = useQuery<Tank[]>({\n    queryKey: [\"/api/tanks\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: recentSales = [], isLoading: salesLoading } = useQuery<SalesTransaction[]>({\n    queryKey: [\"/api/sales\", user?.stationId, \"recent\"],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  // Calculate chart data from dashboard stats (last 7 days)\n  const generateChartData = () => {\n    if (!dashboardStats || typeof dashboardStats !== 'object' || !('weeklySales' in dashboardStats)) return [];\n    \n    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    const today = new Date().getDay();\n    const chartData = [];\n    \n    for (let i = 6; i >= 0; i--) {\n      const dayIndex = (today - i + 7) % 7;\n      const dayData = (dashboardStats as any).weeklySales?.find((d: any) => d.dayOfWeek === dayIndex);\n      chartData.push({\n        day: days[dayIndex],\n        sales: dayData ? parseFloat(dayData.totalAmount || '0') : 0\n      });\n    }\n    return chartData;\n  };\n\n  // Calculate stock value from tanks\n  const calculateStockValue = () => {\n    if (!tanks.length || !products.length) return 0;\n    \n    return tanks.reduce((total, tank) => {\n      const product = products.find(p => p.id === tank.productId);\n      if (product) {\n        const stockValue = parseFloat(tank.currentStock || '0') * parseFloat(product.currentPrice || '0');\n        return total + stockValue;\n      }\n      return total;\n    }, 0);\n  };\n\n  // Get overdue customers count\n  const getOverdueCustomersCount = () => {\n    return customers.filter((customer: Customer) => \n      parseFloat(customer.outstandingAmount || '0') > 0\n    ).length;\n  };\n\n  // Quick action handlers\n  const handleNewSale = () => {\n    setLocation('/pos');\n  };\n\n  const handleViewReports = () => {\n    setLocation('/financial-reports');\n  };\n\n  const handleStockStatus = () => {\n    setLocation('/stock');\n  };\n\n  const handleCustomerPayments = () => {\n    setLocation('/accounts-receivable');\n  };\n\n  const handleTankMonitoring = () => {\n    setLocation('/tanks');\n  };\n\n  const handleDailyReports = () => {\n    setLocation('/daily-reports');\n  };\n\n\n  const isLoading = statsLoading || tanksLoading || salesLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[...Array(4)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-20 bg-muted rounded\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8 fade-in\">\n      {/* Key Performance Indicators */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card className=\"bg-gradient-to-br from-green-500 to-green-600 text-white border-0\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-green-100 text-sm font-medium\">Today's Sales</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"todays-sales\">\n                  {formatCurrency((dashboardStats as any)?.todaysSales?.totalAmount || 0)}\n                </p>\n                <p className=\"text-green-100 text-sm\">{(dashboardStats as any)?.todaysSales?.count || 0} transactions</p>\n              </div>\n              <div className=\"text-4xl opacity-80\">ðŸ’°</div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <span className=\"text-green-100 text-xs\">+12% vs yesterday</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-blue-100 text-sm font-medium\">Monthly Revenue</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"monthly-revenue\">\n                  {formatCurrency((dashboardStats as any)?.monthlySales?.totalAmount ? parseFloat((dashboardStats as any).monthlySales.totalAmount) : 0)}\n                </p>\n                <p className=\"text-blue-100 text-sm\">{(dashboardStats as any)?.monthlySales?.count || 0} transactions total</p>\n              </div>\n              <div className=\"text-4xl opacity-80\">ðŸ“ˆ</div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <span className=\"text-blue-100 text-xs\">On track for target</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-purple-100 text-sm font-medium\">Stock Value</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"stock-value\">\n                  {formatCurrencyCompact(calculateStockValue())}\n                </p>\n                <p className=\"text-purple-100 text-sm\">All tanks combined</p>\n              </div>\n              <div className=\"text-4xl opacity-80\">ðŸ›¢ï¸</div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <span className=\"text-purple-100 text-xs\">3 days avg inventory</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-orange-100 text-sm font-medium\">Outstanding</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"outstanding-amount\">\n                  {formatCurrencyCompact((dashboardStats as any)?.outstanding?.totalOutstanding ? parseFloat((dashboardStats as any).outstanding.totalOutstanding) : 0)}\n                </p>\n                <p className=\"text-orange-100 text-sm\">Credit customers</p>\n              </div>\n              <div className=\"text-4xl opacity-80\">â°</div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <span className=\"text-orange-100 text-xs\">{getOverdueCustomersCount()} customers pending</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Quick Actions */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Quick Actions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleNewSale}\n              data-testid=\"button-new-sale\"\n            >\n              <ShoppingCart className=\"w-6 h-6 text-green-600\" />\n              <span className=\"text-sm font-medium\">New Sale</span>\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleViewReports}\n              data-testid=\"button-view-reports\"\n            >\n              <BarChart3 className=\"w-6 h-6 text-blue-600\" />\n              <span className=\"text-sm font-medium\">View Reports</span>\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleStockStatus}\n              data-testid=\"button-stock-status\"\n            >\n              <FileText className=\"w-6 h-6 text-purple-600\" />\n              <span className=\"text-sm font-medium\">Stock Status</span>\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleCustomerPayments}\n              data-testid=\"button-customer-payments\"\n            >\n              <Users className=\"w-6 h-6 text-orange-600\" />\n              <span className=\"text-sm font-medium\">Customer Payments</span>\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleTankMonitoring}\n              data-testid=\"button-tank-monitoring\"\n            >\n              <AlertCircle className=\"w-6 h-6 text-red-600\" />\n              <span className=\"text-sm font-medium\">Tank Monitoring</span>\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              className=\"flex flex-col items-center gap-2 h-20\"\n              onClick={handleDailyReports}\n              data-testid=\"button-daily-reports\"\n            >\n              <Download className=\"w-6 h-6 text-indigo-600\" />\n              <span className=\"text-sm font-medium\">Daily Reports</span>\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Charts and Analytics */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Sales Trend (Last 7 Days)</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-64\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <LineChart data={generateChartData()}>\n                  <XAxis dataKey=\"day\" />\n                  <YAxis />\n                  <Line type=\"monotone\" dataKey=\"sales\" stroke=\"hsl(var(--primary))\" strokeWidth={2} />\n                </LineChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Today's Product Sales</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {(dashboardStats as any)?.productSales?.map((product: any, index: number) => {\n                const colors = ['bg-green-500', 'bg-blue-500', 'bg-yellow-500', 'bg-red-500'];\n                return (\n                  <div key={product.productId} className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                    <div className=\"flex items-center\">\n                      <div className={`w-4 h-4 ${colors[index % colors.length]} rounded mr-3`}></div>\n                      <span className=\"font-medium\">{product.productName}</span>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-semibold\" data-testid={`${product.productName.toLowerCase()}-sales`}>\n                        {formatCurrency(parseFloat(product.totalAmount || '0'))}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {parseFloat(product.totalQuantity || '0').toLocaleString()} L\n                      </div>\n                    </div>\n                  </div>\n                );\n              }) || (\n                <div className=\"text-center text-muted-foreground py-4\">\n                  No product sales data available\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Transactions and Alerts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Recent Transactions</CardTitle>\n              <button \n                className=\"text-primary hover:text-primary/80 text-sm font-medium transition-colors\" \n                onClick={() => setLocation('/sales-history')}\n                data-testid=\"button-view-all\"\n              >\n                View All\n              </button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {recentSales.length > 0 ? recentSales.slice(0, 3).map((transaction: SalesTransaction, index: number) => {\n                const timeAgo = transaction.transactionDate ? new Date(transaction.transactionDate).toLocaleString() : 'N/A';\n                return (\n                  <div key={transaction.id} className=\"flex items-center justify-between p-3 border border-border rounded-md\">\n                    <div>\n                      <div className=\"font-medium text-card-foreground\" data-testid={`transaction-id-${index}`}>\n                        {transaction.invoiceNumber}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {transaction.paymentMethod === 'cash' ? 'Cash Sale' : transaction.paymentMethod === 'credit' ? 'Credit Sale' : 'Card Sale'}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">{timeAgo}</div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className={`font-semibold ${\n                        transaction.paymentMethod === 'cash' ? 'text-green-600' : \n                        transaction.paymentMethod === 'credit' ? 'text-blue-600' : 'text-purple-600'\n                      }`}>\n                        {formatCurrency(parseFloat(transaction.totalAmount || '0'))}\n                      </div>\n                    </div>\n                  </div>\n                );\n              }) : (\n                <div className=\"text-center text-muted-foreground py-4\">\n                  No recent transactions\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>System Alerts</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {/* Low Stock Alerts */}\n              {tanks.filter(tank => {\n                const currentStock = parseFloat(tank.currentStock || '0');\n                const minimumLevel = parseFloat(tank.minimumLevel || '500');\n                return currentStock <= minimumLevel;\n              }).slice(0, 2).map(tank => {\n                const product = products.find(p => p.id === tank.productId);\n                return (\n                  <div key={tank.id} className=\"p-3 bg-yellow-50 border border-yellow-200 rounded-md\">\n                    <div className=\"flex items-start\">\n                      <span className=\"text-yellow-500 mr-2\">âš ï¸</span>\n                      <div>\n                        <div className=\"text-sm font-medium text-yellow-800\">Low Stock Alert</div>\n                        <div className=\"text-xs text-yellow-600\">\n                          {tank.name} ({product?.name}) - Only {parseFloat(tank.currentStock || '0').toLocaleString()}L remaining\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n              \n              {/* Overdue Customers */}\n              {customers.filter(customer => parseFloat(customer.outstandingAmount || '0') > 50000).slice(0, 1).map(customer => (\n                <div key={customer.id} className=\"p-3 bg-red-50 border border-red-200 rounded-md\">\n                  <div className=\"flex items-start\">\n                    <span className=\"text-red-500 mr-2\">ðŸ’°</span>\n                    <div>\n                      <div className=\"text-sm font-medium text-red-800\">Payment Overdue</div>\n                      <div className=\"text-xs text-red-600\">\n                        {customer.name} - â‚¹{parseFloat(customer.outstandingAmount || '0').toLocaleString()} outstanding\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n              \n              {/* Show message if no alerts */}\n              {tanks.filter(tank => parseFloat(tank.currentStock || '0') <= parseFloat(tank.minimumLevel || '500')).length === 0 && \n               customers.filter(customer => parseFloat(customer.outstandingAmount || '0') > 50000).length === 0 && (\n                <div className=\"p-3 bg-green-50 border border-green-200 rounded-md\">\n                  <div className=\"flex items-start\">\n                    <span className=\"text-green-500 mr-2\">âœ“</span>\n                    <div>\n                      <div className=\"text-sm font-medium text-green-800\">All Systems Normal</div>\n                      <div className=\"text-xs text-green-600\">No critical alerts at this time</div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":18139},"client/src/pages/ExpenseManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport type { Expense } from \"@shared/schema\";\nimport { insertExpenseSchema } from \"@shared/schema\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\n\nexport default function ExpenseManagement() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { formatCurrency, currencyConfig } = useCurrency();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertExpenseSchema),\n    defaultValues: {\n      stationId: user?.stationId || \"\",\n      userId: user?.id || \"\",\n      category: \"utilities\",\n      description: \"\",\n      amount: \"0\",\n      receiptNumber: \"\",\n      paymentMethod: \"cash\" as const,\n      vendorName: \"\",\n    },\n  });\n\n  const createExpenseMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/expenses\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Expense recorded\",\n        description: \"New expense has been recorded successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record expense\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    // Ensure current user IDs are used in case user loaded after form initialization\n    const expenseData = {\n      ...data,\n      stationId: user?.stationId || data.stationId,\n      userId: user?.id || data.userId,\n    };\n    createExpenseMutation.mutate(expenseData);\n  };\n\n  const { data: expenses = [], isLoading } = useQuery<Expense[]>({\n    queryKey: [\"/api/expenses\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const filteredExpenses = expenses.filter((expense: Expense) => {\n    const matchesSearch = expense.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         expense.vendorName?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesCategory = categoryFilter === \"all\" || expense.category === categoryFilter;\n    return matchesSearch && matchesCategory;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const totalExpenses = filteredExpenses.reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0);\n  const monthlyExpenses = filteredExpenses.filter((e: Expense) => {\n    const expenseDate = e.expenseDate ? new Date(e.expenseDate) : new Date();\n    const currentDate = new Date();\n    return expenseDate.getMonth() === currentDate.getMonth();\n  }).reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0);\n\n  const expensesByCategory = {\n    salary: filteredExpenses.filter((e: Expense) => e.category === 'salary').reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0),\n    utilities: filteredExpenses.filter((e: Expense) => e.category === 'utilities').reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0),\n    maintenance: filteredExpenses.filter((e: Expense) => e.category === 'maintenance').reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0),\n    insurance: filteredExpenses.filter((e: Expense) => e.category === 'insurance').reduce((sum: number, e: Expense) => sum + parseFloat(e.amount || '0'), 0)\n  };\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Expense Management</h3>\n          <p className=\"text-muted-foreground\">Track operational costs and overhead expenses</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-expense\">\n                + Add Expense\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Record New Expense</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"category\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Category *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-expense-category\">\n                                <SelectValue placeholder=\"Select category\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"salary\">Staff Salaries</SelectItem>\n                              <SelectItem value=\"utilities\">Utilities</SelectItem>\n                              <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                              <SelectItem value=\"insurance\">Insurance</SelectItem>\n                              <SelectItem value=\"fuel\">Fuel Purchase</SelectItem>\n                              <SelectItem value=\"office\">Office Supplies</SelectItem>\n                              <SelectItem value=\"marketing\">Marketing</SelectItem>\n                              <SelectItem value=\"other\">Other</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Amount ({currencyConfig.symbol}) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-expense-amount\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter expense description\" {...field} data-testid=\"input-expense-description\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"vendorName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Vendor/Supplier</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Enter vendor name\" {...field} data-testid=\"input-expense-vendor\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"receiptNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Receipt/Invoice No.</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Enter receipt number\" {...field} data-testid=\"input-expense-receipt\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"paymentMethod\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Method *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-payment-method\">\n                              <SelectValue placeholder=\"Select payment method\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"cash\">Cash</SelectItem>\n                            <SelectItem value=\"card\">Card</SelectItem>\n                            <SelectItem value=\"credit\">Credit/UPI</SelectItem>\n                            <SelectItem value=\"fleet\">Fleet Card</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createExpenseMutation.isPending} data-testid=\"button-submit-expense\">\n                      {createExpenseMutation.isPending ? \"Recording...\" : \"Record Expense\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Button variant=\"outline\" data-testid=\"button-export-expenses\">\n            ðŸ“Š Export Report\n          </Button>\n        </div>\n      </div>\n\n      {/* Expense Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"total-expenses\">\n              {formatCurrency(totalExpenses)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Expenses</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"monthly-expenses\">\n              {formatCurrency(monthlyExpenses)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">This Month</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-blue-600\" data-testid=\"salary-expenses\">\n              {formatCurrency(expensesByCategory.salary)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Staff Salaries</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-purple-600\" data-testid=\"utility-expenses\">\n              {formatCurrency(expensesByCategory.utilities)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Utilities</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Expense Categories Overview */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Expense Categories</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {[\n                { category: 'Salary', amount: expensesByCategory.salary, color: 'bg-blue-500' },\n                { category: 'Utilities', amount: expensesByCategory.utilities, color: 'bg-green-500' },\n                { category: 'Maintenance', amount: expensesByCategory.maintenance, color: 'bg-orange-500' },\n                { category: 'Insurance', amount: expensesByCategory.insurance, color: 'bg-purple-500' }\n              ].map((category, index) => (\n                <div key={category.category} className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                  <div className=\"flex items-center\">\n                    <div className={`w-4 h-4 ${category.color} rounded mr-3`}></div>\n                    <span className=\"font-medium\">{category.category}</span>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"font-semibold\" data-testid={`category-amount-${index}`}>{formatCurrency(category.amount)}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {totalExpenses > 0 ? ((category.amount / totalExpenses) * 100).toFixed(1) : 0}%\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Expenses */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Recent Expenses</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {filteredExpenses.slice(0, 3).length > 0 ? filteredExpenses.slice(0, 3).map((expense: Expense, index: number) => (\n                <div key={expense.id} className=\"flex items-center justify-between p-3 border border-border rounded-md\">\n                  <div>\n                    <div className=\"font-medium text-card-foreground\">{expense.description}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {expense.vendorName || 'N/A'} â€¢ {expense.expenseDate ? new Date(expense.expenseDate).toLocaleDateString('en-GB') : 'N/A'}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"font-semibold text-red-600\">{formatCurrency(parseFloat(expense.amount || '0'))}</div>\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      {expense.category}\n                    </Badge>\n                  </div>\n                </div>\n              )) : (\n                <div className=\"text-center text-muted-foreground py-4\">\n                  No recent expenses\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Expenses Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Expense History</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search expenses...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-expenses\"\n              />\n              <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-category-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Categories</SelectItem>\n                  <SelectItem value=\"salary\">Salary</SelectItem>\n                  <SelectItem value=\"utilities\">Utilities</SelectItem>\n                  <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                  <SelectItem value=\"insurance\">Insurance</SelectItem>\n                  <SelectItem value=\"fuel\">Fuel</SelectItem>\n                  <SelectItem value=\"office\">Office Supplies</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Date</th>\n                  <th className=\"text-left p-3 font-medium\">Description</th>\n                  <th className=\"text-left p-3 font-medium\">Category</th>\n                  <th className=\"text-left p-3 font-medium\">Vendor</th>\n                  <th className=\"text-right p-3 font-medium\">Amount</th>\n                  <th className=\"text-center p-3 font-medium\">Payment Method</th>\n                  <th className=\"text-center p-3 font-medium\">Receipt</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredExpenses.length > 0 ? filteredExpenses.map((expense: Expense, index: number) => (\n                  <tr key={expense.id} className=\"border-b border-border hover:bg-muted/50\">\n                    <td className=\"p-3 text-sm\">{expense.expenseDate ? new Date(expense.expenseDate).toLocaleDateString('en-GB') : 'N/A'}</td>\n                    <td className=\"p-3\">\n                      <div className=\"font-medium text-card-foreground\">{expense.description}</div>\n                    </td>\n                    <td className=\"p-3\">\n                      <Badge variant=\"secondary\" data-testid={`category-badge-${index}`}>\n                        {expense.category}\n                      </Badge>\n                    </td>\n                    <td className=\"p-3 text-sm\">{expense.vendorName || 'N/A'}</td>\n                    <td className=\"p-3 text-right font-semibold text-red-600\" data-testid={`expense-amount-${index}`}>\n                      {formatCurrency(parseFloat(expense.amount || '0'))}\n                    </td>\n                    <td className=\"p-3 text-center\">\n                      <Badge variant=\"outline\">\n                        {expense.paymentMethod}\n                      </Badge>\n                    </td>\n                    <td className=\"p-3 text-center text-sm\">{expense.receiptNumber || 'N/A'}</td>\n                    <td className=\"p-3 text-center\">\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <button \n                          className=\"text-blue-600 hover:text-blue-800\"\n                          data-testid={`button-view-expense-${index}`}\n                        >\n                          ðŸ‘ï¸\n                        </button>\n                        <button \n                          className=\"text-green-600 hover:text-green-800\"\n                          data-testid={`button-edit-expense-${index}`}\n                        >\n                          âœï¸\n                        </button>\n                        <button \n                          className=\"text-purple-600 hover:text-purple-800\"\n                          data-testid={`button-receipt-${index}`}\n                        >\n                          ðŸ§¾\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                )) : (\n                  <tr>\n                    <td colSpan={8} className=\"p-8 text-center text-muted-foreground\">\n                      No expenses found for the selected criteria\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":21200},"client/src/pages/FinancialReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function FinancialReports() {\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const { toast } = useToast();\n  const [reportType, setReportType] = useState(\"profit-loss\");\n  const [period, setPeriod] = useState(\"this-month\");\n  const [isGeneratingReport, setIsGeneratingReport] = useState(false);\n\n  const { data: financialData, isLoading } = useQuery({\n    queryKey: [\"/api/reports/financial\", user?.stationId, period],\n    enabled: !!user?.stationId,\n  });\n\n  // Handler functions\n  const handleGenerateReport = () => {\n    setIsGeneratingReport(true);\n    toast({\n      title: \"Generating Report\",\n      description: `Creating ${getReportTypeName(reportType)} for ${getPeriodName(period)}...`,\n    });\n    \n    // Simulate report generation\n    setTimeout(() => {\n      setIsGeneratingReport(false);\n      toast({\n        title: \"Report Generated\",\n        description: \"Financial report has been generated successfully\",\n      });\n    }, 1500);\n  };\n\n  const handleExportReport = () => {\n    const reportData = getCurrentReportData();\n    const csvContent = generateCSV(reportData);\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const link = document.createElement('a');\n    const url = URL.createObjectURL(blob);\n    link.setAttribute('href', url);\n    link.setAttribute('download', `${reportType}-${period}-${new Date().toISOString().split('T')[0]}.csv`);\n    link.style.visibility = 'hidden';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    \n    toast({\n      title: \"Export Successful\",\n      description: \"Financial report has been exported to CSV\",\n    });\n  };\n\n  const handlePrintReport = () => {\n    const printContent = generatePrintHTML();\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(printContent);\n      printWindow.document.close();\n      printWindow.focus();\n      printWindow.print();\n      printWindow.close();\n    }\n    \n    toast({\n      title: \"Print Prepared\",\n      description: \"Financial report is ready for printing\",\n    });\n  };\n\n  // Helper functions\n  const getReportTypeName = (type: string) => {\n    const types: { [key: string]: string } = {\n      'profit-loss': 'Profit & Loss Statement',\n      'balance-sheet': 'Balance Sheet',\n      'cash-flow': 'Cash Flow Statement',\n      'sales-analysis': 'Sales Analysis',\n      'expense-analysis': 'Expense Analysis'\n    };\n    return types[type] || 'Financial Report';\n  };\n\n  const getPeriodName = (period: string) => {\n    const periods: { [key: string]: string } = {\n      'this-month': 'This Month',\n      'last-month': 'Last Month',\n      'this-quarter': 'This Quarter',\n      'this-year': 'This Year',\n      'custom': 'Custom Range'\n    };\n    return periods[period] || 'Selected Period';\n  };\n\n  const getCurrentReportData = () => {\n    return {\n      reportType: getReportTypeName(reportType),\n      period: getPeriodName(period),\n      revenue: {\n        petrol: 850000,\n        diesel: 420000,\n        other: 25000,\n        total: 1295000\n      },\n      expenses: {\n        cogs: 1180000,\n        salaries: 35000,\n        utilities: 8500,\n        maintenance: 12000,\n        insurance: 3500,\n        other: 5200,\n        total: 1244200\n      },\n      netProfit: 50800\n    };\n  };\n\n  const generateCSV = (data: any) => {\n    const csv = [\n      ['Financial Report', data.reportType],\n      ['Period', data.period],\n      ['Generated', new Date().toLocaleString()],\n      [''],\n      ['REVENUE'],\n      ['Petrol Sales', data.revenue.petrol],\n      ['Diesel Sales', data.revenue.diesel],\n      ['Other Services', data.revenue.other],\n      ['Total Revenue', data.revenue.total],\n      [''],\n      ['EXPENSES'],\n      ['Cost of Goods Sold', data.expenses.cogs],\n      ['Staff Salaries', data.expenses.salaries],\n      ['Electricity & Utilities', data.expenses.utilities],\n      ['Maintenance', data.expenses.maintenance],\n      ['Insurance', data.expenses.insurance],\n      ['Other Expenses', data.expenses.other],\n      ['Total Expenses', data.expenses.total],\n      [''],\n      ['NET PROFIT', data.netProfit]\n    ];\n    \n    return csv.map(row => row.join(',')).join('\\n');\n  };\n\n  const generatePrintHTML = () => {\n    const data = getCurrentReportData();\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Financial Report - ${data.reportType}</title>\n          <style>\n            @media print {\n              @page { margin: 1in; }\n              body { font-family: Arial, sans-serif; background: white; color: black; }\n            }\n            body { font-family: Arial, sans-serif; background: white; color: black; padding: 20px; }\n            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; }\n            .section { margin: 20px 0; }\n            .section h3 { background: #f5f5f5; padding: 10px; margin: 0; border: 1px solid #ddd; }\n            .line-item { display: flex; justify-content: space-between; padding: 8px 10px; border-left: 1px solid #ddd; border-right: 1px solid #ddd; }\n            .line-item:nth-child(even) { background: #f9f9f9; }\n            .total { font-weight: bold; background: #e9e9e9 !important; border: 1px solid #999; }\n            .profit { background: #d4edda !important; border: 2px solid #28a745; font-weight: bold; text-align: center; padding: 15px; margin-top: 20px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>${data.reportType}</h1>\n            <p>Period: ${data.period} | Generated: ${new Date().toLocaleString()}</p>\n          </div>\n          \n          <div class=\"section\">\n            <h3>REVENUE</h3>\n            <div class=\"line-item\"><span>Petrol Sales</span><span>${formatCurrency(data.revenue.petrol)}</span></div>\n            <div class=\"line-item\"><span>Diesel Sales</span><span>${formatCurrency(data.revenue.diesel)}</span></div>\n            <div class=\"line-item\"><span>Other Services</span><span>${formatCurrency(data.revenue.other)}</span></div>\n            <div class=\"line-item total\"><span>Total Revenue</span><span>${formatCurrency(data.revenue.total)}</span></div>\n          </div>\n          \n          <div class=\"section\">\n            <h3>EXPENSES</h3>\n            <div class=\"line-item\"><span>Cost of Goods Sold</span><span>${formatCurrency(data.expenses.cogs)}</span></div>\n            <div class=\"line-item\"><span>Staff Salaries</span><span>${formatCurrency(data.expenses.salaries)}</span></div>\n            <div class=\"line-item\"><span>Electricity & Utilities</span><span>${formatCurrency(data.expenses.utilities)}</span></div>\n            <div class=\"line-item\"><span>Maintenance</span><span>${formatCurrency(data.expenses.maintenance)}</span></div>\n            <div class=\"line-item\"><span>Insurance</span><span>${formatCurrency(data.expenses.insurance)}</span></div>\n            <div class=\"line-item\"><span>Other Expenses</span><span>${formatCurrency(data.expenses.other)}</span></div>\n            <div class=\"line-item total\"><span>Total Expenses</span><span>${formatCurrency(data.expenses.total)}</span></div>\n          </div>\n          \n          <div class=\"profit\">\n            <h3>NET PROFIT: ${formatCurrency(data.netProfit)}</h3>\n            <p>Profit Margin: ${((data.netProfit / data.revenue.total) * 100).toFixed(2)}%</p>\n          </div>\n        </body>\n      </html>\n    `;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-64 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h3 className=\"text-2xl font-semibold text-card-foreground mb-2\">Financial Reports</h3>\n        <p className=\"text-muted-foreground\">\n          Comprehensive financial statements and analysis for your petrol pump business\n        </p>\n      </div>\n\n      {/* Report Selection */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-card-foreground mb-2\">Report Type</label>\n              <Select value={reportType} onValueChange={setReportType}>\n                <SelectTrigger data-testid=\"select-report-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"profit-loss\">Profit & Loss Statement</SelectItem>\n                  <SelectItem value=\"balance-sheet\">Balance Sheet</SelectItem>\n                  <SelectItem value=\"cash-flow\">Cash Flow Statement</SelectItem>\n                  <SelectItem value=\"sales-analysis\">Sales Analysis</SelectItem>\n                  <SelectItem value=\"expense-analysis\">Expense Analysis</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-card-foreground mb-2\">Period</label>\n              <Select value={period} onValueChange={setPeriod}>\n                <SelectTrigger data-testid=\"select-period\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"this-month\">This Month</SelectItem>\n                  <SelectItem value=\"last-month\">Last Month</SelectItem>\n                  <SelectItem value=\"this-quarter\">This Quarter</SelectItem>\n                  <SelectItem value=\"this-year\">This Year</SelectItem>\n                  <SelectItem value=\"custom\">Custom Range</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex items-end\">\n              <Button \n                className=\"w-full\" \n                onClick={handleGenerateReport}\n                disabled={isGeneratingReport}\n                data-testid=\"button-generate-report\"\n              >\n                {isGeneratingReport ? \"Generating...\" : \"Generate Report\"}\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Profit & Loss Statement */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle>Profit & Loss Statement</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">For the month of January 2024</p>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={handleExportReport}\n                data-testid=\"button-export\"\n              >\n                ðŸ“Š Export\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={handlePrintReport}\n                data-testid=\"button-print\"\n              >\n                ðŸ–¨ï¸ Print\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            {/* Revenue Section */}\n            <div>\n              <h5 className=\"font-semibold text-card-foreground mb-4 pb-2 border-b border-border\">\n                Revenue\n              </h5>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Petrol Sales</span>\n                  <span className=\"font-medium\" data-testid=\"petrol-revenue\">{formatCurrency(850000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Diesel Sales</span>\n                  <span className=\"font-medium\" data-testid=\"diesel-revenue\">{formatCurrency(420000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Other Services</span>\n                  <span className=\"font-medium\" data-testid=\"other-revenue\">{formatCurrency(25000)}</span>\n                </div>\n                <div className=\"border-t border-border pt-3 mt-4\">\n                  <div className=\"flex justify-between font-semibold\">\n                    <span>Total Revenue</span>\n                    <span className=\"text-green-600\" data-testid=\"total-revenue\">{formatCurrency(1295000)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Expenses Section */}\n            <div>\n              <h5 className=\"font-semibold text-card-foreground mb-4 pb-2 border-b border-border\">\n                Expenses\n              </h5>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Cost of Goods Sold</span>\n                  <span className=\"font-medium\" data-testid=\"cogs\">{formatCurrency(1180000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Staff Salaries</span>\n                  <span className=\"font-medium\" data-testid=\"salaries\">{formatCurrency(35000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Electricity & Utilities</span>\n                  <span className=\"font-medium\" data-testid=\"utilities\">{formatCurrency(8500)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Maintenance</span>\n                  <span className=\"font-medium\" data-testid=\"maintenance\">{formatCurrency(12000)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Insurance</span>\n                  <span className=\"font-medium\" data-testid=\"insurance\">{formatCurrency(3500)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Other Expenses</span>\n                  <span className=\"font-medium\" data-testid=\"other-expenses\">{formatCurrency(5200)}</span>\n                </div>\n                <div className=\"border-t border-border pt-3 mt-4\">\n                  <div className=\"flex justify-between font-semibold\">\n                    <span>Total Expenses</span>\n                    <span className=\"text-red-600\" data-testid=\"total-expenses\">{formatCurrency(1244200)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Net Profit */}\n          <div className=\"mt-8 p-4 bg-muted rounded-lg\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-lg font-semibold text-card-foreground\">Net Profit</span>\n              <span className=\"text-2xl font-bold text-green-600\" data-testid=\"net-profit\">{formatCurrency(50800)}</span>\n            </div>\n            <div className=\"mt-2 text-sm text-muted-foreground\">\n              Profit Margin: 3.92% | Previous Month: {formatCurrency(45200)} (+12.4%)\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":16137},"client/src/pages/InvoiceReceipt.tsx":{"content":"import { useParams } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { formatAmount } from \"@/lib/currency\";\nimport { Printer, Download, ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport type { \n  SalesTransaction, \n  SalesTransactionItem, \n  Customer, \n  Product, \n  Station, \n  User \n} from \"@shared/schema\";\n\ninterface TransactionWithDetails extends SalesTransaction {\n  customer: Customer;\n  user: User;\n  station: Station;\n  items: Array<SalesTransactionItem & { product: Product }>;\n}\n\nexport default function InvoiceReceipt() {\n  const { id } = useParams<{ id: string }>();\n  const { user } = useAuth();\n\n  const { data: transaction, isLoading } = useQuery<TransactionWithDetails>({\n    queryKey: [\"/api/sales/detail\", id!],\n    enabled: !!id && !!user?.stationId,\n  });\n\n  // Check for print parameter from Sales History\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const shouldPrint = urlParams.get('print') === '1';\n    \n    if (shouldPrint && !isLoading && transaction) {\n      // Data is loaded, safe to print\n      setTimeout(() => {\n        window.print();\n      }, 200); // Slightly longer delay for reliable printing\n    }\n  }, [isLoading, transaction]);\n\n  const handlePrint = () => {\n    // Add a short delay to ensure content is rendered\n    setTimeout(() => {\n      window.print();\n    }, 100);\n  };\n\n  const handleDownload = () => {\n    // For now, trigger print dialog which allows saving as PDF\n    handlePrint();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-64 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-48 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!transaction) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"text-center p-6\">\n            <h2 className=\"text-2xl font-bold mb-2\">Transaction Not Found</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              The requested invoice could not be found.\n            </p>\n            <Link href=\"/sales-history\">\n              <Button>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Sales History\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const isPaid = parseFloat(transaction.outstandingAmount || '0') === 0;\n  const isOverdue = transaction.dueDate && new Date(transaction.dueDate) < new Date() && !isPaid;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Print/Download Actions - Hidden when printing */}\n      <div className=\"print:hidden sticky top-0 bg-background/80 backdrop-blur-sm border-b z-10\">\n        <div className=\"container mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/sales-history\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                  Back\n                </Button>\n              </Link>\n              <h1 className=\"text-2xl font-bold\">Invoice #{transaction.invoiceNumber}</h1>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button onClick={handlePrint} size=\"sm\" data-testid=\"button-print\">\n                <Printer className=\"w-4 h-4 mr-2\" />\n                Print\n              </Button>\n              <Button onClick={handleDownload} variant=\"outline\" size=\"sm\" data-testid=\"button-download\">\n                <Download className=\"w-4 h-4 mr-2\" />\n                Download PDF\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Invoice Content */}\n      <div className=\"container mx-auto px-6 py-8 max-w-4xl\">\n        <Card className=\"print:shadow-none print:border-none\">\n          <CardContent className=\"p-8\">\n            {/* Header */}\n            <div className=\"flex justify-between items-start mb-8\">\n              <div>\n                <h1 className=\"text-4xl font-bold text-primary mb-2\" data-testid=\"text-station-name\">\n                  {transaction.station.name}\n                </h1>\n                <div className=\"text-muted-foreground space-y-1\">\n                  {transaction.station.address && (\n                    <p data-testid=\"text-station-address\">{transaction.station.address}</p>\n                  )}\n                  {transaction.station.contactPhone && (\n                    <p data-testid=\"text-station-phone\">Phone: {transaction.station.contactPhone}</p>\n                  )}\n                  {transaction.station.contactEmail && (\n                    <p data-testid=\"text-station-email\">Email: {transaction.station.contactEmail}</p>\n                  )}\n                  {transaction.station.gstNumber && (\n                    <p data-testid=\"text-station-gst\">GST: {transaction.station.gstNumber}</p>\n                  )}\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <h2 className=\"text-3xl font-bold mb-2\">INVOICE</h2>\n                <div className=\"space-y-1 text-sm\">\n                  <p><span className=\"font-semibold\">Invoice #:</span> <span data-testid=\"text-invoice-number\">{transaction.invoiceNumber}</span></p>\n                  <p><span className=\"font-semibold\">Date:</span> <span data-testid=\"text-transaction-date\">{new Date(transaction.transactionDate || new Date()).toLocaleDateString()}</span></p>\n                  {transaction.dueDate && (\n                    <p><span className=\"font-semibold\">Due Date:</span> <span data-testid=\"text-due-date\" className={isOverdue ? \"text-red-600 font-semibold\" : \"\"}>{new Date(transaction.dueDate).toLocaleDateString()}</span></p>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Status Badges */}\n            <div className=\"flex gap-2 mb-6\">\n              <Badge variant={isPaid ? \"default\" : \"secondary\"} data-testid=\"badge-payment-status\">\n                {isPaid ? \"PAID\" : \"UNPAID\"}\n              </Badge>\n              {isOverdue && (\n                <Badge variant=\"destructive\" data-testid=\"badge-overdue\">\n                  OVERDUE\n                </Badge>\n              )}\n              <Badge variant=\"outline\" data-testid=\"badge-payment-method\">\n                {transaction.paymentMethod.toUpperCase()}\n              </Badge>\n            </div>\n\n            {/* Customer Info */}\n            <div className=\"grid md:grid-cols-2 gap-8 mb-8\">\n              <div>\n                <h3 className=\"font-semibold text-lg mb-3\">Bill To:</h3>\n                <div className=\"space-y-1\">\n                  <p className=\"font-semibold\" data-testid=\"text-customer-name\">{transaction.customer.name}</p>\n                  {transaction.customer.contactPhone && (\n                    <p data-testid=\"text-customer-phone\">Phone: {transaction.customer.contactPhone}</p>\n                  )}\n                  {transaction.customer.contactEmail && (\n                    <p data-testid=\"text-customer-email\">Email: {transaction.customer.contactEmail}</p>\n                  )}\n                  {transaction.customer.address && (\n                    <p data-testid=\"text-customer-address\">{transaction.customer.address}</p>\n                  )}\n                </div>\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-lg mb-3\">Transaction Details:</h3>\n                <div className=\"space-y-1 text-sm\">\n                  <p><span className=\"font-semibold\">Cashier:</span> <span data-testid=\"text-cashier-name\">{transaction.user.fullName}</span></p>\n                  <p><span className=\"font-semibold\">Currency:</span> <span data-testid=\"text-currency\">{transaction.currencyCode}</span></p>\n                  {transaction.notes && (\n                    <p><span className=\"font-semibold\">Notes:</span> <span data-testid=\"text-notes\">{transaction.notes}</span></p>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <Separator className=\"mb-6\" />\n\n            {/* Line Items */}\n            <div className=\"mb-8\">\n              <h3 className=\"font-semibold text-lg mb-4\">Items</h3>\n              <div className=\"border rounded-lg\">\n                <div className=\"grid grid-cols-12 gap-4 p-4 bg-muted/50 font-semibold text-sm border-b\">\n                  <div className=\"col-span-5\">Product</div>\n                  <div className=\"col-span-2 text-right\">Quantity</div>\n                  <div className=\"col-span-2 text-right\">Unit Price</div>\n                  <div className=\"col-span-3 text-right\">Total</div>\n                </div>\n                {transaction.items.map((item, index) => (\n                  <div key={item.id} className=\"grid grid-cols-12 gap-4 p-4 border-b last:border-b-0\" data-testid={`row-item-${index}`}>\n                    <div className=\"col-span-5\">\n                      <div className=\"font-semibold\" data-testid={`text-product-name-${index}`}>{item.product.name}</div>\n                      {item.product.hsnCode && (\n                        <div className=\"text-xs text-muted-foreground\" data-testid={`text-hsn-${index}`}>\n                          HSN: {item.product.hsnCode}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"col-span-2 text-right\" data-testid={`text-quantity-${index}`}>\n                      {parseFloat(item.quantity).toFixed(3)} {item.product.unit}\n                    </div>\n                    <div className=\"col-span-2 text-right\" data-testid={`text-unit-price-${index}`}>\n                      {formatAmount(parseFloat(item.unitPrice), transaction.currencyCode)}\n                    </div>\n                    <div className=\"col-span-3 text-right font-semibold\" data-testid={`text-total-price-${index}`}>\n                      {formatAmount(parseFloat(item.totalPrice), transaction.currencyCode)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Totals */}\n            <div className=\"flex justify-end mb-8\">\n              <div className=\"w-full max-w-sm space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span>Subtotal:</span>\n                  <span data-testid=\"text-subtotal\">{formatAmount(parseFloat(transaction.subtotal ?? '0'), transaction.currencyCode)}</span>\n                </div>\n                {parseFloat(transaction.taxAmount ?? '0') > 0 && (\n                  <div className=\"flex justify-between\">\n                    <span>Tax:</span>\n                    <span data-testid=\"text-tax\">{formatAmount(parseFloat(transaction.taxAmount || '0'), transaction.currencyCode)}</span>\n                  </div>\n                )}\n                <Separator />\n                <div className=\"flex justify-between text-lg font-semibold\">\n                  <span>Total Amount:</span>\n                  <span data-testid=\"text-total-amount\">{formatAmount(parseFloat(transaction.totalAmount ?? '0'), transaction.currencyCode)}</span>\n                </div>\n                {parseFloat(transaction.paidAmount ?? '0') > 0 && (\n                  <div className=\"flex justify-between text-green-600\">\n                    <span>Amount Paid:</span>\n                    <span data-testid=\"text-paid-amount\">{formatAmount(parseFloat(transaction.paidAmount || '0'), transaction.currencyCode)}</span>\n                  </div>\n                )}\n                {parseFloat(transaction.outstandingAmount ?? '0') > 0 && (\n                  <div className=\"flex justify-between text-red-600 font-semibold\">\n                    <span>Outstanding:</span>\n                    <span data-testid=\"text-outstanding-amount\">{formatAmount(parseFloat(transaction.outstandingAmount ?? '0'), transaction.currencyCode)}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Footer */}\n            <Separator className=\"mb-6\" />\n            <div className=\"text-center text-sm text-muted-foreground\">\n              <p>Thank you for your business!</p>\n              {transaction.station.licenseNumber && (\n                <p className=\"mt-1\">License: {transaction.station.licenseNumber}</p>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":13058},"client/src/pages/PointOfSale.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { Product, Customer, Tank, SalesTransaction } from \"@shared/schema\";\nimport { insertCustomerSchema } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Combobox, ComboboxOption } from \"@/components/ui/combobox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\nimport { useLocation } from \"wouter\";\n\ninterface POSItem {\n  productId: string;\n  productName: string;\n  tankId: string;\n  quantity: number;\n  unitPrice: number;\n  totalPrice: number;\n}\n\nexport default function PointOfSale() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { formatCurrency } = useCurrency();\n  \n  const [selectedCustomerId, setSelectedCustomerId] = useState(\"\");\n  const [transactionItems, setTransactionItems] = useState<POSItem[]>([]);\n  const [paymentMethod, setPaymentMethod] = useState<\"cash\" | \"card\" | \"credit\" | \"fleet\">(\"cash\");\n  const [customerDialogOpen, setCustomerDialogOpen] = useState(false);\n  const [quickQuantity, setQuickQuantity] = useState(25);\n  const [, setLocation] = useLocation();\n  \n  // State to track editing mode\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [editingTransactionId, setEditingTransactionId] = useState<string | null>(null);\n  const [currentDraftId, setCurrentDraftId] = useState<string | null>(null);\n  \n  // Load draft or transaction data on mount\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const draftId = urlParams.get('draft');\n    const editId = urlParams.get('edit');\n    \n    if (draftId) {\n      setCurrentDraftId(draftId);\n      loadDraft(draftId);\n    } else if (editId) {\n      setIsEditMode(true);\n      setEditingTransactionId(editId);\n      loadTransactionForEdit(editId);\n    }\n  }, []);\n  \n  const loadDraft = (draftId: string) => {\n    try {\n      // Load from allPosDrafts first\n      const allDrafts = localStorage.getItem('allPosDrafts');\n      if (allDrafts) {\n        const drafts = JSON.parse(allDrafts);\n        const draft = drafts.find((d: any) => d.id === draftId);\n        if (draft) {\n          setSelectedCustomerId(draft.selectedCustomerId || '');\n          setTransactionItems(draft.transactionItems || []);\n          setPaymentMethod(draft.paymentMethod || 'cash');\n          \n          toast({\n            title: \"Draft loaded\",\n            description: \"Previous draft has been restored\",\n          });\n          return;\n        }\n      }\n      \n      // Fallback to single draft if not found in allDrafts\n      const singleDraft = localStorage.getItem('posDraft');\n      if (singleDraft && draftId.includes('draft-')) {\n        const draft = JSON.parse(singleDraft);\n        setSelectedCustomerId(draft.selectedCustomerId || '');\n        setTransactionItems(draft.transactionItems || []);\n        setPaymentMethod(draft.paymentMethod || 'cash');\n        \n        toast({\n          title: \"Draft loaded\",\n          description: \"Previous draft has been restored\",\n        });\n      }\n    } catch (error) {\n      console.error('Failed to load draft:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load draft\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const loadTransactionForEdit = async (transactionId: string) => {\n    try {\n      const response = await apiRequest('GET', `/api/sales/detail/${transactionId}`);\n      const transactionData = await response.json();\n      \n      if (transactionData && transactionData.items) {\n        // Set customer\n        setSelectedCustomerId(transactionData.customerId || '');\n        \n        // Set payment method\n        setPaymentMethod(transactionData.paymentMethod || 'cash');\n        \n        // Convert transaction items to POSItem format\n        const posItems = transactionData.items.map((item: any) => ({\n          productId: item.productId,\n          productName: item.product?.name || 'Unknown Product',\n          tankId: item.tankId || `tank-${item.productId}`,\n          quantity: parseFloat(item.quantity || '0'),\n          unitPrice: parseFloat(item.unitPrice || '0'),\n          totalPrice: parseFloat(item.totalPrice || '0'),\n        }));\n        \n        setTransactionItems(posItems);\n        \n        toast({\n          title: \"Transaction loaded\",\n          description: `Loaded transaction ${transactionData.invoiceNumber} for editing`,\n        });\n      }\n    } catch (error) {\n      console.error('Failed to load transaction:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load transaction for editing\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const customerForm = useForm({\n    resolver: zodResolver(insertCustomerSchema.omit({ outstandingAmount: true })),\n    defaultValues: {\n      name: \"\",\n      type: \"walk-in\" as const,\n      contactPhone: \"\",\n      contactEmail: \"\",\n      address: \"\",\n      gstNumber: \"\",\n      creditLimit: \"0\",\n    },\n  });\n\n  const createCustomerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/customers\", data);\n      return response.json();\n    },\n    onSuccess: (newCustomer) => {\n      toast({\n        title: \"Customer added\",\n        description: \"New customer has been added successfully\",\n      });\n      setCustomerDialogOpen(false);\n      customerForm.reset();\n      setSelectedCustomerId(newCustomer.id);\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add customer\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onCustomerSubmit = (data: any) => {\n    createCustomerMutation.mutate(data);\n  };\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: customers = [], isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  // Find walk-in customer for fallback\n  const walkInCustomer = customers.find(c => c.type === 'walk-in');\n\n  const { data: tanks = [] } = useQuery<Tank[]>({\n    queryKey: [\"/api/tanks\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const createSaleMutation = useMutation({\n    mutationFn: async (saleData: { transaction: any; items: any[] }) => {\n      const response = await apiRequest(\"POST\", \"/api/sales\", saleData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Sale completed\",\n        description: \"Transaction recorded successfully\",\n      });\n      clearCurrentTransaction();\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Sale failed\",\n        description: \"Failed to record transaction\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateSaleMutation = useMutation({\n    mutationFn: async (saleData: { transactionId: string; transaction: any; items: any[] }) => {\n      const response = await apiRequest(\"PUT\", `/api/sales/${saleData.transactionId}`, {\n        transaction: saleData.transaction,\n        items: saleData.items\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Sale updated\",\n        description: \"Transaction updated successfully\",\n      });\n      clearCurrentTransaction();\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/sales\"] });\n      setLocation('/sales-history');\n    },\n    onError: () => {\n      toast({\n        title: \"Update failed\",\n        description: \"Failed to update transaction\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addProduct = (product: Product) => {\n    // For now, we'll create a mock tank since tank management is not fully implemented\n    // In a real system, you'd check for available tanks for this product\n    const mockTankId = `tank-${product.id}`;\n\n    const newItem: POSItem = {\n      productId: product.id,\n      productName: product.name,\n      tankId: mockTankId,\n      quantity: quickQuantity,\n      unitPrice: parseFloat(product.currentPrice),\n      totalPrice: quickQuantity * parseFloat(product.currentPrice),\n    };\n\n    setTransactionItems([...transactionItems, newItem]);\n    \n    toast({\n      title: \"Product added\",\n      description: `${product.name} added to transaction`,\n    });\n  };\n\n  const removeItem = (index: number) => {\n    setTransactionItems(transactionItems.filter((_, i) => i !== index));\n  };\n\n  const updateQuantity = (index: number, quantity: number) => {\n    const updatedItems = [...transactionItems];\n    updatedItems[index].quantity = quantity;\n    updatedItems[index].totalPrice = quantity * updatedItems[index].unitPrice;\n    setTransactionItems(updatedItems);\n  };\n\n  const clearCurrentTransaction = () => {\n    setTransactionItems([]);\n    setSelectedCustomerId(\"\");\n    setPaymentMethod(\"cash\");\n    setIsEditMode(false);\n    setEditingTransactionId(null);\n    \n    // Remove draft if we were working with one\n    if (currentDraftId) {\n      removeDraftFromStorage(currentDraftId);\n      setCurrentDraftId(null);\n    }\n  };\n\n  const removeDraftFromStorage = (draftId: string) => {\n    try {\n      const allDrafts = localStorage.getItem('allPosDrafts');\n      if (allDrafts) {\n        const drafts = JSON.parse(allDrafts);\n        const updatedDrafts = drafts.filter((d: any) => d.id !== draftId);\n        localStorage.setItem('allPosDrafts', JSON.stringify(updatedDrafts));\n      }\n      \n      // Also remove single draft if it matches\n      const singleDraft = localStorage.getItem('posDraft');\n      if (singleDraft) {\n        const draft = JSON.parse(singleDraft);\n        if (draft.id === draftId) {\n          localStorage.removeItem('posDraft');\n        }\n      }\n    } catch (error) {\n      console.error('Failed to remove draft from storage:', error);\n    }\n  };\n\n  const subtotal = transactionItems.reduce((sum, item) => sum + item.totalPrice, 0);\n  const taxAmount = 0; // Tax removed - will be configurable via global settings\n  const totalAmount = subtotal + taxAmount;\n\n  const completeSale = () => {\n    if (transactionItems.length === 0) {\n      toast({\n        title: \"No items\",\n        description: \"Please add items to the transaction\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const transaction = {\n      invoiceNumber: isEditMode ? undefined : `INV-${Date.now()}`, // Don't change invoice number when editing\n      stationId: user?.stationId,\n      customerId: selectedCustomerId || walkInCustomer?.id,\n      userId: user?.id,\n      paymentMethod,\n      subtotal: subtotal.toFixed(2),\n      taxAmount: taxAmount.toFixed(2),\n      totalAmount: totalAmount.toFixed(2),\n      paidAmount: paymentMethod === 'credit' ? '0' : totalAmount.toFixed(2),\n      outstandingAmount: paymentMethod === 'credit' ? totalAmount.toFixed(2) : '0',\n    };\n\n    const items = transactionItems.map(item => ({\n      productId: item.productId,\n      tankId: item.tankId,\n      quantity: item.quantity.toString(),\n      unitPrice: item.unitPrice.toFixed(2),\n      totalPrice: item.totalPrice.toFixed(2),\n    }));\n\n    if (isEditMode && editingTransactionId) {\n      // Update existing transaction\n      updateSaleMutation.mutate({ \n        transactionId: editingTransactionId, \n        transaction, \n        items \n      });\n    } else {\n      // Create new transaction\n      createSaleMutation.mutate({ transaction, items });\n    }\n  };\n\n  const saveAsDraft = () => {\n    if (transactionItems.length === 0) {\n      toast({\n        title: \"No items\",\n        description: \"Please add items before saving as draft\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const totalAmount = transactionItems.reduce((sum, item) => sum + item.totalPrice, 0);\n    const timestamp = Date.now();\n    \n    // Create draft data\n    const draftData = {\n      id: `draft-${timestamp}`,\n      selectedCustomerId,\n      transactionItems,\n      paymentMethod,\n      timestamp,\n      totalAmount\n    };\n    \n    // Save to allPosDrafts (new format)\n    try {\n      const existingDrafts = localStorage.getItem('allPosDrafts');\n      const drafts = existingDrafts ? JSON.parse(existingDrafts) : [];\n      \n      // Replace existing draft with same timestamp or add new one\n      const existingIndex = drafts.findIndex((d: any) => d.id === draftData.id);\n      if (existingIndex >= 0) {\n        drafts[existingIndex] = draftData;\n      } else {\n        drafts.push(draftData);\n      }\n      \n      localStorage.setItem('allPosDrafts', JSON.stringify(drafts));\n      \n      // Also save as single draft for backward compatibility\n      localStorage.setItem('posDraft', JSON.stringify(draftData));\n      \n      toast({\n        title: \"Draft saved\",\n        description: \"Transaction saved as draft\",\n      });\n    } catch (error) {\n      console.error('Failed to save draft:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save draft\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const cancelTransaction = () => {\n    setTransactionItems([]);\n    setSelectedCustomerId(\"\");\n    setPaymentMethod(\"cash\");\n    localStorage.removeItem('posDraft');\n    \n    toast({\n      title: \"Transaction cancelled\",\n      description: \"Transaction has been cleared\",\n    });\n  };\n\n  const showLastTransaction = () => {\n    setLocation('/sales-history');\n  };\n\n  const printLastReceipt = () => {\n    if (transactionItems.length === 0) {\n      toast({\n        title: \"No Invoice to Print\",\n        description: \"Please add items to the transaction first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const invoiceHTML = generateInvoiceHTML();\n      const printWindow = window.open('', '_blank', 'width=800,height=600');\n      \n      if (printWindow) {\n        printWindow.document.open();\n        printWindow.document.write(invoiceHTML);\n        printWindow.document.close();\n        \n        // Wait for content to load before printing\n        printWindow.onload = () => {\n          printWindow.focus();\n          printWindow.print();\n        };\n        \n        // Fallback: print after a short delay if onload doesn't fire\n        setTimeout(() => {\n          if (printWindow && !printWindow.closed) {\n            printWindow.focus();\n            printWindow.print();\n          }\n        }, 500);\n      } else {\n        toast({\n          title: \"Print Blocked\",\n          description: \"Please allow popups to print invoices\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"Invoice Prepared\",\n        description: \"Invoice window opened for printing\",\n      });\n    } catch (error) {\n      console.error('Print error:', error);\n      toast({\n        title: \"Print Error\",\n        description: \"Failed to prepare invoice for printing\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Calculation functions for printing\n  const calculateSubtotal = () => {\n    return transactionItems.reduce((sum, item) => sum + item.totalPrice, 0);\n  };\n\n  const calculateTax = () => {\n    // Tax will be made configurable - for now return 0\n    return 0;\n  };\n\n  const calculateTotal = () => {\n    return calculateSubtotal() + calculateTax();\n  };\n\n  const generateInvoiceHTML = () => {\n    const invoiceData = {\n      invoiceNumber: `INV-${Date.now()}`,\n      date: new Date().toLocaleDateString(),\n      customerName: selectedCustomerId ? customers.find(c => c.id === selectedCustomerId)?.name || \"Walk-in Customer\" : \"Walk-in Customer\",\n      stationName: \"Station 1\", // Will be made configurable via settings\n      stationAddress: \"123 Main Street, Demo City\",\n      stationPhone: \"+1-234-567-8900\",\n      stationEmail: \"station@fuelflow.com\",\n      stationGST: \"GST123456789\",\n      cashierName: user?.fullName || \"Admin User\",\n      paymentMethod: \"CASH\",\n      paymentStatus: \"PAID\",\n      items: transactionItems,\n      subtotal: calculateSubtotal(),\n      tax: calculateTax(),\n      total: calculateTotal(),\n      currency: \"PKR\" // Will be made configurable via global settings\n    };\n\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Invoice - ${invoiceData.invoiceNumber}</title>\n          <style>\n            @media print {\n              @page { \n                margin: 0.5in; \n                size: A4;\n              }\n              body { \n                -webkit-print-color-adjust: exact; \n                color-adjust: exact; \n              }\n            }\n            * {\n              margin: 0;\n              padding: 0;\n              box-sizing: border-box;\n            }\n            body { \n              font-family: Arial, sans-serif; \n              background: white; \n              color: black; \n              padding: 20px;\n              line-height: 1.4;\n            }\n            .invoice-header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 3px solid #333;\n              padding-bottom: 20px;\n            }\n            .invoice-title {\n              font-size: 24px;\n              font-weight: bold;\n              color: #2563eb;\n              margin-bottom: 10px;\n            }\n            .station-info {\n              font-size: 14px;\n              line-height: 1.6;\n            }\n            .invoice-details {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 30px;\n              align-items: flex-start;\n            }\n            .invoice-meta {\n              text-align: right;\n            }\n            .invoice-meta h3 {\n              font-size: 18px;\n              margin-bottom: 10px;\n              color: #333;\n            }\n            .payment-status {\n              background: #16a34a;\n              color: white;\n              padding: 5px 15px;\n              border-radius: 5px;\n              font-weight: bold;\n              display: inline-block;\n              margin: 10px 0;\n            }\n            .bill-to {\n              font-size: 14px;\n            }\n            .bill-to h4 {\n              margin-bottom: 5px;\n              color: #333;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin: 20px 0;\n              font-size: 14px;\n            }\n            .items-table th {\n              background: #f8f9fa;\n              border: 1px solid #ddd;\n              padding: 12px 8px;\n              text-align: left;\n              font-weight: bold;\n            }\n            .items-table td {\n              border: 1px solid #ddd;\n              padding: 10px 8px;\n            }\n            .items-table .text-right {\n              text-align: right;\n            }\n            .items-table .text-center {\n              text-align: center;\n            }\n            .totals-section {\n              margin-top: 30px;\n              display: flex;\n              justify-content: flex-end;\n            }\n            .totals-table {\n              width: 300px;\n              font-size: 14px;\n            }\n            .totals-table td {\n              padding: 8px 12px;\n              border-bottom: 1px solid #eee;\n            }\n            .totals-table .total-row {\n              background: #f8f9fa;\n              font-weight: bold;\n              font-size: 16px;\n              border-top: 2px solid #333;\n            }\n            .footer {\n              margin-top: 40px;\n              text-align: center;\n              font-size: 14px;\n              border-top: 1px solid #ddd;\n              padding-top: 20px;\n            }\n            .thank-you {\n              font-size: 18px;\n              font-weight: bold;\n              color: #2563eb;\n              margin-bottom: 10px;\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"invoice-header\">\n            <div class=\"invoice-title\">FuelFlow INVOICE</div>\n            <div class=\"station-info\">\n              <strong>${invoiceData.stationName}</strong><br>\n              ${invoiceData.stationAddress}<br>\n              Phone: ${invoiceData.stationPhone}<br>\n              Email: ${invoiceData.stationEmail}<br>\n              GST: ${invoiceData.stationGST}\n            </div>\n          </div>\n\n          <div class=\"invoice-details\">\n            <div class=\"bill-to\">\n              <div class=\"payment-status\">${invoiceData.paymentStatus} ${invoiceData.paymentMethod}</div>\n              <h4>Bill To:</h4>\n              <strong>${invoiceData.customerName}</strong>\n              <br><br>\n              <strong>Transaction Details:</strong><br>\n              Cashier: ${invoiceData.cashierName}<br>\n              Currency: ${invoiceData.currency}\n            </div>\n            <div class=\"invoice-meta\">\n              <h3>Invoice #: ${invoiceData.invoiceNumber}</h3>\n              <div>Date: ${invoiceData.date}</div>\n            </div>\n          </div>\n\n          <h4 style=\"margin-bottom: 10px;\">Items</h4>\n          <table class=\"items-table\">\n            <thead>\n              <tr>\n                <th>Product</th>\n                <th class=\"text-center\">Quantity</th>\n                <th class=\"text-right\">Unit Price</th>\n                <th class=\"text-right\">Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => `\n                <tr>\n                  <td>\n                    <strong>${item.productName}</strong><br>\n                    <small style=\"color: #666;\">HSN: 27101990</small>\n                  </td>\n                  <td class=\"text-center\">${item.quantity.toFixed(3)} litre</td>\n                  <td class=\"text-right\">Rs ${item.unitPrice.toFixed(2)}</td>\n                  <td class=\"text-right\">Rs ${item.totalPrice.toFixed(2)}</td>\n                </tr>\n              `).join('')}\n            </tbody>\n          </table>\n\n          <div class=\"totals-section\">\n            <table class=\"totals-table\">\n              <tr>\n                <td>Subtotal:</td>\n                <td class=\"text-right\">Rs ${invoiceData.subtotal.toFixed(2)}</td>\n              </tr>\n              <tr>\n                <td>Tax:</td>\n                <td class=\"text-right\">Rs ${invoiceData.tax.toFixed(2)}</td>\n              </tr>\n              <tr class=\"total-row\">\n                <td>Total Amount:</td>\n                <td class=\"text-right\">Rs ${invoiceData.total.toFixed(2)}</td>\n              </tr>\n              <tr>\n                <td><strong>Amount Paid:</strong></td>\n                <td class=\"text-right\"><strong>Rs ${invoiceData.total.toFixed(2)}</strong></td>\n              </tr>\n            </table>\n          </div>\n\n          <div class=\"footer\">\n            <div class=\"thank-you\">Thank you for your business!</div>\n            <div>License: LIC123456</div>\n          </div>\n        </body>\n      </html>\n    `;\n  };\n\n  const showDaySummary = () => {\n    setLocation('/daily-reports');\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in\">\n      {/* POS Interface */}\n      <div className=\"lg:col-span-2\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"text-xl\">New Sale Transaction</CardTitle>\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-sm text-muted-foreground\">Transaction #</span>\n                <span className=\"font-mono font-semibold bg-muted px-2 py-1 rounded\" data-testid=\"transaction-number\">\n                  TXN-{Date.now().toString().slice(-6)}\n                </span>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {/* Customer Selection & Quick Quantity */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-card-foreground mb-2\">Customer</label>\n                <div className=\"flex space-x-2\">\n                <Combobox\n                  options={[\n                    ...(walkInCustomer ? [{ \n                      value: walkInCustomer.id, \n                      label: \"Walk-in Customer\", \n                      searchTerms: [\"walk\", \"cash\", \"retail\", \"walk-in\"] \n                    }] : []),\n                    ...customers.filter(c => c.type !== 'walk-in').map((customer): ComboboxOption => ({\n                      value: customer.id,\n                      label: `${customer.name} (${customer.type})`,\n                      searchTerms: [\n                        customer.name,\n                        customer.type,\n                        customer.contactPhone || '',\n                        customer.gstNumber || '',\n                        customer.contactEmail || ''\n                      ].filter(Boolean)\n                    }))\n                  ]}\n                  value={selectedCustomerId}\n                  onValueChange={setSelectedCustomerId}\n                  placeholder=\"Search or select customer...\"\n                  searchPlaceholder=\"Search customers by name, phone, GST...\"\n                  emptyMessage=\"No customers found. Try different search terms.\"\n                  className=\"flex-1\"\n                  disabled={customersLoading}\n                  data-testid=\"combobox-customer\"\n                />\n                <Dialog open={customerDialogOpen} onOpenChange={setCustomerDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button variant=\"secondary\" data-testid=\"button-add-customer\">+ Add</Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"sm:max-w-[400px]\">\n                    <DialogHeader>\n                      <DialogTitle>Quick Add Customer</DialogTitle>\n                    </DialogHeader>\n                    <Form {...customerForm}>\n                      <form onSubmit={customerForm.handleSubmit(onCustomerSubmit)} className=\"space-y-4\">\n                        <FormField\n                          control={customerForm.control}\n                          name=\"name\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Customer Name *</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter customer name\" {...field} data-testid=\"input-quick-customer-name\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={customerForm.control}\n                          name=\"contactPhone\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Phone Number</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter phone number\" {...field} data-testid=\"input-quick-customer-phone\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={customerForm.control}\n                          name=\"type\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Customer Type</FormLabel>\n                              <Select onValueChange={field.onChange} defaultValue={field.value}>\n                                <FormControl>\n                                  <SelectTrigger data-testid=\"select-quick-customer-type\">\n                                    <SelectValue />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  <SelectItem value=\"walk-in\">Walk-in</SelectItem>\n                                  <SelectItem value=\"credit\">Credit Customer</SelectItem>\n                                  <SelectItem value=\"fleet\">Fleet Customer</SelectItem>\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <div className=\"flex justify-end space-x-2 pt-2\">\n                          <Button type=\"button\" variant=\"outline\" onClick={() => setCustomerDialogOpen(false)} data-testid=\"button-cancel-customer\">\n                            Cancel\n                          </Button>\n                          <Button type=\"submit\" disabled={createCustomerMutation.isPending} data-testid=\"button-submit-quick-customer\">\n                            {createCustomerMutation.isPending ? \"Adding...\" : \"Add Customer\"}\n                          </Button>\n                        </div>\n                      </form>\n                    </Form>\n                  </DialogContent>\n                </Dialog>\n                </div>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-card-foreground mb-2\">Default Quantity (L)</label>\n                <Input\n                  type=\"number\"\n                  value={quickQuantity}\n                  onChange={(e) => setQuickQuantity(parseFloat(e.target.value) || 25)}\n                  placeholder=\"Enter default quantity\"\n                  className=\"w-full\"\n                  min=\"1\"\n                  step=\"0.1\"\n                  data-testid=\"input-quick-quantity\"\n                />\n              </div>\n            </div>\n\n            {/* Product Selection */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {products.map((product) => (\n                <Card \n                  key={product.id}\n                  className=\"hover:shadow-md cursor-pointer transition-shadow border-2 border-transparent hover:border-primary/20\"\n                  onClick={() => addProduct(product)}\n                  data-testid={`card-product-${product.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <h4 className=\"font-semibold text-primary\">{product.name}</h4>\n                        <p className=\"text-sm text-muted-foreground\">{product.category}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"text-lg font-bold\">{formatCurrency(parseFloat(product.currentPrice))}</div>\n                        <div className=\"text-xs text-muted-foreground\">per {product.unit}</div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            {/* Transaction Items */}\n            <Card>\n              <CardContent className=\"p-0\">\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-muted\">\n                      <tr>\n                        <th className=\"text-left p-3 font-medium text-card-foreground\">Product</th>\n                        <th className=\"text-center p-3 font-medium text-card-foreground\">Qty (L)</th>\n                        <th className=\"text-right p-3 font-medium text-card-foreground\">Rate</th>\n                        <th className=\"text-right p-3 font-medium text-card-foreground\">Amount</th>\n                        <th className=\"text-center p-3 font-medium text-card-foreground\">Action</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {transactionItems.map((item, index) => (\n                        <tr key={index} className=\"border-t border-border\">\n                          <td className=\"p-3\">\n                            <div className=\"font-medium text-green-600\">{item.productName}</div>\n                            <div className=\"text-sm text-muted-foreground\">Pump #{index + 1}</div>\n                          </td>\n                          <td className=\"p-3 text-center\">\n                            <Input\n                              type=\"number\"\n                              value={item.quantity}\n                              onChange={(e) => updateQuantity(index, parseFloat(e.target.value) || 0)}\n                              className=\"w-16 text-center\"\n                              data-testid={`input-quantity-${index}`}\n                            />\n                          </td>\n                          <td className=\"p-3 text-right\">{formatCurrency(item.unitPrice)}</td>\n                          <td className=\"p-3 text-right font-semibold\" data-testid={`amount-${index}`}>\n                            {formatCurrency(item.totalPrice)}\n                          </td>\n                          <td className=\"p-3 text-center\">\n                            <button \n                              onClick={() => removeItem(index)}\n                              className=\"text-destructive hover:text-destructive/80\"\n                              data-testid={`button-remove-${index}`}\n                            >\n                              ðŸ—‘ï¸\n                            </button>\n                          </td>\n                        </tr>\n                      ))}\n                      {transactionItems.length === 0 && (\n                        <tr>\n                          <td colSpan={5} className=\"p-8 text-center text-muted-foreground\">\n                            No items added. Click on a product above to add it.\n                          </td>\n                        </tr>\n                      )}\n                    </tbody>\n                  </table>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Payment Methods */}\n            <div className=\"flex justify-end space-x-4\">\n              <Button \n                variant={paymentMethod === 'cash' ? 'default' : 'outline'}\n                onClick={() => setPaymentMethod('cash')}\n                data-testid=\"button-payment-cash\"\n              >\n                Cash Payment\n              </Button>\n              <Button \n                variant={paymentMethod === 'card' ? 'default' : 'outline'}\n                onClick={() => setPaymentMethod('card')}\n                data-testid=\"button-payment-card\"\n              >\n                Card Payment\n              </Button>\n              <Button \n                variant={paymentMethod === 'credit' ? 'default' : 'outline'}\n                onClick={() => setPaymentMethod('credit')}\n                data-testid=\"button-payment-credit\"\n              >\n                Credit Sale\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Transaction Summary */}\n      <div className=\"lg:col-span-1\">\n        <Card className=\"sticky top-4\">\n          <CardHeader>\n            <CardTitle>Transaction Summary</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Subtotal:</span>\n                <span className=\"font-semibold\" data-testid=\"subtotal\">{formatCurrency(subtotal)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Tax (5%):</span>\n                <span className=\"font-semibold\" data-testid=\"tax-amount\">{formatCurrency(taxAmount)}</span>\n              </div>\n              <div className=\"border-t border-border pt-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-lg font-semibold text-card-foreground\">Total:</span>\n                  <span className=\"text-lg font-bold text-primary\" data-testid=\"total-amount\">\n                    {formatCurrency(totalAmount)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Button \n                className=\"w-full\" \n                size=\"lg\"\n                onClick={completeSale}\n                disabled={createSaleMutation.isPending || transactionItems.length === 0}\n                data-testid=\"button-complete-sale\"\n              >\n                {createSaleMutation.isPending ? \"Processing...\" : \"Complete Sale\"}\n              </Button>\n              <Button \n                variant=\"outline\" \n                className=\"w-full\" \n                onClick={saveAsDraft}\n                data-testid=\"button-save-draft\"\n              >\n                Save as Draft\n              </Button>\n              <Button \n                variant=\"outline\" \n                className=\"w-full text-destructive hover:bg-destructive/10\" \n                onClick={cancelTransaction}\n                data-testid=\"button-cancel\"\n              >\n                Cancel Transaction\n              </Button>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"pt-6 border-t border-border\">\n              <h4 className=\"font-medium text-card-foreground mb-3\">Quick Actions</h4>\n              <div className=\"space-y-2\">\n                <button \n                  className=\"w-full text-left p-2 hover:bg-muted rounded-md text-sm transition-colors\" \n                  onClick={showLastTransaction}\n                  data-testid=\"button-last-transaction\"\n                >\n                  ðŸ“± Last Transaction\n                </button>\n                <button \n                  className=\"w-full text-left p-2 hover:bg-muted rounded-md text-sm transition-colors\" \n                  onClick={printLastReceipt}\n                  data-testid=\"button-print-receipt\"\n                >\n                  ðŸ§¾ Print Receipt\n                </button>\n                <button \n                  className=\"w-full text-left p-2 hover:bg-muted rounded-md text-sm transition-colors\" \n                  onClick={showDaySummary}\n                  data-testid=\"button-day-summary\"\n                >\n                  ðŸ“Š Day Summary\n                </button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":39604},"client/src/pages/PriceManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { Product } from \"@shared/schema\";\nimport { insertProductSchema } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\n\nexport default function PriceManagement() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { currencyConfig } = useCurrency();\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertProductSchema),\n    defaultValues: {\n      name: \"\",\n      category: \"fuel\",\n      unit: \"litre\",\n      currentPrice: \"0\",\n      density: \"0.750\",\n      hsnCode: \"\",\n      taxRate: \"5\",\n    },\n  });\n\n  const createProductMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/products\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Product created\",\n        description: \"New product has been added successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createProductMutation.mutate(data);\n  };\n\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const updatePriceMutation = useMutation({\n    mutationFn: async ({ productId, newPrice }: { productId: string; newPrice: number }) => {\n      const response = await apiRequest(\"PUT\", `/api/products/${productId}`, {\n        currentPrice: newPrice.toString()\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Price updated\",\n        description: \"Product price updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Price update failed\",\n        description: \"Failed to update product price\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Price Management</h3>\n          <p className=\"text-muted-foreground\">Manage product pricing and profit margins</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-product\">\n                + Add Product\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add New Product</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Product Name *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter product name\" {...field} data-testid=\"input-product-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"category\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Category *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-product-category\">\n                                <SelectValue placeholder=\"Select category\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"fuel\">Fuel</SelectItem>\n                              <SelectItem value=\"lubricant\">Lubricant</SelectItem>\n                              <SelectItem value=\"additive\">Additive</SelectItem>\n                              <SelectItem value=\"other\">Other</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"unit\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Unit *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-product-unit\">\n                                <SelectValue placeholder=\"Select unit\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"litre\">Litre</SelectItem>\n                              <SelectItem value=\"kilogram\">Kilogram</SelectItem>\n                              <SelectItem value=\"piece\">Piece</SelectItem>\n                              <SelectItem value=\"bottle\">Bottle</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"currentPrice\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Price ({currencyConfig.symbol}) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-product-price\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"taxRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Tax Rate (%)</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.01\" placeholder=\"5.00\" {...field} data-testid=\"input-product-tax\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"hsnCode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>HSN Code</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Enter HSN code\" {...field} data-testid=\"input-product-hsn\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"density\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Density (for fuels)</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.001\" placeholder=\"0.750\" {...field} data-testid=\"input-product-density\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createProductMutation.isPending} data-testid=\"button-submit-product\">\n                      {createProductMutation.isPending ? \"Creating...\" : \"Create Product\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Button data-testid=\"button-bulk-price-update\">\n            ðŸ“Š Bulk Update\n          </Button>\n          <Button variant=\"outline\" data-testid=\"button-price-history\">\n            ðŸ“ˆ Price History\n          </Button>\n        </div>\n      </div>\n\n      {/* Market Prices Overview */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Current Market Rates</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            {products.slice(0, 3).map((product: Product, index: number) => {\n              const colors = [\n                { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-600', label: 'text-green-700', change: 'text-green-600' },\n                { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-600', label: 'text-blue-700', change: 'text-blue-600' },\n                { bg: 'bg-purple-50', border: 'border-purple-200', text: 'text-purple-600', label: 'text-purple-700', change: 'text-purple-600' }\n              ];\n              const color = colors[index % colors.length];\n              \n              return (\n                <div key={product.id} className={`p-4 ${color.bg} rounded-lg border ${color.border}`}>\n                  <div className=\"text-center\">\n                    <div className={`text-2xl font-bold ${color.text}`} data-testid={`market-${product.name.toLowerCase()}-price`}>\n                      â‚¹{parseFloat(product.currentPrice || '0').toFixed(2)}\n                    </div>\n                    <div className={`text-sm ${color.label}`}>{product.name} - Current Rate</div>\n                    <div className={`text-xs ${color.change} mt-1`}>â†’ Market rate</div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Product Pricing Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Product Price Management</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Product</th>\n                  <th className=\"text-center p-3 font-medium\">Category</th>\n                  <th className=\"text-right p-3 font-medium\">Cost Price</th>\n                  <th className=\"text-right p-3 font-medium\">Selling Price</th>\n                  <th className=\"text-right p-3 font-medium\">Margin</th>\n                  <th className=\"text-center p-3 font-medium\">Last Updated</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {products.length > 0 ? products.map((product: Product, index: number) => {\n                  const currentPrice = parseFloat(product.currentPrice || '0');\n                  const estimatedCost = currentPrice * 0.95; // Estimated cost is 95% of selling price\n                  const marginPercentage = ((currentPrice - estimatedCost) / estimatedCost * 100).toFixed(2);\n                  \n                  return (\n                    <tr key={product.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <div className=\"font-medium text-card-foreground\" data-testid={`product-name-${index}`}>\n                          {product.name}\n                        </div>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge variant=\"secondary\" data-testid={`product-category-${index}`}>\n                          {product.category}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-right font-mono\" data-testid={`cost-price-${index}`}>\n                        â‚¹{estimatedCost.toFixed(2)}\n                      </td>\n                      <td className=\"p-3 text-right\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          <span className=\"font-semibold font-mono\" data-testid={`selling-price-${index}`}>\n                            â‚¹{currentPrice.toFixed(2)}\n                          </span>\n                        </div>\n                      </td>\n                      <td className=\"p-3 text-right\">\n                        <span className={`font-semibold ${parseFloat(marginPercentage) > 5 ? 'text-green-600' : \n                                      parseFloat(marginPercentage) > 2 ? 'text-orange-600' : 'text-red-600'}`}\n                              data-testid={`margin-${index}`}>\n                          {marginPercentage}%\n                        </span>\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {product.createdAt ? new Date(product.createdAt).toLocaleDateString('en-GB') : 'N/A'}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={product.isActive ? 'default' : 'secondary'}\n                          className={product.isActive ? 'bg-green-100 text-green-800' : ''}\n                          data-testid={`product-status-${index}`}\n                        >\n                          {product.isActive ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <button \n                            className=\"text-blue-600 hover:text-blue-800\"\n                            data-testid={`button-edit-price-${index}`}\n                          >\n                            âœï¸\n                          </button>\n                          <button \n                            className=\"text-green-600 hover:text-green-800\"\n                            data-testid={`button-history-${index}`}\n                          >\n                            ðŸ“ˆ\n                          </button>\n                          <button \n                            className=\"text-purple-600 hover:text-purple-800\"\n                            data-testid={`button-schedule-${index}`}\n                          >\n                            â°\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : (\n                  <tr>\n                    <td colSpan={8} className=\"p-8 text-center text-muted-foreground\">\n                      No products found\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Price Change Alerts */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Price Change Notifications</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            <div className=\"p-3 bg-green-50 border border-green-200 rounded-md\">\n              <div className=\"flex items-start\">\n                <span className=\"text-green-500 mr-2\">ðŸ“ˆ</span>\n                <div>\n                  <div className=\"text-sm font-medium text-green-800\">Price Increase</div>\n                  <div className=\"text-xs text-green-600\">\n                    Petrol price increased by â‚¹0.50 to â‚¹110.50 per liter effective from today\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-md\">\n              <div className=\"flex items-start\">\n                <span className=\"text-red-500 mr-2\">ðŸ“‰</span>\n                <div>\n                  <div className=\"text-sm font-medium text-red-800\">Price Decrease</div>\n                  <div className=\"text-xs text-red-600\">\n                    Diesel price decreased by â‚¹0.25 to â‚¹84.25 per liter effective from today\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"p-3 bg-yellow-50 border border-yellow-200 rounded-md\">\n              <div className=\"flex items-start\">\n                <span className=\"text-yellow-500 mr-2\">âš ï¸</span>\n                <div>\n                  <div className=\"text-sm font-medium text-yellow-800\">Margin Alert</div>\n                  <div className=\"text-xs text-yellow-600\">\n                    Diesel margin has dropped below 3%. Consider adjusting selling price.\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":19463},"client/src/pages/PurchaseOrders.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport type { PurchaseOrder, Supplier, Product } from \"@shared/schema\";\nimport { insertPurchaseOrderSchema } from \"@shared/schema\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Combobox } from \"@/components/ui/combobox\";\n\nexport default function PurchaseOrders() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { formatCurrency, currencyConfig } = useCurrency();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertPurchaseOrderSchema.extend({\n      orderDate: insertPurchaseOrderSchema.shape.orderDate.optional(),\n      expectedDeliveryDate: insertPurchaseOrderSchema.shape.expectedDeliveryDate.optional(),\n    })),\n    defaultValues: {\n      orderNumber: `PO-${Date.now()}`,\n      supplierId: \"\",\n      expectedDeliveryDate: \"\",\n      status: \"pending\",\n      subtotal: \"0\",\n      taxAmount: \"0\",\n      totalAmount: \"0\",\n      notes: \"\",\n      stationId: user?.stationId || \"\",\n      userId: user?.id || \"\",\n    },\n  });\n\n  const createPurchaseOrderMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const orderData = {\n        ...data,\n        stationId: user?.stationId || data.stationId,\n        userId: user?.id || data.userId,\n      };\n      const response = await apiRequest(\"POST\", \"/api/purchase-orders\", orderData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Purchase order created\",\n        description: \"Purchase order has been created successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\", user?.stationId] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create purchase order\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createPurchaseOrderMutation.mutate(data);\n  };\n\n  const { data: purchaseOrders = [], isLoading } = useQuery<PurchaseOrder[]>({\n    queryKey: [\"/api/purchase-orders\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: suppliers = [] } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const filteredOrders = purchaseOrders.filter((order: PurchaseOrder) => {\n    const matchesSearch = order.orderNumber?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || order.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const pendingOrders = filteredOrders.filter((o: PurchaseOrder) => o.status === 'pending').length;\n  const deliveredOrders = filteredOrders.filter((o: PurchaseOrder) => o.status === 'delivered').length;\n  const totalValue = filteredOrders.reduce((sum: number, o: PurchaseOrder) => sum + parseFloat(o.totalAmount || '0'), 0);\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Purchase Orders</h3>\n          <p className=\"text-muted-foreground\">Manage fuel procurement and supplier orders</p>\n        </div>\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-new-purchase-order\">\n              + New Purchase Order\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Create New Purchase Order</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"orderNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Order Number *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"PO-123456\" {...field} data-testid=\"input-order-number\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"supplierId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Supplier *</FormLabel>\n                        <FormControl>\n                          <Combobox\n                            options={suppliers.map(s => ({ value: s.id, label: s.name }))}\n                            value={field.value}\n                            onValueChange={field.onChange}\n                            placeholder=\"Select supplier\"\n                            emptyMessage=\"No suppliers found\"\n                            data-testid=\"select-supplier\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"expectedDeliveryDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Expected Delivery Date</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-delivery-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"subtotal\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Subtotal ({currencyConfig.symbol}) *</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-subtotal\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"taxAmount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Tax Amount ({currencyConfig.symbol})</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-tax-amount\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"totalAmount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Total Amount ({currencyConfig.symbol}) *</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" step=\"0.01\" placeholder=\"0.00\" {...field} data-testid=\"input-total-amount\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Order details and special instructions\" {...field} data-testid=\"input-order-notes\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createPurchaseOrderMutation.isPending} data-testid=\"button-submit-order\">\n                    {createPurchaseOrderMutation.isPending ? \"Creating...\" : \"Create Purchase Order\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Purchase Order Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"total-orders\">\n              {filteredOrders.length}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Orders</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"pending-orders\">\n              {pendingOrders}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Pending Orders</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"delivered-orders\">\n              {deliveredOrders}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Delivered Orders</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-purple-600\" data-testid=\"total-order-value\">\n              {formatCurrency(totalValue)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Value</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Purchase Orders Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Purchase Order History</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search by PO number...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-po\"\n              />\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-status-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"delivered\">Delivered</SelectItem>\n                  <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">PO Number</th>\n                  <th className=\"text-left p-3 font-medium\">Supplier</th>\n                  <th className=\"text-left p-3 font-medium\">Product</th>\n                  <th className=\"text-right p-3 font-medium\">Quantity</th>\n                  <th className=\"text-right p-3 font-medium\">Amount</th>\n                  <th className=\"text-center p-3 font-medium\">Order Date</th>\n                  <th className=\"text-center p-3 font-medium\">Delivery Date</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredOrders.length > 0 ? filteredOrders.map((order: PurchaseOrder, index: number) => {\n                  const supplier = suppliers.find(s => s.id === order.supplierId);\n                  \n                  return (\n                    <tr key={order.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <span className=\"font-medium text-primary\" data-testid={`po-number-${index}`}>\n                          {order.orderNumber}\n                        </span>\n                      </td>\n                      <td className=\"p-3\">{supplier?.name || 'Unknown Supplier'}</td>\n                      <td className=\"p-3\">Mixed Products</td>\n                      <td className=\"p-3 text-right\">-</td>\n                      <td className=\"p-3 text-right font-semibold\" data-testid={`amount-${index}`}>\n                        {formatCurrency(parseFloat(order.totalAmount || '0'))}\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {order.orderDate ? new Date(order.orderDate).toLocaleDateString('en-GB') : 'N/A'}\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {order.expectedDeliveryDate ? new Date(order.expectedDeliveryDate).toLocaleDateString('en-GB') : 'TBD'}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={order.status === 'delivered' ? 'default' : \n                                  order.status === 'pending' ? 'secondary' : 'destructive'}\n                          className={order.status === 'delivered' ? 'bg-green-100 text-green-800' :\n                                    order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : ''}\n                          data-testid={`status-${index}`}\n                        >\n                          {order.status}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <button \n                            className=\"text-blue-600 hover:text-blue-800\"\n                            data-testid={`button-view-${index}`}\n                          >\n                            ðŸ‘ï¸\n                          </button>\n                          <button \n                            className=\"text-green-600 hover:text-green-800\"\n                            data-testid={`button-edit-${index}`}\n                          >\n                            âœï¸\n                          </button>\n                          <button \n                            className=\"text-purple-600 hover:text-purple-800\"\n                            data-testid={`button-print-${index}`}\n                          >\n                            ðŸ–¨ï¸\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : (\n                  <tr>\n                    <td colSpan={9} className=\"p-8 text-center text-muted-foreground\">\n                      No purchase orders found for the selected criteria\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":17349},"client/src/pages/SalesHistory.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport type { SalesTransaction, Customer, Product } from \"@shared/schema\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Eye, Printer, Edit, Download, Trash2, Play } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\ninterface DraftSale {\n  id: string;\n  selectedCustomerId: string;\n  transactionItems: any[];\n  paymentMethod: string;\n  timestamp: number;\n  totalAmount: number;\n}\n\nexport default function SalesHistory() {\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dateFilter, setDateFilter] = useState(\"today\");\n  const [paymentFilter, setPaymentFilter] = useState(\"all\");\n  const [draftSales, setDraftSales] = useState<DraftSale[]>([]);\n  const [showDrafts, setShowDrafts] = useState(true);\n\n  const handleViewTransaction = (transactionId: string) => {\n    navigate(`/invoice/${transactionId}`);\n  };\n\n  const handlePrintTransaction = (transactionId: string) => {\n    // Open invoice page in new window with print parameter - InvoiceReceipt will handle print timing\n    const printWindow = window.open(`/invoice/${transactionId}?print=1`, '_blank');\n    if (!printWindow) {\n      toast({\n        title: \"Print Blocked\",\n        description: \"Please allow popups to print invoices\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleEditTransaction = (transactionId: string) => {\n    // Navigate to Point of Sale with pre-loaded transaction data\n    navigate(`/pos?edit=${transactionId}`);\n  };\n\n  const handleContinueDraft = (draftId: string) => {\n    // Navigate to Point of Sale to continue the draft\n    navigate(`/pos?draft=${draftId}`);\n  };\n\n  const handleDeleteDraft = (draftId: string) => {\n    const updatedDrafts = draftSales.filter(draft => draft.id !== draftId);\n    setDraftSales(updatedDrafts);\n    \n    // Update localStorage\n    if (updatedDrafts.length > 0) {\n      localStorage.setItem('allPosDrafts', JSON.stringify(updatedDrafts));\n    } else {\n      localStorage.removeItem('allPosDrafts');\n      localStorage.removeItem('posDraft'); // Also remove single draft\n    }\n    \n    toast({\n      title: \"Draft deleted\",\n      description: \"Draft sale has been removed\",\n    });\n  };\n\n  // Load drafts from localStorage\n  useEffect(() => {\n    const loadDrafts = () => {\n      try {\n        // Check for multiple drafts\n        const allDrafts = localStorage.getItem('allPosDrafts');\n        if (allDrafts) {\n          const drafts = JSON.parse(allDrafts) as DraftSale[];\n          setDraftSales(drafts);\n          return;\n        }\n        \n        // Check for single draft (legacy support)\n        const singleDraft = localStorage.getItem('posDraft');\n        if (singleDraft) {\n          const draft = JSON.parse(singleDraft);\n          const totalAmount = draft.transactionItems?.reduce((sum: number, item: any) => {\n            return sum + (item.totalPrice || 0);\n          }, 0) || 0;\n          \n          const draftSale: DraftSale = {\n            id: `draft-${draft.timestamp || Date.now()}`,\n            selectedCustomerId: draft.selectedCustomerId || '',\n            transactionItems: draft.transactionItems || [],\n            paymentMethod: draft.paymentMethod || 'cash',\n            timestamp: draft.timestamp || Date.now(),\n            totalAmount: totalAmount\n          };\n          \n          setDraftSales([draftSale]);\n          \n          // Migrate to new format\n          localStorage.setItem('allPosDrafts', JSON.stringify([draftSale]));\n        }\n      } catch (error) {\n        console.error('Failed to load drafts:', error);\n      }\n    };\n    \n    loadDrafts();\n  }, []);\n\n  const exportToExcel = () => {\n    const csvContent = \"data:text/csv;charset=utf-8,\" + \n      \"Invoice,Customer,Amount,Payment Method,Date\\n\" +\n      filteredTransactions.map(t => {\n        const customer = customers.find(c => c.id === t.customerId);\n        const date = t.transactionDate ? new Date(t.transactionDate).toLocaleDateString() : 'N/A';\n        return `${t.invoiceNumber},${customer?.name || 'Walk-in'},${t.totalAmount},${t.paymentMethod},${date}`;\n      }).join(\"\\n\");\n    \n    const encodedUri = encodeURI(csvContent);\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodedUri);\n    link.setAttribute(\"download\", `sales-history-${new Date().toISOString().split('T')[0]}.csv`);\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const exportToPDF = () => {\n    // Create a printable version of the sales data\n    const printContent = `\n      <html>\n        <head>\n          <title>Sales History Report</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            th { background-color: #f2f2f2; }\n            .header { text-align: center; margin-bottom: 20px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>Sales History Report</h1>\n            <p>Generated on ${new Date().toLocaleDateString()}</p>\n          </div>\n          <table>\n            <tr>\n              <th>Invoice</th>\n              <th>Customer</th>\n              <th>Amount</th>\n              <th>Payment Method</th>\n              <th>Date</th>\n            </tr>\n            ${filteredTransactions.map(t => {\n              const customer = customers.find(c => c.id === t.customerId);\n              const date = t.transactionDate ? new Date(t.transactionDate).toLocaleDateString() : 'N/A';\n              return `<tr>\n                <td>${t.invoiceNumber}</td>\n                <td>${customer?.name || 'Walk-in'}</td>\n                <td>${formatCurrency(parseFloat(t.totalAmount || '0'))}</td>\n                <td>${t.paymentMethod}</td>\n                <td>${date}</td>\n              </tr>`;\n            }).join('')}\n          </table>\n        </body>\n      </html>\n    `;\n    \n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(printContent);\n      printWindow.document.close();\n      printWindow.print();\n    }\n  };\n\n  const { data: salesTransactions = [], isLoading } = useQuery<SalesTransaction[]>({\n    queryKey: [\"/api/sales\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const filteredTransactions = salesTransactions.filter((transaction: SalesTransaction) => {\n    const matchesSearch = transaction.invoiceNumber?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesPayment = paymentFilter === \"all\" || transaction.paymentMethod === paymentFilter;\n    \n    // Date filtering\n    if (!transaction.transactionDate) return false;\n    const transactionDate = new Date(transaction.transactionDate);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    let matchesDate = true;\n    if (dateFilter === \"today\") {\n      const transactionToday = new Date(transactionDate);\n      transactionToday.setHours(0, 0, 0, 0);\n      matchesDate = transactionToday.getTime() === today.getTime();\n    } else if (dateFilter === \"yesterday\") {\n      const yesterday = new Date(today);\n      yesterday.setDate(yesterday.getDate() - 1);\n      const transactionToday = new Date(transactionDate);\n      transactionToday.setHours(0, 0, 0, 0);\n      matchesDate = transactionToday.getTime() === yesterday.getTime();\n    } else if (dateFilter === \"week\") {\n      const weekAgo = new Date(today);\n      weekAgo.setDate(weekAgo.getDate() - 7);\n      matchesDate = transactionDate >= weekAgo;\n    } else if (dateFilter === \"month\") {\n      const monthAgo = new Date(today);\n      monthAgo.setMonth(monthAgo.getMonth() - 1);\n      matchesDate = transactionDate >= monthAgo;\n    }\n    \n    return matchesSearch && matchesPayment && matchesDate;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const todaysSales = filteredTransactions.length;\n  const totalAmount = filteredTransactions.reduce((sum: number, t: SalesTransaction) => sum + parseFloat(t.totalAmount || '0'), 0);\n  const cashSales = filteredTransactions.filter((t: SalesTransaction) => t.paymentMethod === 'cash').length;\n  const creditSales = filteredTransactions.filter((t: SalesTransaction) => t.paymentMethod === 'credit').length;\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Sales History</h3>\n          <p className=\"text-muted-foreground\">Complete transaction history and sales analytics</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Button variant=\"outline\" onClick={exportToExcel} data-testid=\"button-export-excel\">\n            ðŸ“Š Export Excel\n          </Button>\n          <Button variant=\"outline\" onClick={exportToPDF} data-testid=\"button-export-pdf\">\n            ðŸ“„ Export PDF\n          </Button>\n        </div>\n      </div>\n\n      {/* Sales Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"todays-transactions\">\n              {todaysSales}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Today's Transactions</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"total-sales-amount\">\n              {formatCurrency(totalAmount)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Sales Amount</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-blue-600\" data-testid=\"cash-transactions\">\n              {cashSales}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Cash Transactions</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"credit-transactions\">\n              {creditSales}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Credit Transactions</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Sales History Table */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Transaction History</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search by invoice...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-invoice\"\n              />\n              <Select value={dateFilter} onValueChange={setDateFilter}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-date-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"today\">Today</SelectItem>\n                  <SelectItem value=\"yesterday\">Yesterday</SelectItem>\n                  <SelectItem value=\"week\">This Week</SelectItem>\n                  <SelectItem value=\"month\">This Month</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={paymentFilter} onValueChange={setPaymentFilter}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-payment-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Methods</SelectItem>\n                  <SelectItem value=\"cash\">Cash</SelectItem>\n                  <SelectItem value=\"card\">Card</SelectItem>\n                  <SelectItem value=\"credit\">Credit</SelectItem>\n                  <SelectItem value=\"fleet\">Fleet</SelectItem>\n                </SelectContent>\n              </Select>\n              <Button \n                variant={showDrafts ? \"default\" : \"outline\"}\n                onClick={() => setShowDrafts(!showDrafts)}\n                data-testid=\"button-toggle-drafts\"\n              >\n                {showDrafts ? \"Hide Drafts\" : \"Show Drafts\"}\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Time</th>\n                  <th className=\"text-left p-3 font-medium\">Invoice</th>\n                  <th className=\"text-left p-3 font-medium\">Customer</th>\n                  <th className=\"text-left p-3 font-medium\">Product</th>\n                  <th className=\"text-right p-3 font-medium\">Quantity</th>\n                  <th className=\"text-right p-3 font-medium\">Rate</th>\n                  <th className=\"text-right p-3 font-medium\">Amount</th>\n                  <th className=\"text-center p-3 font-medium\">Payment</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {/* Draft Sales */}\n                {showDrafts && draftSales.map((draft: DraftSale, index: number) => {\n                  const customer = customers.find(c => c.id === draft.selectedCustomerId);\n                  const draftTime = new Date(draft.timestamp).toLocaleTimeString('en-IN', {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  });\n                  \n                  return (\n                    <tr key={`draft-${draft.id}`} className=\"border-b border-border hover:bg-muted/50 bg-yellow-50 dark:bg-yellow-900/20\">\n                      <td className=\"p-3 text-sm\">{draftTime}</td>\n                      <td className=\"p-3\">\n                        <span className=\"font-medium text-yellow-600\" data-testid={`draft-invoice-${index}`}>\n                          DRAFT-{draft.id.split('-').pop()?.slice(-6)}\n                        </span>\n                      </td>\n                      <td className=\"p-3\">{customer?.name || 'Walk-in Customer'}</td>\n                      <td className=\"p-3\">{draft.transactionItems.length} items</td>\n                      <td className=\"p-3 text-right\">{draft.transactionItems.reduce((sum, item) => sum + (item.quantity || 0), 0).toFixed(1)}L</td>\n                      <td className=\"p-3 text-right\">-</td>\n                      <td className=\"p-3 text-right font-semibold\" data-testid={`draft-amount-${index}`}>\n                        {formatCurrency(draft.totalAmount)}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge variant=\"outline\" className=\"bg-yellow-100 text-yellow-800\">\n                          DRAFT\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleContinueDraft(draft.id)}\n                            className=\"text-green-600 hover:text-green-800 p-1\"\n                            data-testid={`button-continue-draft-${index}`}\n                            title=\"Continue Draft\"\n                          >\n                            <Play className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteDraft(draft.id)}\n                            className=\"text-red-600 hover:text-red-800 p-1\"\n                            data-testid={`button-delete-draft-${index}`}\n                            title=\"Delete Draft\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n                \n                {/* Completed Sales */}\n                {filteredTransactions.length > 0 ? filteredTransactions.map((transaction: SalesTransaction, index: number) => {\n                  const customer = customers.find(c => c.id === transaction.customerId);\n                  const transactionTime = transaction.transactionDate \n                    ? new Date(transaction.transactionDate).toLocaleTimeString('en-IN', {\n                        hour: '2-digit',\n                        minute: '2-digit'\n                      })\n                    : 'N/A';\n                  \n                  return (\n                    <tr key={transaction.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3 text-sm\">{transactionTime}</td>\n                      <td className=\"p-3\">\n                        <span className=\"font-medium text-primary\" data-testid={`invoice-${index}`}>\n                          {transaction.invoiceNumber}\n                        </span>\n                      </td>\n                      <td className=\"p-3\">{customer?.name || 'Walk-in Customer'}</td>\n                      <td className=\"p-3\">Mixed Products</td>\n                      <td className=\"p-3 text-right\">-</td>\n                      <td className=\"p-3 text-right\">-</td>\n                      <td className=\"p-3 text-right font-semibold\" data-testid={`amount-${index}`}>\n                        {formatCurrency(parseFloat(transaction.totalAmount || '0'))}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={transaction.paymentMethod === 'cash' ? 'default' : \n                                  transaction.paymentMethod === 'credit' ? 'destructive' : 'secondary'}\n                          data-testid={`payment-method-${index}`}\n                        >\n                          {transaction.paymentMethod}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleViewTransaction(transaction.id)}\n                            className=\"text-blue-600 hover:text-blue-800 p-1\"\n                            data-testid={`button-view-${index}`}\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handlePrintTransaction(transaction.id)}\n                            className=\"text-green-600 hover:text-green-800 p-1\"\n                            data-testid={`button-print-${index}`}\n                          >\n                            <Printer className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEditTransaction(transaction.id)}\n                            className=\"text-purple-600 hover:text-purple-800 p-1\"\n                            data-testid={`button-edit-${index}`}\n                            title=\"Edit Transaction\"\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : null}\n                \n                {/* Show message when no data */}\n                {filteredTransactions.length === 0 && (!showDrafts || draftSales.length === 0) && (\n                  <tr>\n                    <td colSpan={9} className=\"p-8 text-center text-muted-foreground\">\n                      {showDrafts && draftSales.length === 0 \n                        ? \"No transactions or drafts found\" \n                        : \"No transactions found for the selected criteria\"}\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":22013},"client/src/pages/Settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { CURRENCY_CONFIG, type CurrencyCode } from \"@/lib/currency\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  const { currency, setCurrency } = useCurrency();\n  \n  // Theme state\n  const [isDarkMode, setIsDarkMode] = useState(() => {\n    return document.documentElement.classList.contains('dark');\n  });\n  \n  // Notification preferences\n  const [notifications, setNotifications] = useState({\n    lowStock: true,\n    salesAlerts: true,\n    paymentReminders: true,\n    systemUpdates: false,\n  });\n  \n  // Display preferences\n  const [displayPreferences, setDisplayPreferences] = useState({\n    compactView: false,\n    showTips: true,\n    autoRefresh: true,\n    refreshInterval: \"30\",\n  });\n  \n  // Station settings\n  const [stationSettings, setStationSettings] = useState({\n    stationName: \"Pak Petrol Station\",\n    address: \"Main Highway, Lahore\",\n    contactNumber: \"+92-300-1234567\",\n    email: \"station@pakpetrol.com\",\n    gstNumber: \"PAK-GST-123456789\",\n  });\n\n  // Handle dark mode toggle\n  const toggleDarkMode = () => {\n    const newDarkMode = !isDarkMode;\n    setIsDarkMode(newDarkMode);\n    \n    if (newDarkMode) {\n      document.documentElement.classList.add('dark');\n      localStorage.setItem('theme', 'dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n      localStorage.setItem('theme', 'light');\n    }\n    \n    toast({\n      title: \"Theme updated\",\n      description: `Switched to ${newDarkMode ? 'dark' : 'light'} mode`,\n    });\n  };\n\n  // Initialize theme state from current DOM state (theme is now initialized globally)\n  useEffect(() => {\n    setIsDarkMode(document.documentElement.classList.contains('dark'));\n  }, []);\n\n  // Load saved settings on component mount\n  useEffect(() => {\n    // Load notification preferences\n    const savedNotifications = localStorage.getItem('notifications');\n    if (savedNotifications) {\n      try {\n        const parsedNotifications = JSON.parse(savedNotifications);\n        setNotifications(parsedNotifications);\n      } catch (error) {\n        console.error('Failed to parse saved notifications:', error);\n      }\n    }\n\n    // Load display preferences  \n    const savedDisplayPreferences = localStorage.getItem('displayPreferences');\n    if (savedDisplayPreferences) {\n      try {\n        const parsedDisplayPreferences = JSON.parse(savedDisplayPreferences);\n        setDisplayPreferences(parsedDisplayPreferences);\n      } catch (error) {\n        console.error('Failed to parse saved display preferences:', error);\n      }\n    }\n\n    // Load station settings\n    const savedStationSettings = localStorage.getItem('stationSettings');\n    if (savedStationSettings) {\n      try {\n        const parsedStationSettings = JSON.parse(savedStationSettings);\n        setStationSettings(parsedStationSettings);\n      } catch (error) {\n        console.error('Failed to parse saved station settings:', error);\n      }\n    }\n  }, []);\n\n  // Handle currency change\n  const handleCurrencyChange = (newCurrency: CurrencyCode) => {\n    setCurrency(newCurrency);\n    toast({\n      title: \"Currency updated\",\n      description: `Currency changed to ${CURRENCY_CONFIG[newCurrency].name}`,\n    });\n  };\n\n  // Save settings\n  const saveSettings = () => {\n    // Here you would normally save to the backend\n    localStorage.setItem('notifications', JSON.stringify(notifications));\n    localStorage.setItem('displayPreferences', JSON.stringify(displayPreferences));\n    localStorage.setItem('stationSettings', JSON.stringify(stationSettings));\n    \n    toast({\n      title: \"Settings saved\",\n      description: \"Your preferences have been saved successfully\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h3 className=\"text-2xl font-semibold text-card-foreground mb-2\">Settings</h3>\n        <p className=\"text-muted-foreground\">\n          Manage your preferences, currency settings, and system configuration\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Currency & Localization */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              ðŸ’± Currency & Localization\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"currency-select\" className=\"text-sm font-medium\">\n                Default Currency\n              </Label>\n              <Select value={currency} onValueChange={handleCurrencyChange}>\n                <SelectTrigger className=\"mt-2\" data-testid=\"select-currency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {(Object.entries(CURRENCY_CONFIG) as [CurrencyCode, typeof CURRENCY_CONFIG[CurrencyCode]][]).map(([code, config]) => (\n                    <SelectItem key={code} value={code}>\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"font-mono text-sm\">{config.symbol}</span>\n                        <span>{config.name}</span>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {code}\n                        </Badge>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Current: {CURRENCY_CONFIG[currency].symbol} {CURRENCY_CONFIG[currency].name}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Appearance */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              ðŸŽ¨ Appearance\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Dark Mode</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Toggle between light and dark themes\n                </p>\n              </div>\n              <Switch\n                checked={isDarkMode}\n                onCheckedChange={toggleDarkMode}\n                data-testid=\"switch-dark-mode\"\n              />\n            </div>\n            \n            <Separator />\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Compact View</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Use smaller cards and spacing\n                </p>\n              </div>\n              <Switch\n                checked={displayPreferences.compactView}\n                onCheckedChange={(checked) => \n                  setDisplayPreferences(prev => ({ ...prev, compactView: checked }))\n                }\n                data-testid=\"switch-compact-view\"\n              />\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Show Tips</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Display helpful tips throughout the app\n                </p>\n              </div>\n              <Switch\n                checked={displayPreferences.showTips}\n                onCheckedChange={(checked) => \n                  setDisplayPreferences(prev => ({ ...prev, showTips: checked }))\n                }\n                data-testid=\"switch-show-tips\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Notifications */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              ðŸ”” Notifications\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Low Stock Alerts</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Notify when tank levels are low\n                </p>\n              </div>\n              <Switch\n                checked={notifications.lowStock}\n                onCheckedChange={(checked) => \n                  setNotifications(prev => ({ ...prev, lowStock: checked }))\n                }\n                data-testid=\"switch-low-stock\"\n              />\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Sales Alerts</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Notify for large transactions\n                </p>\n              </div>\n              <Switch\n                checked={notifications.salesAlerts}\n                onCheckedChange={(checked) => \n                  setNotifications(prev => ({ ...prev, salesAlerts: checked }))\n                }\n                data-testid=\"switch-sales-alerts\"\n              />\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Payment Reminders</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Remind about overdue payments\n                </p>\n              </div>\n              <Switch\n                checked={notifications.paymentReminders}\n                onCheckedChange={(checked) => \n                  setNotifications(prev => ({ ...prev, paymentReminders: checked }))\n                }\n                data-testid=\"switch-payment-reminders\"\n              />\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">System Updates</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Notify about app updates\n                </p>\n              </div>\n              <Switch\n                checked={notifications.systemUpdates}\n                onCheckedChange={(checked) => \n                  setNotifications(prev => ({ ...prev, systemUpdates: checked }))\n                }\n                data-testid=\"switch-system-updates\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Data & Performance */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              âš¡ Data & Performance\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <Label className=\"text-sm font-medium\">Auto Refresh</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Automatically refresh data\n                </p>\n              </div>\n              <Switch\n                checked={displayPreferences.autoRefresh}\n                onCheckedChange={(checked) => \n                  setDisplayPreferences(prev => ({ ...prev, autoRefresh: checked }))\n                }\n                data-testid=\"switch-auto-refresh\"\n              />\n            </div>\n            \n            {displayPreferences.autoRefresh && (\n              <div>\n                <Label className=\"text-sm font-medium\">Refresh Interval (seconds)</Label>\n                <Select \n                  value={displayPreferences.refreshInterval} \n                  onValueChange={(value) => \n                    setDisplayPreferences(prev => ({ ...prev, refreshInterval: value }))\n                  }\n                >\n                  <SelectTrigger className=\"mt-2\" data-testid=\"select-refresh-interval\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"15\">15 seconds</SelectItem>\n                    <SelectItem value=\"30\">30 seconds</SelectItem>\n                    <SelectItem value=\"60\">1 minute</SelectItem>\n                    <SelectItem value=\"120\">2 minutes</SelectItem>\n                    <SelectItem value=\"300\">5 minutes</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Station Information */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            ðŸª Station Information\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"station-name\" className=\"text-sm font-medium\">Station Name</Label>\n              <Input\n                id=\"station-name\"\n                value={stationSettings.stationName}\n                onChange={(e) => setStationSettings(prev => ({ ...prev, stationName: e.target.value }))}\n                data-testid=\"input-station-name\"\n                className=\"mt-2\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"contact-number\" className=\"text-sm font-medium\">Contact Number</Label>\n              <Input\n                id=\"contact-number\"\n                value={stationSettings.contactNumber}\n                onChange={(e) => setStationSettings(prev => ({ ...prev, contactNumber: e.target.value }))}\n                data-testid=\"input-contact-number\"\n                className=\"mt-2\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"email\" className=\"text-sm font-medium\">Email Address</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={stationSettings.email}\n                onChange={(e) => setStationSettings(prev => ({ ...prev, email: e.target.value }))}\n                data-testid=\"input-email\"\n                className=\"mt-2\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"gst-number\" className=\"text-sm font-medium\">GST Number</Label>\n              <Input\n                id=\"gst-number\"\n                value={stationSettings.gstNumber}\n                onChange={(e) => setStationSettings(prev => ({ ...prev, gstNumber: e.target.value }))}\n                data-testid=\"input-gst-number\"\n                className=\"mt-2\"\n              />\n            </div>\n            \n            <div className=\"md:col-span-2\">\n              <Label htmlFor=\"address\" className=\"text-sm font-medium\">Address</Label>\n              <Input\n                id=\"address\"\n                value={stationSettings.address}\n                onChange={(e) => setStationSettings(prev => ({ ...prev, address: e.target.value }))}\n                data-testid=\"input-address\"\n                className=\"mt-2\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Save Button */}\n      <div className=\"flex justify-end\">\n        <Button onClick={saveSettings} size=\"lg\" data-testid=\"button-save-settings\">\n          ðŸ’¾ Save All Settings\n        </Button>\n      </div>\n    </div>\n  );\n}","size_bytes":16060},"client/src/pages/StockManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { Tank, Product, StockMovement } from \"@shared/schema\";\nimport { insertStockMovementSchema } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Combobox } from \"@/components/ui/combobox\";\nimport { useLocation } from \"wouter\";\n\nexport default function StockManagement() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n  const [open, setOpen] = useState(false);\n\n  const form = useForm({\n    resolver: zodResolver(insertStockMovementSchema.omit({ id: true })),\n    defaultValues: {\n      tankId: \"\",\n      movementType: \"in\",\n      quantity: \"0\",\n      previousStock: \"0\",\n      newStock: \"0\",\n      referenceType: \"adjustment\",\n      notes: \"\",\n      stationId: user?.stationId || \"\",\n      userId: user?.id || \"\",\n    },\n  });\n\n  // Regular stock movement mutation with success handling\n  const createStockMovementMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const movementData = {\n        ...data,\n        stationId: user?.stationId || data.stationId,\n        userId: user?.id || data.userId,\n      };\n      const response = await apiRequest(\"POST\", \"/api/stock-movements\", movementData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Stock entry recorded\",\n        description: \"Stock movement has been recorded successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-movements\", user?.stationId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tanks\", user?.stationId] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record stock movement\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Batch stock movement mutation without success callbacks (for transfers and audits)\n  const batchStockMovementMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const movementData = {\n        ...data,\n        stationId: user?.stationId || data.stationId,\n        userId: user?.id || data.userId,\n      };\n      const response = await apiRequest(\"POST\", \"/api/stock-movements\", movementData);\n      return response.json();\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createStockMovementMutation.mutate(data);\n  };\n\n  // Quick Actions handlers\n  const handleStockReport = () => {\n    toast({\n      title: \"Stock Report\",\n      description: \"Generating comprehensive stock report...\",\n    });\n    // Navigate to reports or open print dialog\n    setLocation('/financial-reports');\n  };\n\n  const handleNewPurchase = () => {\n    setLocation('/purchase-orders');\n  };\n\n  const [transferDialogOpen, setTransferDialogOpen] = useState(false);\n  const [auditDialogOpen, setAuditDialogOpen] = useState(false);\n  const [transferForm, setTransferForm] = useState({\n    sourceTankId: \"\",\n    destinationTankId: \"\", \n    quantity: \"\",\n    remarks: \"\"\n  });\n  const [auditForm, setAuditForm] = useState<{[tankId: string]: string}>({});\n\n  const handleStockTransfer = () => {\n    setTransferForm({ sourceTankId: \"\", destinationTankId: \"\", quantity: \"\", remarks: \"\" });\n    setTransferDialogOpen(true);\n  };\n\n  const handleStockAudit = () => {\n    // Initialize audit form with current stock values for all tanks\n    const initialAuditData = tanks.reduce((acc, tank) => {\n      acc[tank.id] = tank.currentStock || \"0\";\n      return acc;\n    }, {} as {[tankId: string]: string});\n    setAuditForm(initialAuditData);\n    setAuditDialogOpen(true);\n  };\n\n  const executeStockTransfer = async () => {\n    const { sourceTankId, destinationTankId, quantity, remarks } = transferForm;\n    \n    if (!sourceTankId || !destinationTankId || !quantity || parseFloat(quantity) <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill all fields with valid values\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (sourceTankId === destinationTankId) {\n      toast({\n        title: \"Error\", \n        description: \"Source and destination tanks cannot be the same\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const sourceTank = tanks.find(t => t.id === sourceTankId);\n    const destTank = tanks.find(t => t.id === destinationTankId);\n    const transferQty = parseFloat(quantity);\n\n    if (!sourceTank || !destTank) {\n      toast({\n        title: \"Error\",\n        description: \"Invalid tank selection\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate source has enough stock\n    if (parseFloat(sourceTank.currentStock || \"0\") < transferQty) {\n      toast({\n        title: \"Error\",\n        description: \"Insufficient stock in source tank\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate destination has capacity\n    const destCurrentStock = parseFloat(destTank.currentStock || \"0\");\n    const destCapacity = parseFloat(destTank.capacity || \"0\");\n    if (destCurrentStock + transferQty > destCapacity) {\n      toast({\n        title: \"Error\", \n        description: \"Not enough capacity in destination tank\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Generate single reference ID for atomicity\n      const transferRef = `TXF-${Date.now()}`;\n      \n      // Create OUT movement from source\n      await batchStockMovementMutation.mutateAsync({\n        tankId: sourceTankId,\n        movementType: \"out\",\n        quantity: quantity,\n        unitPrice: \"0\",\n        remarks: `Transfer OUT to ${destTank.name} - ${remarks}`,\n        referenceType: \"transfer\",\n        referenceId: transferRef\n      });\n\n      // Create IN movement to destination  \n      await batchStockMovementMutation.mutateAsync({\n        tankId: destinationTankId,\n        movementType: \"in\", \n        quantity: quantity,\n        unitPrice: \"0\",\n        remarks: `Transfer IN from ${sourceTank.name} - ${remarks}`,\n        referenceType: \"transfer\",\n        referenceId: transferRef\n      });\n\n      toast({\n        title: \"Transfer Completed\",\n        description: `Successfully transferred ${transferQty}L from ${sourceTank.name} to ${destTank.name}`,\n      });\n\n      setTransferDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/tanks\", user?.stationId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-movements\", user?.stationId] });\n    } catch (error) {\n      toast({\n        title: \"Transfer Failed\",\n        description: \"Failed to complete stock transfer\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const executeStockAudit = async () => {\n    const auditEntries = Object.entries(auditForm);\n    let adjustmentsMade = 0;\n    const auditRef = `AUD-${Date.now()}`;\n\n    try {\n      for (const [tankId, physicalCount] of auditEntries) {\n        const tank = tanks.find(t => t.id === tankId);\n        if (!tank) continue;\n\n        const currentStock = parseFloat(tank.currentStock || \"0\");\n        const physicalStock = parseFloat(physicalCount);\n        const difference = physicalStock - currentStock;\n\n        // Only create movement if there's a difference\n        if (Math.abs(difference) >= 0.01) {\n          await batchStockMovementMutation.mutateAsync({\n            tankId: tankId,\n            movementType: difference > 0 ? \"in\" : \"out\",\n            quantity: Math.abs(difference).toString(),\n            unitPrice: \"0\",\n            remarks: `Stock audit adjustment - Physical: ${physicalStock}L, System: ${currentStock}L`,\n            referenceType: \"audit\",\n            referenceId: auditRef\n          });\n          adjustmentsMade++;\n        }\n      }\n\n      toast({\n        title: \"Audit Completed\",\n        description: `Stock audit completed. ${adjustmentsMade} adjustments made.`,\n      });\n\n      setAuditDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/tanks\", user?.stationId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-movements\", user?.stationId] });\n    } catch (error) {\n      toast({\n        title: \"Audit Failed\",\n        description: \"Failed to complete stock audit\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCreatePurchaseOrder = (tankId: string) => {\n    setLocation(`/purchase-orders?tank=${tankId}`);\n  };\n\n  const { data: tanks = [], isLoading: tanksLoading } = useQuery<Tank[]>({\n    queryKey: [\"/api/tanks\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: stockMovements = [], isLoading: movementsLoading } = useQuery<StockMovement[]>({\n    queryKey: [\"/api/stock-movements\", user?.stationId],\n    enabled: !!user?.stationId,\n  });\n\n  if (tanksLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(3)].map((_, i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-32 bg-muted rounded\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  const getProductName = (productId: string) => {\n    const product = products.find(p => p.id === productId);\n    return product?.name || 'Unknown Product';\n  };\n\n  const getTankStatus = (currentStock: number, capacity: number, minimumLevel: number) => {\n    const percentage = (currentStock / capacity) * 100;\n    if (currentStock <= minimumLevel) return { status: 'critical', color: 'bg-red-600', textColor: 'text-red-600' };\n    if (percentage < 30) return { status: 'low', color: 'bg-orange-600', textColor: 'text-orange-600' };\n    return { status: 'normal', color: 'bg-green-600', textColor: 'text-green-600' };\n  };\n\n  return (\n    <div className=\"space-y-8 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Stock & Inventory Management</h3>\n          <p className=\"text-muted-foreground\">Real-time tank monitoring and inventory control</p>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-new-stock-entry\">\n                + New Stock Entry\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add Stock Movement</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"tankId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Tank *</FormLabel>\n                        <FormControl>\n                          <Combobox\n                            options={tanks.map(t => ({ value: t.id, label: `${t.name} - ${getProductName(t.productId)}` }))}\n                            value={field.value}\n                            onValueChange={field.onChange}\n                            placeholder=\"Select tank\"\n                            emptyMessage=\"No tanks found\"\n                            data-testid=\"select-tank\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"movementType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Movement Type *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-movement-type\">\n                                <SelectValue placeholder=\"Select type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"in\">Stock In</SelectItem>\n                              <SelectItem value=\"out\">Stock Out</SelectItem>\n                              <SelectItem value=\"adjustment\">Adjustment</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"quantity\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Quantity (L) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.001\" placeholder=\"0.000\" {...field} data-testid=\"input-quantity\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"previousStock\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Previous Stock (L) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.001\" placeholder=\"0.000\" {...field} data-testid=\"input-previous-stock\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"newStock\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>New Stock (L) *</FormLabel>\n                          <FormControl>\n                            <Input type=\"number\" step=\"0.001\" placeholder=\"0.000\" {...field} data-testid=\"input-new-stock\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"referenceType\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Reference Type</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-reference-type\">\n                              <SelectValue placeholder=\"Select type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"sale\">Sale</SelectItem>\n                            <SelectItem value=\"purchase\">Purchase</SelectItem>\n                            <SelectItem value=\"adjustment\">Adjustment</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Notes</FormLabel>\n                        <FormControl>\n                          <Textarea placeholder=\"Additional details about the stock movement\" {...field} data-testid=\"input-stock-notes\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createStockMovementMutation.isPending} data-testid=\"button-submit-stock\">\n                      {createStockMovementMutation.isPending ? \"Recording...\" : \"Record Stock Movement\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Button \n            variant=\"outline\" \n            onClick={handleStockReport}\n            data-testid=\"button-stock-report\"\n          >\n            ðŸ“Š Stock Report\n          </Button>\n        </div>\n      </div>\n\n      {/* Tank Status Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {tanks.map((tank: Tank, index: number) => {\n          const currentStock = parseFloat(tank.currentStock || '0');\n          const capacity = parseFloat(tank.capacity || '1');\n          const minimumLevel = parseFloat(tank.minimumLevel || '0');\n          const percentage = Math.round((currentStock / capacity) * 100);\n          const available = capacity - currentStock;\n          const { status, color, textColor } = getTankStatus(currentStock, capacity, minimumLevel);\n          \n          return (\n            <Card key={tank.id} className=\"shadow-sm\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h4 className=\"font-semibold text-card-foreground\" data-testid={`tank-name-${index}`}>\n                    {tank.name} - {getProductName(tank.productId)}\n                  </h4>\n                  <Badge \n                    variant={status === 'normal' ? 'default' : 'destructive'}\n                    className={status === 'normal' ? 'bg-green-100 text-green-800' : \n                              status === 'low' ? 'bg-yellow-100 text-yellow-800' : \n                              'bg-red-100 text-red-800'}\n                    data-testid={`tank-status-${index}`}\n                  >\n                    {status === 'critical' ? 'Low Stock' : status === 'low' ? 'Low Stock' : 'Normal'}\n                  </Badge>\n                </div>\n                \n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Current Stock:</span>\n                    <span className={`font-semibold ${textColor}`} data-testid={`current-stock-${index}`}>\n                      {currentStock.toLocaleString()} L\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Capacity:</span>\n                    <span data-testid={`capacity-${index}`}>{capacity.toLocaleString()} L</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Available:</span>\n                    <span className=\"text-green-600 font-medium\" data-testid={`available-${index}`}>\n                      {available.toLocaleString()} L\n                    </span>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Progress value={percentage} className=\"h-3\" />\n                    <div className=\"text-center text-sm text-muted-foreground\" data-testid={`percentage-${index}`}>\n                      {percentage}% filled\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {/* Stock Movements and Alerts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Recent Stock Movements */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Recent Stock Movements</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {movementsLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <div key={i} className=\"animate-pulse p-4 bg-muted rounded-md h-20\"></div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {stockMovements.length > 0 ? stockMovements.slice(0, 3).map((movement: StockMovement, index: number) => {\n                  const tank = tanks.find(t => t.id === movement.tankId);\n                  const product = products.find(p => p.id === tank?.productId);\n                  const isPositive = movement.movementType === 'in';\n                  const quantity = parseFloat(movement.quantity || '0');\n                  const timeAgo = movement.movementDate ? new Date(movement.movementDate).toLocaleString('en-GB') : 'Unknown';\n                  \n                  return (\n                    <div key={movement.id} className=\"p-4 border border-border rounded-md\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className={`font-medium ${isPositive ? 'text-green-600' : 'text-red-600'}`}>\n                            Stock {movement.movementType === 'in' ? 'In' : movement.movementType === 'out' ? 'Out' : 'Adjustment'} - {product?.name || 'Unknown'}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {tank?.name} | {movement.referenceType || 'Manual'} #{movement.referenceId || 'N/A'}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">{timeAgo}</div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className={`font-semibold ${isPositive ? 'text-green-600' : 'text-red-600'}`}>\n                            {isPositive ? '+' : ''}{Math.abs(quantity).toLocaleString()} L\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">Movement</div>\n                        </div>\n                      </div>\n                    </div>\n                  );\n                }) : (\n                  <div className=\"p-4 text-center text-muted-foreground\">\n                    No recent stock movements\n                  </div>\n                )}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Low Stock Alerts */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Stock Alerts & Actions</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {/* Generate real alerts based on tank data */}\n              {tanks.filter(tank => {\n                const currentStock = parseFloat(tank.currentStock || '0');\n                const minimumLevel = parseFloat(tank.minimumLevel || '0');\n                return currentStock <= minimumLevel;\n              }).slice(0, 2).map((tank, index) => {\n                const currentStock = parseFloat(tank.currentStock || '0');\n                const capacity = parseFloat(tank.capacity || '1');\n                const percentage = Math.round((currentStock / capacity) * 100);\n                const product = products.find(p => p.id === tank.productId);\n                \n                return (\n                  <div key={tank.id} className=\"p-3 bg-yellow-50 border border-yellow-200 rounded-md\">\n                    <div className=\"flex items-start\">\n                      <span className=\"text-yellow-500 mr-2\">âš ï¸</span>\n                      <div className=\"flex-1\">\n                        <div className=\"text-sm font-medium text-yellow-800\">Low Stock Alert</div>\n                        <div className=\"text-xs text-yellow-600 mt-1\">\n                          {tank.name} ({product?.name}) - Only {currentStock.toLocaleString()}L remaining ({percentage}% capacity)\n                        </div>\n                        <Button \n                          size=\"sm\" \n                          className=\"mt-2 bg-yellow-600 hover:bg-yellow-700 text-white\"\n                          onClick={() => handleCreatePurchaseOrder(tank.id)}\n                          data-testid=\"button-create-purchase-order\"\n                        >\n                          Create Purchase Order\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n              \n              {/* Show info message if no critical alerts */}\n              {tanks.filter(tank => parseFloat(tank.currentStock || '0') <= parseFloat(tank.minimumLevel || '0')).length === 0 && (\n                <div className=\"p-3 bg-green-50 border border-green-200 rounded-md\">\n                  <div className=\"flex items-start\">\n                    <span className=\"text-green-500 mr-2\">âœ“</span>\n                    <div className=\"flex-1\">\n                      <div className=\"text-sm font-medium text-green-800\">All Stock Levels Normal</div>\n                      <div className=\"text-xs text-green-600 mt-1\">\n                        No critical stock alerts at this time\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Quick Stock Actions */}\n            <div className=\"mt-6 pt-4 border-t border-border\">\n              <h5 className=\"font-medium text-card-foreground mb-3\">Quick Actions</h5>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleStockReport}\n                  data-testid=\"button-stock-report-quick\"\n                >\n                  ðŸ“Š Stock Report\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleNewPurchase}\n                  data-testid=\"button-new-purchase\"\n                >\n                  ðŸ“¦ New Purchase\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleStockTransfer}\n                  data-testid=\"button-stock-transfer\"\n                >\n                  ðŸ”„ Stock Transfer\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={handleStockAudit}\n                  data-testid=\"button-stock-audit\"\n                >\n                  ðŸ“‹ Stock Audit\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Stock Transfer Dialog */}\n      <Dialog open={transferDialogOpen} onOpenChange={setTransferDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Stock Transfer</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium\">Source Tank</label>\n              <Select value={transferForm.sourceTankId} onValueChange={(value) => setTransferForm(prev => ({...prev, sourceTankId: value}))}>\n                <SelectTrigger className=\"mt-2\" data-testid=\"select-source-tank\">\n                  <SelectValue placeholder=\"Choose source tank\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {tanks.map(tank => {\n                    const product = products.find(p => p.id === tank.productId);\n                    return (\n                      <SelectItem key={tank.id} value={tank.id}>\n                        {tank.name} - {product?.name} ({parseFloat(tank.currentStock || '0').toLocaleString()}L available)\n                      </SelectItem>\n                    );\n                  })}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"text-sm font-medium\">Destination Tank</label>\n              <Select value={transferForm.destinationTankId} onValueChange={(value) => setTransferForm(prev => ({...prev, destinationTankId: value}))}>\n                <SelectTrigger className=\"mt-2\" data-testid=\"select-destination-tank\">\n                  <SelectValue placeholder=\"Choose destination tank\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {tanks.filter(tank => tank.id !== transferForm.sourceTankId).map(tank => {\n                    const product = products.find(p => p.id === tank.productId);\n                    const available = parseFloat(tank.capacity || \"0\") - parseFloat(tank.currentStock || \"0\");\n                    return (\n                      <SelectItem key={tank.id} value={tank.id}>\n                        {tank.name} - {product?.name} ({available.toLocaleString()}L capacity)\n                      </SelectItem>\n                    );\n                  })}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"text-sm font-medium\">Quantity (Liters)</label>\n              <Input\n                type=\"number\"\n                placeholder=\"Enter quantity to transfer\"\n                value={transferForm.quantity}\n                onChange={(e) => setTransferForm(prev => ({...prev, quantity: e.target.value}))}\n                className=\"mt-2\"\n                data-testid=\"input-transfer-quantity\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium\">Remarks</label>\n              <Input\n                placeholder=\"Transfer notes (optional)\"\n                value={transferForm.remarks}\n                onChange={(e) => setTransferForm(prev => ({...prev, remarks: e.target.value}))}\n                className=\"mt-2\"\n                data-testid=\"input-transfer-remarks\"\n              />\n            </div>\n            <div className=\"flex justify-end space-x-3\">\n              <Button variant=\"outline\" onClick={() => setTransferDialogOpen(false)} data-testid=\"button-cancel-transfer\">\n                Cancel\n              </Button>\n              <Button \n                onClick={executeStockTransfer} \n                disabled={batchStockMovementMutation.isPending}\n                data-testid=\"button-execute-transfer\"\n              >\n                {batchStockMovementMutation.isPending ? \"Transferring...\" : \"Execute Transfer\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Stock Audit Dialog */}\n      <Dialog open={auditDialogOpen} onOpenChange={setAuditDialogOpen}>\n        <DialogContent className=\"sm:max-w-[600px] max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Stock Audit</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"text-sm text-muted-foreground\">\n              Enter the physical count for each tank. The system will automatically calculate adjustments based on the difference between physical and system stock.\n            </div>\n            <div className=\"border rounded-lg p-4 bg-muted/50\">\n              <h4 className=\"font-medium mb-3\">Physical Stock Count:</h4>\n              <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                {tanks.map(tank => {\n                  const product = products.find(p => p.id === tank.productId);\n                  const systemStock = parseFloat(tank.currentStock || '0');\n                  const physicalStock = parseFloat(auditForm[tank.id] || '0');\n                  const difference = physicalStock - systemStock;\n                  \n                  return (\n                    <div key={tank.id} className=\"grid grid-cols-12 gap-2 items-center text-sm\">\n                      <div className=\"col-span-4\">\n                        <div className=\"font-medium\">{tank.name}</div>\n                        <div className=\"text-xs text-muted-foreground\">{product?.name}</div>\n                      </div>\n                      <div className=\"col-span-2 text-center\">\n                        <div className=\"text-xs text-muted-foreground\">System</div>\n                        <div>{systemStock.toLocaleString()}L</div>\n                      </div>\n                      <div className=\"col-span-3\">\n                        <Input\n                          type=\"number\"\n                          placeholder=\"Physical count\"\n                          value={auditForm[tank.id] || ''}\n                          onChange={(e) => setAuditForm(prev => ({...prev, [tank.id]: e.target.value}))}\n                          className=\"text-center\"\n                          data-testid={`input-audit-${tank.id}`}\n                        />\n                      </div>\n                      <div className=\"col-span-3 text-center\">\n                        <div className=\"text-xs text-muted-foreground\">Difference</div>\n                        <div className={`font-medium ${Math.abs(difference) < 0.01 ? 'text-green-600' : difference > 0 ? 'text-blue-600' : 'text-red-600'}`}>\n                          {Math.abs(difference) < 0.01 ? 'âœ“' : (difference > 0 ? '+' : '') + difference.toFixed(1)}L\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n            <div className=\"flex justify-end space-x-3\">\n              <Button variant=\"outline\" onClick={() => setAuditDialogOpen(false)} data-testid=\"button-cancel-audit\">\n                Cancel\n              </Button>\n              <Button \n                onClick={executeStockAudit} \n                disabled={batchStockMovementMutation.isPending}\n                data-testid=\"button-execute-audit\"\n              >\n                {batchStockMovementMutation.isPending ? \"Processing...\" : \"Complete Audit\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":35767},"client/src/pages/SupplierManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport type { Supplier } from \"@shared/schema\";\nimport { insertSupplierSchema } from \"@shared/schema\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/api\";\nimport { Eye, Edit, Package, CreditCard } from \"lucide-react\";\n\nexport default function SupplierManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterStatus, setFilterStatus] = useState(\"all\");\n  const [open, setOpen] = useState(false);\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [paymentDialogOpen, setPaymentDialogOpen] = useState(false);\n  const [selectedSupplier, setSelectedSupplier] = useState<Supplier | null>(null);\n\n  // Edit form\n  const editForm = useForm({\n    resolver: zodResolver(insertSupplierSchema),\n    defaultValues: {\n      name: \"\",\n      contactPerson: \"\",\n      contactPhone: \"\",\n      contactEmail: \"\",\n      address: \"\",\n      gstNumber: \"\",\n      paymentTerms: \"Net 30 Days\",\n      outstandingAmount: \"0\",\n    },\n  });\n\n  // Payment form\n  const paymentForm = useForm({\n    resolver: zodResolver(z.object({\n      amount: z.string().min(1, \"Amount is required\"),\n      paymentMethod: z.enum(['cash', 'card']),\n      referenceNumber: z.string().optional(),\n      notes: z.string().optional(),\n    })),\n    defaultValues: {\n      amount: \"\",\n      paymentMethod: \"cash\" as const,\n      referenceNumber: \"\",\n      notes: \"\",\n    },\n  });\n\n  const form = useForm({\n    resolver: zodResolver(insertSupplierSchema),\n    defaultValues: {\n      name: \"\",\n      contactPerson: \"\",\n      contactPhone: \"\",\n      contactEmail: \"\",\n      address: \"\",\n      gstNumber: \"\",\n      paymentTerms: \"Net 30 Days\",\n      outstandingAmount: \"0\",\n    },\n  });\n\n  const updateSupplierMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const response = await apiRequest(\"PUT\", `/api/suppliers/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Supplier updated\",\n        description: \"Supplier information has been updated successfully\",\n      });\n      setEditDialogOpen(false);\n      editForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update supplier\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const recordPaymentMutation = useMutation({\n    mutationFn: async (paymentData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/payments\", paymentData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payment recorded\",\n        description: \"Payment has been recorded successfully\",\n      });\n      setPaymentDialogOpen(false);\n      paymentForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createSupplierMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/suppliers\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Supplier created\",\n        description: \"New supplier has been added successfully\",\n      });\n      setOpen(false);\n      form.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create supplier\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: any) => {\n    createSupplierMutation.mutate(data);\n  };\n\n  const handleViewSupplier = (supplier: Supplier) => {\n    setSelectedSupplier(supplier);\n    setViewDialogOpen(true);\n  };\n\n  const handleEditSupplier = (supplier: Supplier) => {\n    setSelectedSupplier(supplier);\n    editForm.reset({\n      name: supplier.name,\n      contactPerson: supplier.contactPerson || \"\",\n      contactPhone: supplier.contactPhone || \"\",\n      contactEmail: supplier.contactEmail || \"\",\n      address: supplier.address || \"\",\n      gstNumber: supplier.gstNumber || \"\",\n      paymentTerms: supplier.paymentTerms || \"Net 30 Days\",\n      outstandingAmount: supplier.outstandingAmount || \"0\",\n    });\n    setEditDialogOpen(true);\n  };\n\n  const handlePaymentSupplier = (supplier: Supplier) => {\n    setSelectedSupplier(supplier);\n    paymentForm.reset({\n      amount: \"\",\n      paymentMethod: \"cash\" as const,\n      referenceNumber: \"\",\n      notes: \"\",\n    });\n    setPaymentDialogOpen(true);\n  };\n\n  const onEditSubmit = (data: any) => {\n    if (!selectedSupplier) return;\n    updateSupplierMutation.mutate({ id: selectedSupplier.id, data });\n  };\n\n  const onPaymentSubmit = (data: any) => {\n    if (!selectedSupplier || !user) return;\n    \n    if (!user.id) {\n      toast({\n        title: \"Error\",\n        description: \"User authentication required to record payment\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const paymentData = {\n      supplierId: selectedSupplier.id,\n      amount: data.amount,\n      paymentMethod: data.paymentMethod,\n      referenceNumber: data.referenceNumber,\n      notes: data.notes,\n      type: \"payable\",\n      stationId: user.stationId || \"default-station\",\n      userId: user.id,\n      currencyCode: \"PKR\",\n    };\n    recordPaymentMutation.mutate(paymentData);\n  };\n\n  const { data: suppliers = [], isLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const filteredSuppliers = suppliers.filter((supplier: Supplier) => {\n    const matchesSearch = supplier.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         supplier.contactPerson?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = filterStatus === \"all\" || \n                         (filterStatus === \"active\" && supplier.isActive) ||\n                         (filterStatus === \"inactive\" && !supplier.isActive);\n    return matchesSearch && matchesStatus;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"h-4 bg-muted rounded w-1/2 mb-8\"></div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const activeSuppliers = suppliers.filter((s: Supplier) => s.isActive).length;\n  const totalOutstanding = suppliers.reduce((sum: number, s: Supplier) => sum + parseFloat(s.outstandingAmount || '0'), 0);\n  const suppliersWithOutstanding = suppliers.filter((s: Supplier) => parseFloat(s.outstandingAmount || '0') > 0).length;\n\n  return (\n    <div className=\"space-y-6 fade-in\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-2xl font-semibold text-card-foreground\">Supplier Management</h3>\n          <p className=\"text-muted-foreground\">Manage vendor relationships and payment terms</p>\n        </div>\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-supplier\">\n              + Add New Supplier\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Add New Supplier</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Supplier Name *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter supplier name\" {...field} data-testid=\"input-supplier-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"contactPerson\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Contact Person</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter contact person name\" {...field} data-testid=\"input-contact-person\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"contactPhone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter phone number\" {...field} data-testid=\"input-supplier-phone\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"contactEmail\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email Address</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"Enter email address\" {...field} data-testid=\"input-supplier-email\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter address\" {...field} data-testid=\"input-supplier-address\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"gstNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>GST Number</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter GST number\" {...field} data-testid=\"input-supplier-gst\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"paymentTerms\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Terms</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-payment-terms\">\n                              <SelectValue placeholder=\"Select payment terms\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Net 15 Days\">Net 15 Days</SelectItem>\n                            <SelectItem value=\"Net 30 Days\">Net 30 Days</SelectItem>\n                            <SelectItem value=\"Net 45 Days\">Net 45 Days</SelectItem>\n                            <SelectItem value=\"Net 60 Days\">Net 60 Days</SelectItem>\n                            <SelectItem value=\"Cash on Delivery\">Cash on Delivery</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createSupplierMutation.isPending} data-testid=\"button-submit-supplier\">\n                    {createSupplierMutation.isPending ? \"Creating...\" : \"Create Supplier\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Supplier Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-primary\" data-testid=\"total-suppliers\">\n              {suppliers.length}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Suppliers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"active-suppliers\">\n              {activeSuppliers}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Active Suppliers</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"total-outstanding-suppliers\">\n              {formatCurrency(totalOutstanding)}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Total Outstanding</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"suppliers-with-outstanding\">\n              {suppliersWithOutstanding}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Pending Payments</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Supplier List */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Supplier Directory</CardTitle>\n            <div className=\"flex items-center space-x-2\">\n              <Input\n                type=\"text\"\n                placeholder=\"Search suppliers...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-48\"\n                data-testid=\"input-search-suppliers\"\n              />\n              <Select value={filterStatus} onValueChange={setFilterStatus}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-filter-status\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Suppliers</SelectItem>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-muted\">\n                <tr>\n                  <th className=\"text-left p-3 font-medium\">Supplier</th>\n                  <th className=\"text-left p-3 font-medium\">Contact Person</th>\n                  <th className=\"text-left p-3 font-medium\">Payment Terms</th>\n                  <th className=\"text-right p-3 font-medium\">Outstanding</th>\n                  <th className=\"text-center p-3 font-medium\">Last Order</th>\n                  <th className=\"text-center p-3 font-medium\">Status</th>\n                  <th className=\"text-center p-3 font-medium\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredSuppliers.length > 0 ? filteredSuppliers.map((supplier: Supplier, index: number) => {\n                  const outstanding = parseFloat(supplier.outstandingAmount || '0');\n                  \n                  return (\n                    <tr key={supplier.id} className=\"border-b border-border hover:bg-muted/50\">\n                      <td className=\"p-3\">\n                        <div className=\"font-medium text-card-foreground\" data-testid={`supplier-name-${index}`}>\n                          {supplier.name}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          GST: {supplier.gstNumber || 'N/A'}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {supplier.contactEmail || 'N/A'}\n                        </div>\n                      </td>\n                      <td className=\"p-3\">\n                        <div className=\"font-medium\">{supplier.contactPerson || 'N/A'}</div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {supplier.contactPhone || 'N/A'}\n                        </div>\n                      </td>\n                      <td className=\"p-3\">{supplier.paymentTerms || 'Net 30 Days'}</td>\n                      <td className=\"p-3 text-right\">\n                        {outstanding > 0 ? (\n                          <span className=\"font-semibold text-red-600\" data-testid={`outstanding-supplier-${index}`}>\n                            {formatCurrency(outstanding)}\n                          </span>\n                        ) : (\n                          <span className=\"text-green-600\">{formatCurrency(0)}</span>\n                        )}\n                      </td>\n                      <td className=\"p-3 text-center text-sm\">\n                        {supplier.createdAt ? new Date(supplier.createdAt).toLocaleDateString('en-GB') : 'N/A'}\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <Badge\n                          variant={supplier.isActive ? 'default' : 'secondary'}\n                          className={supplier.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}\n                          data-testid={`supplier-status-${index}`}\n                        >\n                          {supplier.isActive ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </td>\n                      <td className=\"p-3 text-center\">\n                        <div className=\"flex items-center justify-center space-x-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleViewSupplier(supplier)}\n                            className=\"text-blue-600 hover:text-blue-800 p-1\"\n                            data-testid={`button-view-supplier-${index}`}\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEditSupplier(supplier)}\n                            className=\"text-green-600 hover:text-green-800 p-1\"\n                            data-testid={`button-edit-supplier-${index}`}\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => toast({ title: \"Feature Coming Soon\", description: \"Purchase orders functionality will be available soon.\" })}\n                            className=\"text-purple-600 hover:text-purple-800 p-1\"\n                            data-testid={`button-orders-${index}`}\n                          >\n                            <Package className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handlePaymentSupplier(supplier)}\n                            className=\"text-orange-600 hover:text-orange-800 p-1\"\n                            data-testid={`button-payment-${index}`}\n                          >\n                            <CreditCard className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                }) : (\n                  <tr>\n                    <td colSpan={7} className=\"p-8 text-center text-muted-foreground\">\n                      No suppliers found for the selected criteria\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* View Supplier Dialog */}\n      <Dialog open={viewDialogOpen} onOpenChange={setViewDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Supplier Details</DialogTitle>\n          </DialogHeader>\n          {selectedSupplier && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">Name</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.name}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Contact Person</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.contactPerson || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Phone</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.contactPhone || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Email</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.contactEmail || 'N/A'}</p>\n                </div>\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium\">Address</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.address || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">GST Number</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.gstNumber || 'N/A'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Payment Terms</label>\n                  <p className=\"text-sm text-muted-foreground\">{selectedSupplier.paymentTerms || 'Net 30 Days'}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Outstanding Amount</label>\n                  <p className=\"text-sm text-muted-foreground\">{formatCurrency(parseFloat(selectedSupplier.outstandingAmount || '0'))}</p>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Status</label>\n                  <Badge variant={selectedSupplier.isActive ? 'default' : 'secondary'}>\n                    {selectedSupplier.isActive ? 'Active' : 'Inactive'}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Supplier Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Supplier</DialogTitle>\n          </DialogHeader>\n          <Form {...editForm}>\n            <form onSubmit={editForm.handleSubmit(onEditSubmit)} className=\"space-y-4\">\n              <FormField\n                control={editForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Supplier Name *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter supplier name\" {...field} data-testid=\"input-edit-supplier-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editForm.control}\n                name=\"contactPerson\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Contact Person</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter contact person name\" {...field} data-testid=\"input-edit-contact-person\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"contactPhone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter phone number\" {...field} data-testid=\"input-edit-supplier-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"contactEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email Address</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Enter email address\" {...field} data-testid=\"input-edit-supplier-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <FormField\n                control={editForm.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Address</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter address\" {...field} data-testid=\"input-edit-supplier-address\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"gstNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>GST Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter GST number\" {...field} data-testid=\"input-edit-supplier-gst\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"paymentTerms\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Payment Terms</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-payment-terms\">\n                            <SelectValue placeholder=\"Select payment terms\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Net 15 Days\">Net 15 Days</SelectItem>\n                          <SelectItem value=\"Net 30 Days\">Net 30 Days</SelectItem>\n                          <SelectItem value=\"Net 45 Days\">Net 45 Days</SelectItem>\n                          <SelectItem value=\"Net 60 Days\">Net 60 Days</SelectItem>\n                          <SelectItem value=\"Cash on Delivery\">Cash on Delivery</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <div className=\"flex justify-end space-x-2 pt-4\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setEditDialogOpen(false)} data-testid=\"button-cancel-edit-supplier\">\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={updateSupplierMutation.isPending} data-testid=\"button-update-supplier\">\n                  {updateSupplierMutation.isPending ? \"Updating...\" : \"Update Supplier\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Payment Dialog */}\n      <Dialog open={paymentDialogOpen} onOpenChange={setPaymentDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Record Payment</DialogTitle>\n            {selectedSupplier && (\n              <p className=\"text-sm text-muted-foreground\">\n                Recording payment to {selectedSupplier.name} (Outstanding: {formatCurrency(parseFloat(selectedSupplier.outstandingAmount || '0'))})\n              </p>\n            )}\n          </DialogHeader>\n          <Form {...paymentForm}>\n            <form onSubmit={paymentForm.handleSubmit(onPaymentSubmit)} className=\"space-y-4\">\n              <FormField\n                control={paymentForm.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Payment Amount *</FormLabel>\n                    <FormControl>\n                      <Input type=\"number\" step=\"0.01\" placeholder=\"Enter payment amount\" {...field} data-testid=\"input-supplier-payment-amount\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"paymentMethod\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Payment Method *</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-supplier-payment-method\">\n                          <SelectValue placeholder=\"Select payment method\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"cash\">Cash</SelectItem>\n                        <SelectItem value=\"card\">Card</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"referenceNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Reference Number</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter reference number (optional)\" {...field} data-testid=\"input-supplier-reference-number\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={paymentForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Add any notes (optional)\" {...field} data-testid=\"input-supplier-payment-notes\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"flex justify-end space-x-2 pt-4\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setPaymentDialogOpen(false)} data-testid=\"button-cancel-supplier-payment\">\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={recordPaymentMutation.isPending} data-testid=\"button-record-supplier-payment\">\n                  {recordPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":34692},"client/src/pages/TankMonitoring.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCurrency } from \"@/contexts/CurrencyContext\";\nimport { formatAmount } from \"@/lib/currency\";\nimport { \n  Gauge, \n  AlertTriangle, \n  AlertCircle, \n  CheckCircle,\n  Wrench,\n  Droplets,\n  Calendar,\n  TrendingDown,\n  TrendingUp,\n  Plus\n} from \"lucide-react\";\nimport type { Tank, Product, StockMovement } from \"@shared/schema\";\n\ninterface TankWithProduct extends Tank {\n  product: Product;\n}\n\nexport default function TankMonitoring() {\n  const { user } = useAuth();\n  const { formatCurrency } = useCurrency();\n  const [selectedTank, setSelectedTank] = useState<string | null>(null);\n  const [addTankDialogOpen, setAddTankDialogOpen] = useState(false);\n  const [maintenanceDialogOpen, setMaintenanceDialogOpen] = useState(false);\n  const [selectedTankForMaintenance, setSelectedTankForMaintenance] = useState<TankWithProduct | null>(null);\n\n  const handleAddTank = () => {\n    setAddTankDialogOpen(true);\n  };\n\n  const handleMaintenance = (tank: TankWithProduct) => {\n    setSelectedTankForMaintenance(tank);\n    setMaintenanceDialogOpen(true);\n  };\n\n  const { data: tanks = [], isLoading } = useQuery<TankWithProduct[]>({\n    queryKey: [`/api/tanks/${user?.stationId}`],\n    enabled: !!user?.stationId,\n    refetchInterval: 10000, // Real-time updates every 10 seconds\n  });\n\n  const { data: stockMovements = [] } = useQuery<StockMovement[]>({\n    queryKey: [`/api/stock-movements/${selectedTank}`],\n    enabled: !!selectedTank,\n  });\n\n  const getStockPercentage = (tank: Tank): number => {\n    const current = parseFloat(tank.currentStock || '0');\n    const capacity = parseFloat(tank.capacity || '1');\n    return Math.round((current / capacity) * 100);\n  };\n\n  const getStockStatus = (tank: Tank): 'critical' | 'low' | 'normal' => {\n    const percentage = getStockPercentage(tank);\n    const minLevel = parseFloat(tank.minimumLevel || '0');\n    const capacity = parseFloat(tank.capacity || '1');\n    const minPercentage = (minLevel / capacity) * 100;\n\n    if (percentage <= minPercentage * 0.5) return 'critical';\n    if (percentage <= minPercentage) return 'low';\n    return 'normal';\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'critical':\n        return <AlertCircle className=\"w-5 h-5 text-red-500\" />;\n      case 'low':\n        return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n      case 'maintenance':\n        return <Wrench className=\"w-5 h-5 text-gray-500\" />;\n      default:\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'critical':\n        return 'destructive';\n      case 'low':\n        return 'secondary';\n      case 'maintenance':\n        return 'outline';\n      default:\n        return 'default';\n    }\n  };\n\n  const getProgressColor = (percentage: number, stockStatus: string) => {\n    if (stockStatus === 'critical') return 'bg-red-500';\n    if (stockStatus === 'low') return 'bg-yellow-500';\n    return 'bg-green-500';\n  };\n\n  const alertTanks = tanks.filter(tank => {\n    const stockStatus = getStockStatus(tank);\n    return stockStatus === 'critical' || stockStatus === 'low' || tank.status === 'maintenance';\n  });\n\n  const totalCapacity = tanks.reduce((sum, tank) => sum + parseFloat(tank.capacity || '0'), 0);\n  const totalStock = tanks.reduce((sum, tank) => sum + parseFloat(tank.currentStock || '0'), 0);\n  const totalStockPercentage = totalCapacity > 0 ? Math.round((totalStock / totalCapacity) * 100) : 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-muted rounded w-1/3 mb-4\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n            {[1, 2, 3, 4].map((i) => (\n              <div key={i} className=\"h-32 bg-muted rounded\"></div>\n            ))}\n          </div>\n          <div className=\"h-96 bg-muted rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\" data-testid=\"page-title\">Tank Monitoring</h1>\n          <p className=\"text-muted-foreground\">Monitor fuel tank levels and inventory status</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Gauge className=\"w-5 h-5\" />\n          <span className=\"text-sm font-medium\">Live Monitoring</span>\n        </div>\n      </div>\n\n      {/* Alerts Section */}\n      {alertTanks.length > 0 && (\n        <Alert className=\"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20\">\n          <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\n          <AlertDescription>\n            <span className=\"font-semibold text-yellow-800 dark:text-yellow-200\">\n              {alertTanks.length} tank{alertTanks.length > 1 ? 's' : ''} require{alertTanks.length === 1 ? 's' : ''} attention:\n            </span>\n            <span className=\"text-yellow-700 dark:text-yellow-300 ml-2\" data-testid=\"alert-tanks\">\n              {alertTanks.map(tank => tank.name).join(', ')}\n            </span>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Tanks</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"total-tanks\">{tanks.length}</p>\n              </div>\n              <Droplets className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total Capacity</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"total-capacity\">\n                  {totalCapacity.toLocaleString()}L\n                </p>\n              </div>\n              <Gauge className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Current Stock</p>\n                <p className=\"text-3xl font-bold\" data-testid=\"total-stock\">\n                  {totalStock.toLocaleString()}L\n                </p>\n                <p className=\"text-sm text-muted-foreground\">({totalStockPercentage}% full)</p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-purple-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Alerts</p>\n                <p className=\"text-3xl font-bold text-red-500\" data-testid=\"alert-count\">{alertTanks.length}</p>\n                <p className=\"text-sm text-muted-foreground\">Require attention</p>\n              </div>\n              <AlertTriangle className=\"w-8 h-8 text-red-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tank Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6\">\n        {tanks.map((tank) => {\n          const percentage = getStockPercentage(tank);\n          const stockStatus = getStockStatus(tank);\n          const isLowStock = stockStatus === 'critical' || stockStatus === 'low';\n          \n          return (\n            <Card \n              key={tank.id} \n              className={`relative transition-all duration-200 hover:shadow-lg ${\n                isLowStock ? 'border-l-4 border-l-red-500' : \n                tank.status === 'maintenance' ? 'border-l-4 border-l-yellow-500' : \n                'border-l-4 border-l-green-500'\n              }`}\n              data-testid={`tank-card-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}\n            >\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\" data-testid={`tank-name-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                    {tank.name}\n                  </CardTitle>\n                  <div className=\"flex items-center gap-2\">\n                    {getStatusIcon(tank.status || 'normal')}\n                    <Badge variant={getStatusColor(stockStatus)} data-testid={`tank-status-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {stockStatus.toUpperCase()}\n                    </Badge>\n                  </div>\n                </div>\n                <p className=\"text-sm text-muted-foreground\" data-testid={`tank-product-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                  {tank.product?.name || 'Unknown Product'}\n                </p>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Stock Level Progress */}\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Stock Level</span>\n                    <span className=\"font-medium\" data-testid={`tank-percentage-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {percentage}%\n                    </span>\n                  </div>\n                  <Progress \n                    value={percentage} \n                    className={`h-2 ${getProgressColor(percentage, stockStatus)}`}\n                    data-testid={`tank-progress-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  />\n                  <div className=\"flex justify-between text-xs text-muted-foreground\">\n                    <span data-testid={`tank-current-stock-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {parseFloat(tank.currentStock || '0').toLocaleString()}L\n                    </span>\n                    <span data-testid={`tank-capacity-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {parseFloat(tank.capacity || '0').toLocaleString()}L\n                    </span>\n                  </div>\n                </div>\n\n                {/* Stock Metrics */}\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Min Level</p>\n                    <p className=\"font-medium\" data-testid={`tank-min-level-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {parseFloat(tank.minimumLevel || '0').toLocaleString()}L\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Last Refill</p>\n                    <p className=\"font-medium\" data-testid={`tank-last-refill-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {tank.lastRefillDate ? \n                        new Date(tank.lastRefillDate).toLocaleDateString() : \n                        'Never'\n                      }\n                    </p>\n                  </div>\n                </div>\n\n                {/* Stock Value */}\n                <div className=\"pt-2 border-t\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">Stock Value</span>\n                    <span className=\"font-semibold\" data-testid={`tank-stock-value-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      {formatAmount(\n                        parseFloat(tank.currentStock ?? '0') * parseFloat(tank.product?.currentPrice ?? '0')\n                      )}\n                    </span>\n                  </div>\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex gap-2 pt-2\">\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"flex-1\"\n                    onClick={() => setSelectedTank(selectedTank === tank.id ? null : tank.id)}\n                    data-testid={`button-view-details-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    {selectedTank === tank.id ? 'Hide' : 'View'} History\n                  </Button>\n                  {tank.status === 'maintenance' && (\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => handleMaintenance(tank)}\n                      data-testid={`button-maintenance-${tank.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                    >\n                      <Wrench className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                </div>\n\n                {/* Stock Movements (if selected) */}\n                {selectedTank === tank.id && (\n                  <div className=\"pt-4 border-t space-y-2\">\n                    <h4 className=\"font-medium text-sm flex items-center\">\n                      <TrendingDown className=\"w-4 h-4 mr-2\" />\n                      Recent Activity\n                    </h4>\n                    {stockMovements.length > 0 ? (\n                      <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                        {stockMovements.slice(0, 5).map((movement, index) => (\n                          <div \n                            key={movement.id || index} \n                            className=\"flex justify-between items-center text-xs p-2 rounded bg-muted/50\"\n                            data-testid={`stock-movement-${index}`}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              <span className={`w-2 h-2 rounded-full ${\n                                movement.movementType === 'in' ? 'bg-green-500' : 'bg-red-500'\n                              }`}></span>\n                              <span>{movement.movementType === 'in' ? 'Refill' : 'Sale'}</span>\n                            </div>\n                            <div className=\"text-right\">\n                              <div className=\"font-medium\">\n                                {movement.movementType === 'in' ? '+' : '-'}{parseFloat(movement.quantity || '0').toFixed(1)}L\n                              </div>\n                              <div className=\"text-muted-foreground\">\n                                {new Date(movement.movementDate || new Date()).toLocaleDateString()}\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-xs text-muted-foreground\">No recent activity</p>\n                    )}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {tanks.length === 0 && (\n        <Card>\n          <CardContent className=\"text-center py-12\">\n            <Droplets className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No Tanks Found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              No fuel tanks are configured for this station.\n            </p>\n            <Button onClick={handleAddTank} data-testid=\"button-add-tank\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Tank\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Add Tank Dialog */}\n      <Dialog open={addTankDialogOpen} onOpenChange={setAddTankDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Add New Tank</DialogTitle>\n          </DialogHeader>\n          <div className=\"p-4\">\n            <p className=\"text-muted-foreground\">Tank creation functionality will be implemented soon.</p>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Maintenance Dialog */}\n      <Dialog open={maintenanceDialogOpen} onOpenChange={setMaintenanceDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Tank Maintenance</DialogTitle>\n          </DialogHeader>\n          {selectedTankForMaintenance && (\n            <div className=\"p-4\">\n              <p className=\"mb-4\">Tank: {selectedTankForMaintenance.name}</p>\n              <p className=\"text-muted-foreground\">Maintenance scheduling functionality will be implemented soon.</p>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":17591},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/auth/LoginForm.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { isFirebaseConfigured } from \"@/lib/firebase\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function LoginForm() {\n  const [username, setUsername] = useState(\"admin\");\n  const [password, setPassword] = useState(\"admin123\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { login, loginWithGoogle } = useAuth();\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      await login(username, password);\n      toast({\n        title: \"Login successful\",\n        description: \"Welcome to FuelFlow system\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Login failed\",\n        description: \"Invalid credentials. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    setIsLoading(true);\n    try {\n      await loginWithGoogle();\n      // User will be redirected and authentication handled automatically\n    } catch (error) {\n      toast({\n        title: \"Google sign-in failed\",\n        description: \"Please try again or use username/password.\",\n        variant: \"destructive\",\n      });\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n      <Card className=\"max-w-md w-full mx-4 border shadow-xl\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center mb-6\">\n            <div className=\"w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4\">\n              <span className=\"text-2xl text-primary-foreground\">â›½</span>\n            </div>\n            <h2 className=\"text-2xl font-bold text-card-foreground\" data-testid=\"login-title\">FuelFlow Login</h2>\n            <p className=\"text-muted-foreground\">Petrol Pump Accounting System</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"username\" className=\"block text-sm font-medium text-card-foreground mb-2\">\n                Username\n              </Label>\n              <Input\n                id=\"username\"\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"Enter username\"\n                className=\"w-full\"\n                data-testid=\"input-username\"\n                required\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"password\" className=\"block text-sm font-medium text-card-foreground mb-2\">\n                Password\n              </Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Enter password\"\n                className=\"w-full\"\n                data-testid=\"input-password\"\n                required\n              />\n            </div>\n\n\n            <Button \n              type=\"submit\" \n              className=\"w-full\" \n              disabled={isLoading}\n              data-testid=\"button-login\"\n            >\n              {isLoading ? \"Logging in...\" : \"Login to System\"}\n            </Button>\n          </form>\n          \n          <div className=\"mt-4\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-background px-2 text-muted-foreground\">\n                  Or continue with\n                </span>\n              </div>\n            </div>\n            \n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full mt-4\"\n              onClick={handleGoogleSignIn}\n              disabled={isLoading || !isFirebaseConfigured}\n              data-testid=\"google-signin-button\"\n            >\n              <svg className=\"mr-2 h-4 w-4\" viewBox=\"0 0 24 24\">\n                <path\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                  fill=\"#4285F4\"\n                />\n                <path\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                  fill=\"#34A853\"\n                />\n                <path\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                  fill=\"#FBBC05\"\n                />\n                <path\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                  fill=\"#EA4335\"\n                />\n              </svg>\n              Sign in with Google\n            </Button>\n          </div>\n\n          <div className=\"mt-6 p-3 bg-muted rounded-md text-xs text-muted-foreground\">\n            <p className=\"font-medium mb-1\">Demo Credentials:</p>\n            <p>Admin: admin/admin123 | Manager: manager/manager123 | Cashier: cashier/cashier123</p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5788},"client/src/components/layout/AuthGuard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport LoginForm from \"@/components/auth/LoginForm\";\nimport Sidebar from \"@/components/layout/Sidebar\";\nimport Header from \"@/components/layout/Header\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n}\n\nexport default function AuthGuard({ children }: AuthGuardProps) {\n  const { user, isAuthenticated } = useAuth();\n\n  if (!isAuthenticated) {\n    return <LoginForm />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Sidebar />\n      <div className=\"ml-64 min-h-screen\">\n        <Header />\n        <main className=\"p-6\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/layout/Header.tsx":{"content":"import { useLocation } from \"wouter\";\n\nconst pageTitles: Record<string, string> = {\n  \"/\": \"Dashboard\",\n  \"/pos\": \"Point of Sale\",\n  \"/sales-history\": \"Sales History\",\n  \"/customers\": \"Customer Account Management\",\n  \"/stock\": \"Stock & Inventory Management\",\n  \"/purchase-orders\": \"Purchase Orders\",\n  \"/accounts-receivable\": \"Accounts Receivable\",\n  \"/accounts-payable\": \"Accounts Payable\",\n  \"/cash-reconciliation\": \"Cash Reconciliation\",\n  \"/expenses\": \"Expense Management\",\n  \"/suppliers\": \"Supplier Management\",\n  \"/pricing\": \"Price Management\",\n  \"/financial-reports\": \"Financial Reports\",\n};\n\nexport default function Header() {\n  const [location] = useLocation();\n  const currentDate = new Date().toLocaleDateString('en-IN', { \n    day: 'numeric', \n    month: 'short', \n    year: 'numeric' \n  });\n\n  return (\n    <header className=\"bg-card shadow-sm border-b border-border px-6 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-card-foreground\" data-testid=\"page-title\">\n              {pageTitles[location] || \"Dashboard\"}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">Comprehensive Petrol Pump Management</p>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-6\">\n          <div className=\"text-right\">\n            <div className=\"text-xs text-muted-foreground\">Current Date</div>\n            <div className=\"font-medium text-card-foreground\" data-testid=\"current-date\">{currentDate}</div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-xs text-muted-foreground\">Shift</div>\n            <div className=\"font-medium text-card-foreground\" data-testid=\"current-shift\">Day Shift</div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-xs text-muted-foreground\">Till Status</div>\n            <div className=\"font-medium text-green-600\" data-testid=\"till-status\">Open</div>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":2122},"client/src/components/layout/Sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nconst navigationItems = [\n  {\n    label: \"Overview\",\n    items: [\n      { name: \"Dashboard\", path: \"/\", icon: \"ðŸ“Š\" },\n    ]\n  },\n  {\n    label: \"Sales & Transactions\",\n    items: [\n      { name: \"Point of Sale\", path: \"/pos\", icon: \"ðŸ›’\" },\n      { name: \"Sales History & Receipts\", path: \"/sales-history\", icon: \"ðŸ“‹\" },\n    ]\n  },\n  {\n    label: \"Inventory\",\n    items: [\n      { name: \"Stock Management\", path: \"/stock\", icon: \"ðŸ›¢ï¸\" },\n      { name: \"Tank Monitoring\", path: \"/tanks\", icon: \"â›½\" },\n      { name: \"Purchase Orders\", path: \"/purchase-orders\", icon: \"ðŸ“¦\" },\n    ]\n  },\n  {\n    label: \"Accounting\",\n    items: [\n      { name: \"Accounts Receivable\", path: \"/accounts-receivable\", icon: \"ðŸ’°\" },\n      { name: \"Accounts Payable\", path: \"/accounts-payable\", icon: \"ðŸ’¸\" },\n      { name: \"Cash Reconciliation\", path: \"/cash-reconciliation\", icon: \"ðŸ”„\" },\n      { name: \"Expense Management\", path: \"/expenses\", icon: \"ðŸ’³\" },\n    ]\n  },\n  {\n    label: \"Relationships\",\n    items: [\n      { name: \"Customer Accounts\", path: \"/customers\", icon: \"ðŸ‘¥\" },\n      { name: \"Supplier Management\", path: \"/suppliers\", icon: \"ðŸ­\" },\n      { name: \"Price Management\", path: \"/pricing\", icon: \"ðŸ·ï¸\" },\n    ]\n  },\n  {\n    label: \"Financial Reports\",\n    items: [\n      { name: \"Financial Statements\", path: \"/financial-reports\", icon: \"ðŸ“Š\" },\n      { name: \"Daily Reports\", path: \"/daily-reports\", icon: \"ðŸ“…\" },\n      { name: \"Aging Reports\", path: \"/aging-reports\", icon: \"â°\" },\n    ]\n  },\n  {\n    label: \"System\",\n    items: [\n      { name: \"Settings\", path: \"/settings\", icon: \"âš™ï¸\" },\n    ]\n  }\n];\n\nexport default function Sidebar() {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n\n  return (\n    <div className=\"sidebar-transition fixed left-0 top-0 h-full w-64 bg-card border-r border-border z-40\">\n      <div className=\"p-6 border-b border-border\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-primary-foreground font-bold text-lg\">\n            â›½\n          </div>\n          <div>\n            <h1 className=\"text-lg font-bold text-card-foreground\" data-testid=\"app-title\">FuelFlow</h1>\n            <p className=\"text-xs text-muted-foreground\" data-testid=\"current-station\">Main Station</p>\n          </div>\n        </div>\n      </div>\n      \n      <nav className=\"mt-4 h-[calc(100vh-180px)] overflow-y-auto\">\n        {navigationItems.map((section) => (\n          <div key={section.label}>\n            <div className=\"px-4 mb-3 mt-6\">\n              <div className=\"text-xs text-muted-foreground uppercase tracking-wider font-medium\">\n                {section.label}\n              </div>\n            </div>\n            {section.items.map((item) => (\n              <Link\n                key={item.path}\n                href={item.path}\n                className={cn(\n                  \"flex items-center px-4 py-2.5 text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md mx-2 mb-1 transition-colors\",\n                  location === item.path && \"bg-accent text-accent-foreground\"\n                )}\n                data-testid={`nav-link-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n              >\n                <span className=\"mr-3 text-base\">{item.icon}</span>\n                {item.name}\n              </Link>\n            ))}\n          </div>\n        ))}\n      </nav>\n      \n      <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-border bg-card\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-10 h-10 bg-primary rounded-full flex items-center justify-center text-sm font-bold text-primary-foreground\">\n            <span data-testid=\"user-initials\">{user?.fullName?.charAt(0) || \"U\"}</span>\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"text-sm font-medium text-card-foreground truncate\" data-testid=\"current-user\">\n              {user?.fullName || \"User\"}\n            </div>\n            <div className=\"text-xs text-muted-foreground\" data-testid=\"current-role\">\n              {user?.role || \"User\"}\n            </div>\n          </div>\n          <button \n            onClick={logout} \n            className=\"text-muted-foreground hover:text-destructive transition-colors p-1\"\n            data-testid=\"button-logout\"\n          >\n            <span className=\"text-base\">ðŸšª</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4668},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/combobox.tsx":{"content":"import { useState } from \"react\"\nimport { Check, ChevronsUpDown, Search } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\nexport interface ComboboxOption {\n  value: string\n  label: string\n  searchTerms?: string[]\n}\n\ninterface ComboboxProps {\n  options: ComboboxOption[]\n  value?: string\n  onValueChange: (value: string) => void\n  placeholder?: string\n  searchPlaceholder?: string\n  emptyMessage?: string\n  className?: string\n  disabled?: boolean\n  \"data-testid\"?: string\n}\n\nexport function Combobox({\n  options,\n  value,\n  onValueChange,\n  placeholder = \"Select option...\",\n  searchPlaceholder = \"Search...\",\n  emptyMessage = \"No option found.\",\n  className,\n  disabled,\n  \"data-testid\": testId,\n}: ComboboxProps) {\n  const [open, setOpen] = useState(false)\n  const [searchValue, setSearchValue] = useState(\"\")\n\n  const selectedOption = options.find((option) => option.value === value)\n\n  const filteredOptions = options.filter((option) => {\n    const searchTerm = searchValue.toLowerCase()\n    return (\n      option.label.toLowerCase().includes(searchTerm) ||\n      option.value.toLowerCase().includes(searchTerm) ||\n      (option.searchTerms && option.searchTerms.some(term => \n        term.toLowerCase().includes(searchTerm)\n      ))\n    )\n  })\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\"w-full justify-between\", className)}\n          disabled={disabled}\n          data-testid={testId}\n        >\n          {selectedOption ? selectedOption.label : placeholder}\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-full p-0\" align=\"start\">\n        <Command>\n          <div className=\"flex items-center border-b px-3\">\n            <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n            <CommandInput\n              placeholder={searchPlaceholder}\n              value={searchValue}\n              onValueChange={setSearchValue}\n              className=\"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\"\n            />\n          </div>\n          <CommandList>\n            <CommandEmpty>{emptyMessage}</CommandEmpty>\n            <CommandGroup>\n              {filteredOptions.map((option) => (\n                <CommandItem\n                  key={option.value}\n                  value={option.value}\n                  onSelect={(currentValue) => {\n                    onValueChange(currentValue === value ? \"\" : currentValue)\n                    setOpen(false)\n                    setSearchValue(\"\")\n                  }}\n                  className=\"cursor-pointer\"\n                >\n                  <Check\n                    className={cn(\n                      \"mr-2 h-4 w-4\",\n                      value === option.value ? \"opacity-100\" : \"opacity-0\"\n                    )}\n                  />\n                  {option.label}\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  )\n}","size_bytes":3554},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/seed.ts":{"content":"import { storage } from \"./storage\";\nimport bcrypt from \"bcrypt\";\nimport { db } from \"./db\";\nimport { users, stations, products, tanks, customers } from \"@shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\nexport async function seedInitialData() {\n  try {\n    // Check if database already has data\n    const [userCount] = await db.select({ count: sql<number>`count(*)` }).from(users);\n    if (userCount.count > 0) {\n      console.log(\"Database already seeded, skipping initial data creation\");\n      console.log(\"Adding comprehensive sample data for testing...\");\n      await seedSampleData(); // Add sample data even if users exist\n      return;\n    }\n\n    console.log(\"Seeding initial data...\");\n\n    // 1. Create a station\n    const station = await storage.createStation({\n      name: \"FuelFlow Station 1\",\n      address: \"123 Main Street, Demo City\",\n      gstNumber: \"GST123456789\",\n      licenseNumber: \"LIC123456\",\n      contactPhone: \"+1-234-567-8900\",\n      contactEmail: \"station@fuelflow.com\",\n      defaultCurrency: \"PKR\",\n      isActive: true\n    });\n\n    console.log(\"Created station:\", station.name);\n\n    // 2. Create products (fuel types)\n    const petrolProduct = await storage.createProduct({\n      name: \"Petrol\",\n      category: \"fuel\",\n      unit: \"litre\",\n      currentPrice: \"290.00\",\n      density: \"0.740\",\n      hsnCode: \"27101990\",\n      taxRate: \"0.00\",\n      isActive: true\n    });\n\n    const dieselProduct = await storage.createProduct({\n      name: \"Diesel\",\n      category: \"fuel\", \n      unit: \"litre\",\n      currentPrice: \"280.00\",\n      density: \"0.830\",\n      hsnCode: \"27101110\",\n      taxRate: \"0.00\",\n      isActive: true\n    });\n\n    console.log(\"Created products:\", petrolProduct.name, dieselProduct.name);\n\n    // 3. Create tanks\n    const petrolTank = await storage.createTank({\n      stationId: station.id,\n      name: \"Tank 1 - Petrol\",\n      productId: petrolProduct.id,\n      capacity: \"20000.00\",\n      currentStock: \"12000.00\",\n      minimumLevel: \"3000.00\",\n      status: \"normal\",\n      lastRefillDate: new Date()\n    });\n\n    const dieselTank = await storage.createTank({\n      stationId: station.id,\n      name: \"Tank 2 - Diesel\", \n      productId: dieselProduct.id,\n      capacity: \"20000.00\",\n      currentStock: \"4000.00\", // Low stock to show alert\n      minimumLevel: \"3000.00\",\n      status: \"low\",\n      lastRefillDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000) // 3 days ago\n    });\n\n    console.log(\"Created tanks:\", petrolTank.name, dieselTank.name);\n\n    // 4. Create demo users with hashed passwords\n    const saltRounds = 10;\n\n    const adminUser = await storage.createUser({\n      username: \"admin\",\n      password: await bcrypt.hash(\"admin123\", saltRounds),\n      fullName: \"Admin User\",\n      role: \"admin\",\n      stationId: station.id,\n      isActive: true\n    });\n\n    const managerUser = await storage.createUser({\n      username: \"manager\", \n      password: await bcrypt.hash(\"manager123\", saltRounds),\n      fullName: \"Manager User\",\n      role: \"manager\",\n      stationId: station.id,\n      isActive: true\n    });\n\n    const cashierUser = await storage.createUser({\n      username: \"cashier\",\n      password: await bcrypt.hash(\"cashier123\", saltRounds), \n      fullName: \"Cashier User\",\n      role: \"cashier\",\n      stationId: station.id,\n      isActive: true\n    });\n\n    console.log(\"Created users:\", adminUser.username, managerUser.username, cashierUser.username);\n\n    // 5. Create some stock movements for realistic data\n    await storage.createStockMovement({\n      tankId: petrolTank.id,\n      stationId: station.id,\n      userId: adminUser.id,\n      movementType: \"in\",\n      quantity: \"8000.00\",\n      previousStock: \"4000.00\",\n      newStock: \"12000.00\",\n      referenceType: \"adjustment\",\n      notes: \"Initial stock refill\"\n    });\n\n    await storage.createStockMovement({\n      tankId: dieselTank.id,\n      stationId: station.id,\n      userId: adminUser.id,\n      movementType: \"in\", \n      quantity: \"3000.00\",\n      previousStock: \"1000.00\",\n      newStock: \"4000.00\",\n      referenceType: \"adjustment\",\n      notes: \"Initial stock refill\"\n    });\n\n    console.log(\"Created initial stock movements\");\n\n    // 6. Create sample customers for testing\n    const customers = await Promise.all([\n      storage.createCustomer({\n        name: \"Ahmed Transport Co.\",\n        contactPerson: \"Ahmed Ali\",\n        phone: \"+92-300-1234567\",\n        email: \"ahmed@transport.com\",\n        address: \"123 Transport Street, Karachi\",\n        creditLimit: \"50000.00\",\n        outstandingBalance: \"15000.00\",\n        isActive: true\n      }),\n      storage.createCustomer({\n        name: \"Khan Logistics\",\n        contactPerson: \"Muhammad Khan\", \n        phone: \"+92-321-7654321\",\n        email: \"khan@logistics.com\",\n        address: \"456 Logistics Avenue, Lahore\",\n        creditLimit: \"75000.00\",\n        outstandingBalance: \"8500.00\",\n        isActive: true\n      }),\n      storage.createCustomer({\n        name: \"City Bus Service\",\n        contactPerson: \"Fatima Sheikh\",\n        phone: \"+92-333-9876543\", \n        email: \"fatima@citybus.com\",\n        address: \"789 Bus Terminal Road, Islamabad\",\n        creditLimit: \"100000.00\",\n        outstandingBalance: \"0.00\",\n        isActive: true\n      }),\n      storage.createCustomer({\n        name: \"Delivery Express\",\n        contactPerson: \"Hassan Ahmed\",\n        phone: \"+92-345-1122334\",\n        email: \"hassan@delivery.com\", \n        address: \"321 Delivery Lane, Faisalabad\",\n        creditLimit: \"25000.00\",\n        outstandingBalance: \"5200.00\",\n        isActive: true\n      })\n    ]);\n    console.log(\"Created customers:\", customers.map(c => c.name).join(\", \"));\n\n    // 7. Create sample suppliers\n    const suppliers = await Promise.all([\n      storage.createSupplier({\n        name: \"Pakistan State Oil (PSO)\",\n        contactPerson: \"Ali Rahman\",\n        phone: \"+92-21-111222333\",\n        email: \"ali@pso.com.pk\",\n        address: \"PSO House, Clifton, Karachi\",\n        taxId: \"PSO123456789\",\n        paymentTerms: \"Net 30\",\n        isActive: true\n      }),\n      storage.createSupplier({\n        name: \"Shell Pakistan Limited\",\n        contactPerson: \"Sara Khan\", \n        phone: \"+92-21-444555666\",\n        email: \"sara@shell.com.pk\",\n        address: \"Shell Building, I.I. Chundrigar Road, Karachi\",\n        taxId: \"SHELL987654321\",\n        paymentTerms: \"Net 15\",\n        isActive: true\n      }),\n      storage.createSupplier({\n        name: \"Total PARCO Pakistan Ltd\",\n        contactPerson: \"Omar Malik\",\n        phone: \"+92-21-777888999\",\n        email: \"omar@totalparco.com.pk\", \n        address: \"PARCO Head Office, Karachi\",\n        taxId: \"PARCO555444333\",\n        paymentTerms: \"Net 45\",\n        isActive: true\n      })\n    ]);\n    console.log(\"Created suppliers:\", suppliers.map(s => s.name).join(\", \"));\n\n    // 8. Create additional products\n    const lubricantProduct = await storage.createProduct({\n      name: \"Engine Oil 10W-40\",\n      category: \"lubricant\", \n      unit: \"litre\",\n      currentPrice: \"1200.00\",\n      density: \"0.850\",\n      hsnCode: \"27101990\",\n      taxRate: \"0.00\",\n      isActive: true\n    });\n\n    const additiveProduct = await storage.createProduct({\n      name: \"Fuel Additive\",\n      category: \"additive\",\n      unit: \"bottle\",\n      currentPrice: \"350.00\",\n      hsnCode: \"38112100\",\n      taxRate: \"0.00\",\n      isActive: true\n    });\n    console.log(\"Created additional products:\", lubricantProduct.name, additiveProduct.name);\n\n    // 9. Create sample sales transactions with realistic data\n    const salesTransactions = [];\n    for (let i = 0; i < 15; i++) {\n      const randomCustomer = customers[Math.floor(Math.random() * customers.length)];\n      const randomCashier = Math.random() > 0.5 ? cashierUser : managerUser;\n      const daysAgo = Math.floor(Math.random() * 30); // Random date in last 30 days\n      const transactionDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      \n      // Random fuel quantities between 50-500 liters\n      const petrolQty = Math.random() > 0.5 ? (50 + Math.random() * 450).toFixed(2) : \"0\";\n      const dieselQty = Math.random() > 0.5 ? (50 + Math.random() * 450).toFixed(2) : \"0\";\n      \n      const petrolAmount = parseFloat(petrolQty) * 290;\n      const dieselAmount = parseFloat(dieselQty) * 280; \n      const subtotal = petrolAmount + dieselAmount;\n      \n      if (subtotal > 0) {\n        const paymentMethods = [\"cash\", \"card\", \"credit\"];\n        const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];\n        \n        const transaction = await storage.createSalesTransaction({\n          stationId: station.id,\n          customerId: randomCustomer.id,\n          userId: randomCashier.id,\n          invoiceNumber: `INV-2024-${String(1000 + i).padStart(4, '0')}`,\n          transactionDate: transactionDate,\n          paymentMethod: paymentMethod as any,\n          subtotal: subtotal.toFixed(2),\n          taxAmount: \"0.00\",\n          totalAmount: subtotal.toFixed(2),\n          paidAmount: paymentMethod === \"credit\" ? \"0.00\" : subtotal.toFixed(2),\n          outstandingAmount: paymentMethod === \"credit\" ? subtotal.toFixed(2) : \"0.00\",\n          paymentStatus: paymentMethod === \"credit\" ? \"pending\" : \"paid\",\n          notes: `Fuel transaction - ${paymentMethod} payment`,\n          currencyCode: \"PKR\"\n        });\n        \n        // Create transaction items\n        if (parseFloat(petrolQty) > 0) {\n          await storage.createSalesTransactionItem({\n            transactionId: transaction.id,\n            productId: petrolProduct.id,\n            tankId: petrolTank.id,\n            quantity: petrolQty,\n            unitPrice: \"290.00\",\n            totalPrice: petrolAmount.toFixed(2)\n          });\n          \n          // Create stock movement\n          await storage.createStockMovement({\n            tankId: petrolTank.id,\n            stationId: station.id,\n            userId: randomCashier.id,\n            movementType: \"out\",\n            quantity: petrolQty,\n            previousStock: \"0\", // Will be calculated\n            newStock: \"0\", // Will be calculated  \n            referenceId: transaction.id,\n            referenceType: \"sale\",\n            notes: `Sale - Invoice ${transaction.invoiceNumber}`,\n            movementDate: transactionDate\n          });\n        }\n        \n        if (parseFloat(dieselQty) > 0) {\n          await storage.createSalesTransactionItem({\n            transactionId: transaction.id,\n            productId: dieselProduct.id,\n            tankId: dieselTank.id,\n            quantity: dieselQty,\n            unitPrice: \"280.00\", \n            totalPrice: dieselAmount.toFixed(2)\n          });\n          \n          // Create stock movement\n          await storage.createStockMovement({\n            tankId: dieselTank.id,\n            stationId: station.id,\n            userId: randomCashier.id,\n            movementType: \"out\",\n            quantity: dieselQty,\n            previousStock: \"0\", // Will be calculated\n            newStock: \"0\", // Will be calculated\n            referenceId: transaction.id,\n            referenceType: \"sale\", \n            notes: `Sale - Invoice ${transaction.invoiceNumber}`,\n            movementDate: transactionDate\n          });\n        }\n        \n        salesTransactions.push(transaction);\n      }\n    }\n    console.log(`Created ${salesTransactions.length} sample sales transactions`);\n\n    // 10. Create sample purchase orders\n    for (let i = 0; i < 8; i++) {\n      const randomSupplier = suppliers[Math.floor(Math.random() * suppliers.length)];\n      const daysAgo = Math.floor(Math.random() * 60); // Random date in last 60 days\n      const orderDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      const expectedDate = new Date(orderDate.getTime() + 7 * 24 * 60 * 60 * 1000);\n      \n      const quantity = (5000 + Math.random() * 10000).toFixed(2);\n      const unitPrice = Math.random() > 0.5 ? \"275.00\" : \"265.00\"; // Wholesale prices\n      const totalAmount = (parseFloat(quantity) * parseFloat(unitPrice)).toFixed(2);\n      \n      const statuses = [\"pending\", \"approved\", \"delivered\", \"cancelled\"];\n      const status = statuses[Math.floor(Math.random() * statuses.length)];\n      \n      await storage.createPurchaseOrder({\n        stationId: station.id,\n        supplierId: randomSupplier.id,\n        userId: adminUser.id,\n        orderNumber: `PO-2024-${String(2000 + i).padStart(4, '0')}`,\n        orderDate: orderDate,\n        expectedDeliveryDate: expectedDate,\n        productId: Math.random() > 0.5 ? petrolProduct.id : dieselProduct.id,\n        quantity: quantity,\n        unitPrice: unitPrice,\n        subtotal: totalAmount,\n        taxAmount: \"0.00\",\n        totalAmount: totalAmount,\n        status: status as any,\n        notes: `Bulk fuel order from ${randomSupplier.name}`,\n        currencyCode: \"PKR\"\n      });\n    }\n    console.log(\"Created 8 sample purchase orders\");\n\n    // 11. Create sample expenses\n    const expenseCategories = [\"maintenance\", \"utilities\", \"supplies\", \"insurance\", \"rent\"];\n    for (let i = 0; i < 12; i++) {\n      const daysAgo = Math.floor(Math.random() * 90); // Random date in last 90 days\n      const expenseDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      const category = expenseCategories[Math.floor(Math.random() * expenseCategories.length)];\n      const amount = (1000 + Math.random() * 15000).toFixed(2);\n      \n      await storage.createExpense({\n        stationId: station.id,\n        description: getExpenseDescription(category),\n        category: category,\n        amount: amount,\n        expenseDate: expenseDate,\n        paymentMethod: Math.random() > 0.5 ? \"cash\" : \"card\",\n        receiptNumber: `RCP-${Date.now()}-${i}`,\n        notes: `${category} expense for station operations`\n      });\n    }\n    console.log(\"Created 12 sample expense records\");\n\n    // 12. Create more stock movements for testing\n    const movementTypes = [\"in\", \"out\", \"adjustment\", \"audit\"];\n    for (let i = 0; i < 10; i++) {\n      const randomTank = Math.random() > 0.5 ? petrolTank : dieselTank;\n      const movementType = movementTypes[Math.floor(Math.random() * movementTypes.length)];\n      const daysAgo = Math.floor(Math.random() * 45);\n      const movementDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      \n      let quantity = \"0\";\n      if (movementType === \"in\") {\n        quantity = (1000 + Math.random() * 5000).toFixed(2);\n      } else if (movementType === \"out\") {\n        quantity = (100 + Math.random() * 1000).toFixed(2);\n      } else if (movementType === \"adjustment\") {\n        quantity = ((Math.random() - 0.5) * 500).toFixed(2); // Can be negative\n      } else if (movementType === \"audit\") {\n        quantity = (3000 + Math.random() * 10000).toFixed(2);\n      }\n      \n      await storage.createStockMovement({\n        tankId: randomTank.id,\n        stationId: station.id, \n        userId: adminUser.id,\n        movementType: movementType as any,\n        quantity: quantity,\n        previousStock: \"0\", // Will be calculated\n        newStock: \"0\", // Will be calculated\n        referenceType: \"manual\",\n        notes: `${movementType.charAt(0).toUpperCase() + movementType.slice(1)} - Sample data`,\n        movementDate: movementDate\n      });\n    }\n    console.log(\"Created 10 additional stock movements\");\n\n    console.log(\"âœ… Comprehensive sample data seeding completed!\");\n    console.log(\"ðŸ“Š Sample data includes:\");\n    console.log(\"- 4 customers with various credit balances\");\n    console.log(\"- 3 suppliers (PSO, Shell, Total PARCO)\");\n    console.log(\"- 15+ sales transactions over last 30 days\");\n    console.log(\"- 8 purchase orders with different statuses\");\n    console.log(\"- 12 expense records across different categories\");\n    console.log(\"- 10+ additional stock movements\");\n    console.log(\"- Additional products (lubricants, additives)\");\n    console.log(\"\");\n    console.log(\"ðŸ” Demo login credentials:\");\n    console.log(\"- Admin: admin / admin123\");\n    console.log(\"- Manager: manager / manager123\");\n    console.log(\"- Cashier: cashier / cashier123\");\n\n  } catch (error) {\n    console.error(\"Error seeding sample data:\", error);\n    throw error;\n  }\n}\n\nasync function seedSampleData() {\n  try {\n    // Get existing entities\n    const [station] = await db.select().from(stations);\n    if (!station) {\n      console.log(\"No station found, skipping sample data creation\");\n      return;\n    }\n    \n    console.log(\"Adding sample data to existing station:\", station.name);\n\n    // Get existing users and products\n    const allUsers = await db.select().from(users);\n    const adminUser = allUsers.find(u => u.role === 'admin');\n    const managerUser = allUsers.find(u => u.role === 'manager');  \n    const cashierUser = allUsers.find(u => u.role === 'cashier');\n    \n    if (!adminUser || !managerUser || !cashierUser) {\n      console.log(\"Required users not found, skipping sample data creation\");\n      return;\n    }\n\n    // Check if sample data already exists (to avoid duplicates)\n    const existingCustomers = await db.select().from(customers);\n    if (existingCustomers.length > 0) {\n      console.log(\"Sample data already exists, skipping creation\");\n      return;\n    }\n\n    // Get existing products\n    const allProducts = await db.select().from(products);\n    const petrolProduct = allProducts.find(p => p.name === 'Petrol');\n    const dieselProduct = allProducts.find(p => p.name === 'Diesel');\n    \n    if (!petrolProduct || !dieselProduct) {\n      console.log(\"Required products not found, skipping sample data creation\");\n      return;\n    }\n\n    // Get existing tanks\n    const allTanks = await db.select().from(tanks);\n    const petrolTank = allTanks.find(t => t.productId === petrolProduct.id);\n    const dieselTank = allTanks.find(t => t.productId === dieselProduct.id);\n    \n    if (!petrolTank || !dieselTank) {\n      console.log(\"Required tanks not found, skipping sample data creation\");\n      return;\n    }\n\n    console.log(\"Creating comprehensive sample data...\");\n\n    // Create sample customers\n    const testCustomers = await Promise.all([\n      storage.createCustomer({\n        name: \"Ahmed Transport Co.\",\n        contactPerson: \"Ahmed Ali\",\n        phone: \"+92-300-1234567\",\n        email: \"ahmed@transport.com\",\n        address: \"123 Transport Street, Karachi\",\n        creditLimit: \"50000.00\",\n        outstandingBalance: \"15000.00\",\n        isActive: true\n      }),\n      storage.createCustomer({\n        name: \"Khan Logistics\",\n        contactPerson: \"Muhammad Khan\", \n        phone: \"+92-321-7654321\",\n        email: \"khan@logistics.com\",\n        address: \"456 Logistics Avenue, Lahore\",\n        creditLimit: \"75000.00\",\n        outstandingBalance: \"8500.00\",\n        isActive: true\n      }),\n      storage.createCustomer({\n        name: \"City Bus Service\",\n        contactPerson: \"Fatima Sheikh\",\n        phone: \"+92-333-9876543\", \n        email: \"fatima@citybus.com\",\n        address: \"789 Bus Terminal Road, Islamabad\",\n        creditLimit: \"100000.00\",\n        outstandingBalance: \"0.00\",\n        isActive: true\n      })\n    ]);\n    console.log(\"âœ… Created\", testCustomers.length, \"sample customers\");\n\n    // Create sample suppliers\n    const testSuppliers = await Promise.all([\n      storage.createSupplier({\n        name: \"Pakistan State Oil (PSO)\",\n        contactPerson: \"Ali Rahman\",\n        phone: \"+92-21-111222333\",\n        email: \"ali@pso.com.pk\",\n        address: \"PSO House, Clifton, Karachi\",\n        taxId: \"PSO123456789\",\n        paymentTerms: \"Net 30\",\n        isActive: true\n      }),\n      storage.createSupplier({\n        name: \"Shell Pakistan Limited\",\n        contactPerson: \"Sara Khan\", \n        phone: \"+92-21-444555666\",\n        email: \"sara@shell.com.pk\",\n        address: \"Shell Building, I.I. Chundrigar Road, Karachi\",\n        taxId: \"SHELL987654321\", \n        paymentTerms: \"Net 15\",\n        isActive: true\n      })\n    ]);\n    console.log(\"âœ… Created\", testSuppliers.length, \"sample suppliers\");\n\n    // Create sample sales transactions\n    let transactionCount = 0;\n    for (let i = 0; i < 10; i++) {\n      const randomCustomer = testCustomers[Math.floor(Math.random() * testCustomers.length)];\n      const randomCashier = Math.random() > 0.5 ? cashierUser : managerUser;\n      const daysAgo = Math.floor(Math.random() * 20);\n      const transactionDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      \n      const fuelQty = (50 + Math.random() * 300).toFixed(2);\n      const product = Math.random() > 0.5 ? petrolProduct : dieselProduct;\n      const tank = product.id === petrolProduct.id ? petrolTank : dieselTank;\n      const unitPrice = product.id === petrolProduct.id ? \"290.00\" : \"280.00\";\n      const totalAmount = parseFloat(fuelQty) * parseFloat(unitPrice);\n      \n      const paymentMethod = [\"cash\", \"card\", \"credit\"][Math.floor(Math.random() * 3)];\n      \n      const transaction = await storage.createSalesTransaction({\n        stationId: station.id,\n        customerId: randomCustomer.id,\n        userId: randomCashier.id,\n        invoiceNumber: `INV-TEST-${String(1000 + i).padStart(4, '0')}`,\n        transactionDate: transactionDate,\n        paymentMethod: paymentMethod as any,\n        subtotal: totalAmount.toFixed(2),\n        taxAmount: \"0.00\",\n        totalAmount: totalAmount.toFixed(2),\n        paidAmount: paymentMethod === \"credit\" ? \"0.00\" : totalAmount.toFixed(2),\n        outstandingAmount: paymentMethod === \"credit\" ? totalAmount.toFixed(2) : \"0.00\",\n        paymentStatus: paymentMethod === \"credit\" ? \"pending\" : \"paid\",\n        notes: `Sample fuel transaction - ${paymentMethod} payment`,\n        currencyCode: \"PKR\"\n      });\n      \n      await storage.createSalesTransactionItem({\n        transactionId: transaction.id,\n        productId: product.id,\n        tankId: tank.id,\n        quantity: fuelQty,\n        unitPrice: unitPrice,\n        totalPrice: totalAmount.toFixed(2)\n      });\n      \n      transactionCount++;\n    }\n    console.log(\"âœ… Created\", transactionCount, \"sample sales transactions\");\n\n    // Create sample expenses\n    const expenseCategories = [\"maintenance\", \"utilities\", \"supplies\"];\n    for (let i = 0; i < 6; i++) {\n      const daysAgo = Math.floor(Math.random() * 30);\n      const expenseDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      const category = expenseCategories[Math.floor(Math.random() * expenseCategories.length)];\n      const amount = (2000 + Math.random() * 8000).toFixed(2);\n      \n      await storage.createExpense({\n        stationId: station.id,\n        userId: managerUser.id, // Add required userId field\n        description: getExpenseDescription(category),\n        category: category,\n        amount: amount,\n        expenseDate: expenseDate,\n        paymentMethod: Math.random() > 0.5 ? \"cash\" : \"card\",\n        receiptNumber: `RCP-TEST-${Date.now()}-${i}`,\n        notes: `Sample ${category} expense`\n      });\n    }\n    console.log(\"âœ… Created 6 sample expense records\");\n\n    // Create sample purchase orders\n    for (let i = 0; i < 4; i++) {\n      const randomSupplier = testSuppliers[Math.floor(Math.random() * testSuppliers.length)];\n      const daysAgo = Math.floor(Math.random() * 40);\n      const orderDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n      const expectedDate = new Date(orderDate.getTime() + 7 * 24 * 60 * 60 * 1000);\n      \n      const quantity = (3000 + Math.random() * 7000).toFixed(2);\n      const unitPrice = \"275.00\";\n      const totalAmount = (parseFloat(quantity) * parseFloat(unitPrice)).toFixed(2);\n      \n      const status = [\"pending\", \"approved\", \"delivered\"][Math.floor(Math.random() * 3)];\n      \n      await storage.createPurchaseOrder({\n        stationId: station.id,\n        supplierId: randomSupplier.id,\n        userId: adminUser.id,\n        orderNumber: `PO-TEST-${String(3000 + i).padStart(4, '0')}`,\n        orderDate: orderDate,\n        expectedDeliveryDate: expectedDate,\n        productId: Math.random() > 0.5 ? petrolProduct.id : dieselProduct.id,\n        quantity: quantity,\n        unitPrice: unitPrice,\n        subtotal: totalAmount,\n        taxAmount: \"0.00\",\n        totalAmount: totalAmount,\n        status: status as any,\n        notes: `Sample bulk fuel order from ${randomSupplier.name}`,\n        currencyCode: \"PKR\"\n      });\n    }\n    console.log(\"âœ… Created 4 sample purchase orders\");\n    \n    console.log(\"ðŸŽ‰ Comprehensive sample data added successfully!\");\n    console.log(\"ðŸ“Š Sample data includes customers, suppliers, sales, expenses, and purchase orders\");\n    console.log(\"ðŸ§ª Perfect for testing all application features!\");\n  } catch (error) {\n    console.error(\"Error adding sample data:\", error);\n  }\n}\n\nfunction getExpenseDescription(category: string): string {\n  const descriptions = {\n    maintenance: [\"Pump servicing\", \"Tank cleaning\", \"Equipment repair\", \"Preventive maintenance\"],\n    utilities: [\"Electricity bill\", \"Water bill\", \"Internet charges\", \"Phone bill\"],\n    supplies: [\"Office supplies\", \"Cleaning materials\", \"Safety equipment\", \"Stationery\"],\n    insurance: [\"Vehicle insurance\", \"Property insurance\", \"Liability coverage\", \"Equipment insurance\"],\n    rent: [\"Office rent\", \"Equipment lease\", \"Land rent\", \"Storage rent\"]\n  };\n  \n  const categoryDescriptions = descriptions[category as keyof typeof descriptions] || [\"General expense\"];\n  return categoryDescriptions[Math.floor(Math.random() * categoryDescriptions.length)];\n}","size_bytes":25526}},"version":1}